System.register([],(function(t,e){"use strict";return{execute:function(){var n=document.createElement("style");n.textContent='html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}:focus{outline:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration{-webkit-appearance:none;-moz-appearance:none}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}textarea{overflow:auto;vertical-align:top;resize:vertical}audio,canvas,video{display:inline-block;*display: inline;*zoom: 1;max-width:100%}audio:not([controls]){display:none;height:0}[hidden]{display:none}html{font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a:focus{outline:thin dotted}a:active,a:hover{outline:0}img{border:0;-ms-interpolation-mode:bicubic}figure{margin:0}form{margin:0}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0;white-space:normal;*margin-left: -7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align: middle}button,input{line-height:normal}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer;*overflow: visible}button[disabled],html input[disabled]{cursor:default}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0;*height: 13px;*width: 13px}input[type=search]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}html,button,input,select,textarea{color:#222}::-moz-selection{background:#b3d4fc;text-shadow:none}::selection{background:#b3d4fc;text-shadow:none}img{vertical-align:middle}fieldset{border:0;margin:0;padding:0}textarea{resize:vertical}.chromeframe{margin:.2em 0;background:#ccc;color:#000;padding:.2em 0}\n',document.head.appendChild(n);const r=function(t,e,n){let r=Promise.resolve();return r.then((()=>t())).catch((t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}))};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s,o={exports:{}},a="object"==typeof Reflect?Reflect:null,c=a&&"function"==typeof a.apply?a.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};s=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var u=Number.isNaN||function(t){return t!=t};function h(){h.init.call(this)}o.exports=h,o.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}w(t,e,s,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&w(t,"error",e,n)}(t,i,{once:!0})}))},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var l=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function p(t){return void 0===t._maxListeners?h.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var i,s,o,a;if(d(n),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),void 0===o)o=s[e]=n,++t._eventsCount;else if("function"==typeof o?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=p(t))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return t}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=g.bind(r);return i.listener=n,r.wrapFn=i,i}function b(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):m(i,i.length)}function v(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function w(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");l=t}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},h.prototype.getMaxListeners=function(){return p(this)},h.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[t];if(void 0===a)return!1;if("function"==typeof a)c(a,this,e);else{var u=a.length,h=m(a,u);for(n=0;n<u;++n)c(h[n],this,e)}return!0},h.prototype.addListener=function(t,e){return f(this,t,e,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(t,e){return f(this,t,e,!0)},h.prototype.once=function(t,e){return d(e),this.on(t,y(this,t,e)),this},h.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,y(this,t,e)),this},h.prototype.removeListener=function(t,e){var n,r,i,s,o;if(d(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},h.prototype.listeners=function(t){return b(this,t,!0)},h.prototype.rawListeners=function(t){return b(this,t,!1)},h.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},h.prototype.listenerCount=v,h.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};var j=o.exports;const _=i(j);var O="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,D=O||S||Function("return this")(),A=D.Symbol,E=Object.prototype,$=E.hasOwnProperty,C=E.toString,M=A?A.toStringTag:void 0,I=Object.prototype.toString,L="[object Null]",x="[object Undefined]",T=A?A.toStringTag:void 0;function P(t){return null==t?void 0===t?x:L:T&&T in Object(t)?function(t){var e=$.call(t,M),n=t[M];try{t[M]=void 0;var r=!0}catch(s){}var i=C.call(t);return r&&(e?t[M]=n:delete t[M]),i}(t):function(t){return I.call(t)}(t)}function k(t){return null!=t&&"object"==typeof t}var R="[object Symbol]";function N(t){return"symbol"==typeof t||k(t)&&P(t)==R}var z=Array.isArray,F=1/0,W=A?A.prototype:void 0,U=W?W.toString:void 0;function V(t){if("string"==typeof t)return t;if(z(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}(t,V)+"";if(N(t))return U?U.call(t):"";var e=t+"";return"0"==e&&1/t==-F?"-0":e}function q(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var B="[object AsyncFunction]",H="[object Function]",Q="[object GeneratorFunction]",G="[object Proxy]";function Y(t){if(!q(t))return!1;var e=P(t);return e==H||e==Q||e==B||e==G}var J,K=D["__core-js_shared__"],Z=(J=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",X=Function.prototype.toString;function tt(t){if(null!=t){try{return X.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var et=/^\[object .+?Constructor\]$/,nt=Function.prototype,rt=Object.prototype,it=nt.toString,st=rt.hasOwnProperty,ot=RegExp("^"+it.call(st).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function at(t){return!(!q(t)||(e=t,Z&&Z in e))&&(Y(t)?ot:et).test(tt(t));var e}function ct(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return at(n)?n:void 0}var ut=ct(D,"WeakMap"),ht=Object.create,lt=function(){function t(){}return function(e){if(!q(e))return{};if(ht)return ht(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),dt=function(){try{var t=ct(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),pt=9007199254740991,ft=/^(?:0|[1-9]\d*)$/;function gt(t,e){var n=typeof t;return!!(e=null==e?pt:e)&&("number"==n||"symbol"!=n&&ft.test(t))&&t>-1&&t%1==0&&t<e}function yt(t,e,n){"__proto__"==e&&dt?dt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function bt(t,e){return t===e||t!=t&&e!=e}var vt=Object.prototype.hasOwnProperty;function mt(t,e,n){var r=t[e];vt.call(t,e)&&bt(r,n)&&(void 0!==n||e in t)||yt(t,e,n)}function wt(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;void 0===c&&(c=t[a]),i?yt(n,a,c):mt(n,a,c)}return n}var jt=9007199254740991;function _t(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=jt}function Ot(t){return null!=t&&_t(t.length)&&!Y(t)}var St=Object.prototype;function Dt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||St)}function At(t){return k(t)&&"[object Arguments]"==P(t)}var Et=Object.prototype,$t=Et.hasOwnProperty,Ct=Et.propertyIsEnumerable,Mt=At(function(){return arguments}())?At:function(t){return k(t)&&$t.call(t,"callee")&&!Ct.call(t,"callee")},It="object"==typeof t&&t&&!t.nodeType&&t,Lt=It&&"object"==typeof e&&e&&!e.nodeType&&e,xt=Lt&&Lt.exports===It?D.Buffer:void 0,Tt=(xt?xt.isBuffer:void 0)||function(){return!1},Pt={};function kt(t){return function(e){return t(e)}}Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object Boolean]"]=Pt["[object DataView]"]=Pt["[object Date]"]=Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object WeakMap]"]=!1;var Rt="object"==typeof t&&t&&!t.nodeType&&t,Nt=Rt&&"object"==typeof e&&e&&!e.nodeType&&e,zt=Nt&&Nt.exports===Rt&&O.process,Ft=function(){try{var t=Nt&&Nt.require&&Nt.require("util").types;return t||zt&&zt.binding&&zt.binding("util")}catch(e){}}(),Wt=Ft&&Ft.isTypedArray,Ut=Wt?kt(Wt):function(t){return k(t)&&_t(t.length)&&!!Pt[P(t)]},Vt=Object.prototype.hasOwnProperty;function qt(t,e){var n=z(t),r=!n&&Mt(t),i=!n&&!r&&Tt(t),s=!n&&!r&&!i&&Ut(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!Vt.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gt(u,c))||a.push(u);return a}function Bt(t,e){return function(n){return t(e(n))}}var Ht=Bt(Object.keys,Object),Qt=Object.prototype.hasOwnProperty;function Gt(t){if(!Dt(t))return Ht(t);var e=[];for(var n in Object(t))Qt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Yt(t){return Ot(t)?qt(t):Gt(t)}var Jt=Object.prototype.hasOwnProperty;function Kt(t){if(!q(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Dt(t),n=[];for(var r in t)("constructor"!=r||!e&&Jt.call(t,r))&&n.push(r);return n}function Zt(t){return Ot(t)?qt(t,!0):Kt(t)}var Xt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,te=/^\w*$/,ee=ct(Object,"create"),ne=Object.prototype.hasOwnProperty,re=Object.prototype.hasOwnProperty;function ie(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function se(t,e){for(var n=t.length;n--;)if(bt(t[n][0],e))return n;return-1}ie.prototype.clear=function(){this.__data__=ee?ee(null):{},this.size=0},ie.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ie.prototype.get=function(t){var e=this.__data__;if(ee){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ne.call(e,t)?e[t]:void 0},ie.prototype.has=function(t){var e=this.__data__;return ee?void 0!==e[t]:re.call(e,t)},ie.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ee&&void 0===e?"__lodash_hash_undefined__":e,this};var oe=Array.prototype.splice;function ae(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ae.prototype.clear=function(){this.__data__=[],this.size=0},ae.prototype.delete=function(t){var e=this.__data__,n=se(e,t);return!(n<0||(n==e.length-1?e.pop():oe.call(e,n,1),--this.size,0))},ae.prototype.get=function(t){var e=this.__data__,n=se(e,t);return n<0?void 0:e[n][1]},ae.prototype.has=function(t){return se(this.__data__,t)>-1},ae.prototype.set=function(t,e){var n=this.__data__,r=se(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var ce=ct(D,"Map");function ue(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function he(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}he.prototype.clear=function(){this.size=0,this.__data__={hash:new ie,map:new(ce||ae),string:new ie}},he.prototype.delete=function(t){var e=ue(this,t).delete(t);return this.size-=e?1:0,e},he.prototype.get=function(t){return ue(this,t).get(t)},he.prototype.has=function(t){return ue(this,t).has(t)},he.prototype.set=function(t,e){var n=ue(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var le="Expected a function";function de(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(le);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(de.Cache||he),n}de.Cache=he;var pe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fe=/\\(\\)?/g,ge=function(t){var e=de(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(pe,(function(t,n,r,i){e.push(r?i.replace(fe,"$1"):n||t)})),e}));function ye(t,e){return z(t)?t:function(t,e){if(z(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!N(t))||te.test(t)||!Xt.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:ge(function(t){return null==t?"":V(t)}(t))}var be=1/0;function ve(t){if("string"==typeof t||N(t))return t;var e=t+"";return"0"==e&&1/t==-be?"-0":e}function me(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var we=Bt(Object.getPrototypeOf,Object);function je(t){var e=this.__data__=new ae(t);this.size=e.size}je.prototype.clear=function(){this.__data__=new ae,this.size=0},je.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},je.prototype.get=function(t){return this.__data__.get(t)},je.prototype.has=function(t){return this.__data__.has(t)},je.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ae){var r=n.__data__;if(!ce||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new he(r)}return n.set(t,e),this.size=n.size,this};var _e="object"==typeof t&&t&&!t.nodeType&&t,Oe=_e&&"object"==typeof e&&e&&!e.nodeType&&e,Se=Oe&&Oe.exports===_e?D.Buffer:void 0,De=Se?Se.allocUnsafe:void 0;function Ae(){return[]}var Ee=Object.prototype.propertyIsEnumerable,$e=Object.getOwnPropertySymbols,Ce=$e?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}($e(t),(function(e){return Ee.call(t,e)})))}:Ae,Me=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)me(e,Ce(t)),t=we(t);return e}:Ae;function Ie(t,e,n){var r=e(t);return z(t)?r:me(r,n(t))}function Le(t){return Ie(t,Yt,Ce)}function xe(t){return Ie(t,Zt,Me)}var Te=ct(D,"DataView"),Pe=ct(D,"Promise"),ke=ct(D,"Set"),Re="[object Map]",Ne="[object Promise]",ze="[object Set]",Fe="[object WeakMap]",We="[object DataView]",Ue=tt(Te),Ve=tt(ce),qe=tt(Pe),Be=tt(ke),He=tt(ut),Qe=P;(Te&&Qe(new Te(new ArrayBuffer(1)))!=We||ce&&Qe(new ce)!=Re||Pe&&Qe(Pe.resolve())!=Ne||ke&&Qe(new ke)!=ze||ut&&Qe(new ut)!=Fe)&&(Qe=function(t){var e=P(t),n="[object Object]"==e?t.constructor:void 0,r=n?tt(n):"";if(r)switch(r){case Ue:return We;case Ve:return Re;case qe:return Ne;case Be:return ze;case He:return Fe}return e});var Ge=Object.prototype.hasOwnProperty,Ye=D.Uint8Array;function Je(t){var e=new t.constructor(t.byteLength);return new Ye(e).set(new Ye(t)),e}var Ke=/\w*$/,Ze=A?A.prototype:void 0,Xe=Ze?Ze.valueOf:void 0,tn="[object Boolean]",en="[object Date]",nn="[object Map]",rn="[object Number]",sn="[object RegExp]",on="[object Set]",an="[object String]",cn="[object Symbol]",un="[object ArrayBuffer]",hn="[object DataView]",ln="[object Float32Array]",dn="[object Float64Array]",pn="[object Int8Array]",fn="[object Int16Array]",gn="[object Int32Array]",yn="[object Uint8Array]",bn="[object Uint8ClampedArray]",vn="[object Uint16Array]",mn="[object Uint32Array]";function wn(t,e,n){var r,i,s,o=t.constructor;switch(e){case un:return Je(t);case tn:case en:return new o(+t);case hn:return function(t,e){var n=e?Je(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case ln:case dn:case pn:case fn:case gn:case yn:case bn:case vn:case mn:return function(t,e){var n=e?Je(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case nn:return new o;case rn:case an:return new o(t);case sn:return(s=new(i=t).constructor(i.source,Ke.exec(i))).lastIndex=i.lastIndex,s;case on:return new o;case cn:return r=t,Xe?Object(Xe.call(r)):{}}}var jn=Ft&&Ft.isMap,_n=jn?kt(jn):function(t){return k(t)&&"[object Map]"==Qe(t)},On=Ft&&Ft.isSet,Sn=On?kt(On):function(t){return k(t)&&"[object Set]"==Qe(t)},Dn=1,An=2,En=4,$n="[object Arguments]",Cn="[object Function]",Mn="[object GeneratorFunction]",In="[object Object]",Ln={};function xn(t,e,n,r,i,s){var o,a=e&Dn,c=e&An,u=e&En;if(void 0!==o)return o;if(!q(t))return t;var h=z(t);if(h){if(o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ge.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,o)}else{var l=Qe(t),d=l==Cn||l==Mn;if(Tt(t))return function(t,e){if(e)return t.slice();var n=t.length,r=De?De(n):new t.constructor(n);return t.copy(r),r}(t,a);if(l==In||l==$n||d&&!i){if(o=c||d?{}:function(t){return"function"!=typeof t.constructor||Dt(t)?{}:lt(we(t))}(t),!a)return c?function(t,e){return wt(t,Me(t),e)}(t,function(t,e){return t&&wt(e,Zt(e),t)}(o,t)):function(t,e){return wt(t,Ce(t),e)}(t,function(t,e){return t&&wt(e,Yt(e),t)}(o,t))}else{if(!Ln[l])return i?t:{};o=wn(t,l,a)}}s||(s=new je);var p=s.get(t);if(p)return p;s.set(t,o),Sn(t)?t.forEach((function(r){o.add(xn(r,e,n,0,t,s))})):_n(t)&&t.forEach((function(r,i){o.set(i,xn(r,e,n,0,t,s))}));var f=h?void 0:(u?c?xe:Le:c?Zt:Yt)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(f||t,(function(r,i){f&&(r=t[i=r]),mt(o,i,xn(r,e,n,0,t,s))})),o}Ln[$n]=Ln["[object Array]"]=Ln["[object ArrayBuffer]"]=Ln["[object DataView]"]=Ln["[object Boolean]"]=Ln["[object Date]"]=Ln["[object Float32Array]"]=Ln["[object Float64Array]"]=Ln["[object Int8Array]"]=Ln["[object Int16Array]"]=Ln["[object Int32Array]"]=Ln["[object Map]"]=Ln["[object Number]"]=Ln[In]=Ln["[object RegExp]"]=Ln["[object Set]"]=Ln["[object String]"]=Ln["[object Symbol]"]=Ln["[object Uint8Array]"]=Ln["[object Uint8ClampedArray]"]=Ln["[object Uint16Array]"]=Ln["[object Uint32Array]"]=!0,Ln["[object Error]"]=Ln[Cn]=Ln["[object WeakMap]"]=!1;var Tn=Object.prototype.hasOwnProperty;function Pn(t,e){return null!=t&&Tn.call(t,e)}function kn(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=ye(e,t)).length,s=!1;++r<i;){var o=ve(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&_t(i)&&gt(o,i)&&(z(t)||Mt(t))}(t,e,Pn)}var Rn=Object.prototype.hasOwnProperty;function Nn(t,e,n){return null==t?t:function(t,e,n){if(!q(t))return t;for(var r=-1,i=(e=ye(e,t)).length,s=i-1,o=t;null!=o&&++r<i;){var a=ve(e[r]),c=n;if("__proto__"===a||"constructor"===a||"prototype"===a)return t;if(r!=s){var u=o[a];void 0===(c=void 0)&&(c=q(u)?u:gt(e[r+1])?[]:{})}mt(o,a,c),o=o[a]}return t}(t,e,n)}!function(t){t.exports=function(){var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",o="hour",a="day",c="week",u="month",h="quarter",l="year",d="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},b=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},v={s:b,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+b(r,2,"0")+":"+b(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,u),s=n-i<0,o=e.clone().add(r+(s?-1:1),u);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:l,w:c,d:a,D:d,h:o,m:s,s:i,ms:r,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",w={};w[m]=y;var j="$isDayjsObject",_=function(t){return t instanceof A||!(!t||!t[j])},O=function t(e,n,r){var i;if(!e)return m;if("string"==typeof e){var s=e.toLowerCase();w[s]&&(i=s),n&&(w[s]=n,i=s);var o=e.split("-");if(!i&&o.length>1)return t(o[0])}else{var a=e.name;w[a]=e,i=a}return!r&&i&&(m=i),i||!r&&m},S=function(t,e){if(_(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new A(n)},D=v;D.l=O,D.i=_,D.w=function(t,e){return S(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var A=function(){function y(t){this.$L=O(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[j]=!0}var b=y.prototype;return b.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(D.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(f);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.init()},b.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},b.$utils=function(){return D},b.isValid=function(){return!(this.$d.toString()===p)},b.isSame=function(t,e){var n=S(t);return this.startOf(e)<=n&&n<=this.endOf(e)},b.isAfter=function(t,e){return S(t)<this.startOf(e)},b.isBefore=function(t,e){return this.endOf(e)<S(t)},b.$g=function(t,e,n){return D.u(t)?this[e]:this.set(n,t)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(t,e){var n=this,r=!!D.u(e)||e,h=D.p(t),p=function(t,e){var i=D.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},f=function(t,e){return D.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},g=this.$W,y=this.$M,b=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case l:return r?p(1,0):p(31,11);case u:return r?p(1,y):p(0,y+1);case c:var m=this.$locale().weekStart||0,w=(g<m?g+7:g)-m;return p(r?b-w:b+(6-w),y);case a:case d:return f(v+"Hours",0);case o:return f(v+"Minutes",1);case s:return f(v+"Seconds",2);case i:return f(v+"Milliseconds",3);default:return this.clone()}},b.endOf=function(t){return this.startOf(t,!1)},b.$set=function(t,e){var n,c=D.p(t),h="set"+(this.$u?"UTC":""),p=(n={},n[a]=h+"Date",n[d]=h+"Date",n[u]=h+"Month",n[l]=h+"FullYear",n[o]=h+"Hours",n[s]=h+"Minutes",n[i]=h+"Seconds",n[r]=h+"Milliseconds",n)[c],f=c===a?this.$D+(e-this.$W):e;if(c===u||c===l){var g=this.clone().set(d,1);g.$d[p](f),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},b.set=function(t,e){return this.clone().$set(t,e)},b.get=function(t){return this[D.p(t)]()},b.add=function(r,h){var d,p=this;r=Number(r);var f=D.p(h),g=function(t){var e=S(p);return D.w(e.date(e.date()+Math.round(t*r)),p)};if(f===u)return this.set(u,this.$M+r);if(f===l)return this.set(l,this.$y+r);if(f===a)return g(1);if(f===c)return g(7);var y=(d={},d[s]=e,d[o]=n,d[i]=t,d)[f]||1,b=this.$d.getTime()+r*y;return D.w(b,this)},b.subtract=function(t,e){return this.add(-1*t,e)},b.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=D.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,h=n.meridiem,l=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},d=function(t){return D.s(s%12||12,t,"0")},f=h||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(g,(function(t,r){return r||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return D.s(e.$y,4,"0");case"M":return a+1;case"MM":return D.s(a+1,2,"0");case"MMM":return l(n.monthsShort,a,u,3);case"MMMM":return l(u,a);case"D":return e.$D;case"DD":return D.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(n.weekdaysMin,e.$W,c,2);case"ddd":return l(n.weekdaysShort,e.$W,c,3);case"dddd":return c[e.$W];case"H":return String(s);case"HH":return D.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return f(s,o,!0);case"A":return f(s,o,!1);case"m":return String(o);case"mm":return D.s(o,2,"0");case"s":return String(e.$s);case"ss":return D.s(e.$s,2,"0");case"SSS":return D.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(r,d,p){var f,g=this,y=D.p(d),b=S(r),v=(b.utcOffset()-this.utcOffset())*e,m=this-b,w=function(){return D.m(g,b)};switch(y){case l:f=w()/12;break;case u:f=w();break;case h:f=w()/3;break;case c:f=(m-v)/6048e5;break;case a:f=(m-v)/864e5;break;case o:f=m/n;break;case s:f=m/e;break;case i:f=m/t;break;default:f=m}return p?f:D.a(f)},b.daysInMonth=function(){return this.endOf(u).$D},b.$locale=function(){return w[this.$L]},b.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=O(t,e,!0);return r&&(n.$L=r),n},b.clone=function(){return D.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},y}(),E=A.prototype;return S.prototype=E,[["$ms",r],["$s",i],["$m",s],["$H",o],["$W",a],["$M",u],["$y",l],["$D",d]].forEach((function(t){E[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),S.extend=function(t,e){return t.$i||(t(e,A,S),t.$i=!0),S},S.locale=O,S.isDayjs=_,S.unix=function(t){return S(1e3*t)},S.en=w[m],S.Ls=w,S.p={},S}()}({exports:{}}),function(t){t.exports=function(){var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,s){var o=i.prototype;s.utc=function(t){return new i({date:t,utc:!0,args:arguments})},o.utc=function(e){var n=s(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},o.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),a.call(this,t)};var c=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else c.call(this)};var u=o.utcOffset;o.utcOffset=function(r,i){var s=this.$utils().u;if(s(r))return this.$u?0:s(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],s=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===s?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,a=this;if(i)return a.$offset=o,a.$u=0===r,a;if(0!==r){var c=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+c,t)).$offset=o,a.$x.$localOffset=c}else a=this.utc();return a};var h=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var l=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var d=o.diff;o.diff=function(t,e,n){if(t&&this.$u===t.$u)return d.call(this,t,e,n);var r=this.local(),i=s(t).local();return d.call(r,i,e,n)}}}()}({exports:{}});var zn=(t=>(t.CONTAINER="container",t.PAGE="page",t.ROOT="app",t.PAGE_FRAGMENT="page-fragment",t))(zn||{});const Fn="displayConds";var Wn=(t=>(t.COMP="comp",t.CODE="code",t.DATA_SOURCE="data-source",t))(Wn||{}),Un=(t=>(t.CODE="code",t))(Un||{}),Vn=(t=>(t.CODE="code",t.DATA_SOURCE_METHOD="data-source-method",t))(Vn||{});const qn=t=>t?.dataset?.tmagicId,Bn=(t,e)=>t?.querySelector(`[data-tmagic-id="${e}"]`),Hn=()=>Bn,Qn=(t,e=[])=>{const n=[],r=function(t,e){if(!Array.isArray(e))return null;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(n.push(s),`${s.id}`==`${t}`)return s;if(s.items){const e=r(t,s.items);if(e)return e}n.pop()}return null};return r(t,e),n},Gn=t=>"[object Object]"===Object.prototype.toString.call(t),Yn=t=>!!t&&Boolean(t.type?.toLowerCase()===zn.PAGE),Jn=t=>`${t}`.replaceAll(/\[(\d+)\]/g,".$1").split("."),Kn=(t="",e={})=>(Array.isArray(t)?t:Jn(t)).reduce(((n,r)=>{if(Gn(n))return n[r];if(Array.isArray(n)&&/^\d*$/.test(`${r}`))return n[r];throw new Error(`${e}中不存在${t}`)}),e),Zn=(t,e,n={})=>Nn(n,t,e),Xn=(t,e=[])=>{const n=[],r=function(t,e){if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i],o=t.findIndex((t=>`${t}`==`${s.id}`));o>-1&&(t.slice(o,1),n.push(s)),s.items&&r(t,s.items)}};return r(t,e),n},tr=(t={})=>Array.from(Object.values(t).reduce(((t,e)=>(Object.keys(e).forEach((e=>{t.add(e)})),t)),new Set)),er=(t,e,n)=>{const r=Qn(t.id,e),i=r.pop();let s=r.pop();if(n&&(s=Qn(n,e).pop()),!i)throw new Error("未找到目标节点");if(!s)throw new Error("未找到父节点");const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1,t)},nr="__tmagic__",rr=(t,e,n={},r)=>{let i=[];if(r){const t=n[r];i=t?.[e.id].keys||[]}else i=((t={},e)=>Array.from(Object.values(t).reduce(((t,n)=>((n[e]?.keys||[]).forEach((e=>t.add(e))),t)),new Set)))(n,e.id);return i.forEach((n=>{const r=Jn(n),i=r.map(((t,e)=>e<r.length-1?t:`${nr}${t}`));let s,o=Kn(i,e);if(void 0===o)try{const t=Kn(n,e);Zn(i.join("."),t,e),o=t}catch(a){return void console.warn(a)}try{s=t(o)}catch(a){console.error(a),s=""}Zn(n,s,e)})),e},ir=(t,e,n,r=[])=>{switch("string"==typeof e&&void 0===n&&(n=""),t){case"is":case"=":return e===n;case"not":case"!=":return e!==n;case">":return e>n;case">=":return e>=n;case"<":return e<n;case"<=":return e<=n;case"between":return r.length>1&&e>=r[0]&&e<=r[1];case"not_between":return r.length<2||e<r[0]||e>r[1];case"include":return e?.includes?.(n);case"not_include":return void 0===e||!e.includes?.(n)}return!1},sr=t=>{const e={},n={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return t.forEach((t=>{if(void 0===t.defaultValue)"object"!==t.type?t.type?e[t.name]=n[t.type]:e[t.name]=void 0:e[t.name]=t.fields?sr(t.fields):n.object;else{if("array"===t.type&&!Array.isArray(t.defaultValue))return void(e[t.name]=n.array);if("object"===t.type&&!Gn(t.defaultValue)){if("string"==typeof t.defaultValue){try{e[t.name]=JSON.parse(t.defaultValue)}catch(r){e[t.name]=n.object}return}return void(e[t.name]=n.object)}e[t.name]=xn(t.defaultValue,5)}})),e},or="ds-field::",ar="ds-field-changed",cr=/\$\{([\s\S]+?)\}/g;var ur=(t=>(t.DEFAULT="default",t.CODE_BLOCK="code-block",t.DATA_SOURCE="data-source",t.DATA_SOURCE_METHOD="data-source-method",t.DATA_SOURCE_COND="data-source-cond",t))(ur||{});class hr{isTarget;id;name;type=(()=>ur.DEFAULT)();deps={};isCollectByDefault;constructor(t){this.isTarget=t.isTarget,this.id=t.id,this.name=t.name,this.isCollectByDefault=t.isCollectByDefault??!0,t.type&&(this.type=t.type),t.initialDeps&&(this.deps=t.initialDeps)}updateDep({id:t,name:e,key:n,data:r}){const i=this.deps[t]||{name:e,keys:[]};i.name=e,i.data=r,this.deps[t]=i,-1===i.keys.indexOf(n)&&i.keys.push(n)}removeDep(t,e){if(void 0===t)return void Object.keys(this.deps).forEach((t=>{delete this.deps[t]}));const n=this.deps[t];if(n)if(e){const r=n.keys.indexOf(e);n.keys.splice(r,1),0===n.keys.length&&delete this.deps[t]}else delete this.deps[t]}hasDep(t,e){const n=this.deps[t];return Boolean(n?.keys.find((t=>t===e)))}destroy(){this.deps={}}}const lr=(t,e)=>{let n=e;return t.some(((e,r)=>{const i=n.find((({name:t})=>t===e));return n=i?.fields||[],i&&"array"===i.type&&/^(?!\d+$).*$/.test(`${t[r+1]}`)&&r<t.length-1}))},dr=(t,e,n,r=!1)=>{if(`${e}`.startsWith(Fn))return!1;if("string"==typeof n)return((t,e,n=!1)=>{const r=t.match(cr)||[];if(r.length<=0)return!1;const i=[],s=[];return r.forEach((t=>{const n=t.substring(2,t.length-1),r=Jn(n),o=r.shift();o&&o===e.id&&(lr(r,e.fields)?i.push(t):s.push(t))})),n?i.length>0:s.length>0})(n,t,r);if(Gn(n)&&n?.isBindDataSource&&n.dataSourceId&&n.dataSourceId===t.id)return!0;if(((t,e)=>t?.isBindDataSourceField&&t.dataSourceId&&t.dataSourceId===e&&"string"==typeof t.template)(n,t.id))return!0;if(((t,e)=>{if(!Array.isArray(t)||"string"!=typeof t[0])return!1;const[n]=t,r=n.indexOf(or);return-1!==r&&n.substring(r+10)===e})(n,t.id)){const[,...e]=n,i=lr(e,t.fields);return r?i:!i}return!1},pr=(t,e,n)=>{Object.values(t).forEach((t=>{Object.values(t).forEach((t=>{n&&t.type!==n||e(t)}))}))};class fr{targetsList={};childrenProp="items";idProp="id";nameProp="name";constructor(t){t?.initialTargets&&(this.targetsList=t.initialTargets),t?.childrenProp&&(this.childrenProp=t.childrenProp)}getTargetsList(){return this.targetsList}getTargets(t=ur.DEFAULT){return this.targetsList[t]||{}}addTarget(t){const e=this.getTargets(t.type)||{};this.targetsList[t.type]=e,e[t.id]=t}getTarget(t,e=ur.DEFAULT){return this.getTargets(e)[t]}hasTarget(t,e=ur.DEFAULT){return Boolean(this.getTarget(t,e))}hasSpecifiedTypeTarget(t=ur.DEFAULT){return Object.keys(this.getTargets(t)).length>0}removeTarget(t,e=ur.DEFAULT){const n=this.getTargets(e);n[t]&&(n[t].destroy(),delete n[t])}removeTargets(t=ur.DEFAULT){const e=this.targetsList[t];if(e){for(const t of Object.values(e))t.destroy();delete this.targetsList[t]}}clearTargets(){Object.keys(this.targetsList).forEach((t=>{delete this.targetsList[t]}))}collect(t,e={},n=!1,r){this.collectByCallback(t,r,(({node:t,target:r})=>{this.removeTargetDep(r,t),this.collectItem(t,r,e,n)}))}collectByCallback(t,e,n){pr(this.targetsList,(r=>{(e||r.isCollectByDefault)&&t.forEach((t=>{n({node:t,target:r})}))}),e)}clear(t,e){let{targetsList:n}=this;e&&(n={[e]:this.getTargets(e)});const r=[];pr(n,(e=>{t?t.forEach((t=>{e.removeDep(t[this.idProp]),Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&!r.includes(t[this.idProp])&&(r.push(t[this.idProp]),this.clear(t[this.childrenProp]))})):e.removeDep()}))}clearByType(t,e){this.clear(e,t)}collectItem(t,e,n={},r=!1){const i=(s,o="")=>{const a=(s,a)=>{const c=s===this.childrenProp,u=o?`${o}.${s}`:s;e.isTarget(u,a)?e.updateDep({id:t[this.idProp],name:`${t[this.nameProp]||t[this.idProp]}`,data:n,key:u}):!c&&Array.isArray(a)?a.forEach(((t,e)=>{Gn(t)&&i(t,`${u}[${e}]`)})):Gn(a)&&i(a,u),c&&r&&Array.isArray(a)&&a.forEach((t=>{this.collectItem(t,e,n,r)}))};Object.entries(s).forEach((([t,e])=>{void 0!==e&&""!==e&&a(t,e)}))};i(t)}removeTargetDep(t,e,n){t.removeDep(e[this.idProp],n),void 0===n&&Array.isArray(e[this.childrenProp])&&e[this.childrenProp].length&&e[this.childrenProp].forEach((e=>{this.removeTargetDep(t,e,n)}))}}
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function gr(t,e,n,r){return new(n||(n=Promise))((function(e,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function o(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(t){t(r)}))).then(s,o)}a((r=r.apply(t,[])).next())}))}const yr=[];class br{constructor(t,e,n,r=void 0){this.obj=t,this.delimiter=e,this.wildcard=n,this.is_match=r}shortMatch(t,e){if(t===e)return!0;if(t===this.wildcard)return!0;if(this.is_match)return this.is_match(t,e);const n=t.indexOf(this.wildcard);if(n>-1){const r=t.substr(n+1);if(0===n||e.substring(0,n)===t.substring(0,n)){const t=r.length;return!(t>0)||e.substr(-t)===r}}return!1}match(t,e){return this.is_match?this.is_match(t,e):t===e||t===this.wildcard||e===this.wildcard||this.shortMatch(t,e)||function(t,e,n="*"){if(t===n)return!0;yr.length=0;let r=0,i=0,s=0,o=0;for(let l=0,d=t.length;l<d;l+=1){const e=t[l];e===n&&(r+=1,l>o&&yr.push(t.substring(o,l)),yr.push(e),o=l+1)}if(o<t.length&&yr.push(t.substring(o)),r?(i=t.length-r,s=1/0):s=i=t.length,0===yr.length)return t===e;const a=e.length;if(a<i||a>s)return!1;let c=yr.length-1,u=e.length-1,h=!1;for(;;){const t=yr[c];if(c-=1,t===n)h=!0;else{const n=u+1-t.length,r=e.lastIndexOf(t,n);if(-1===r||r>n)return!1;if(h)u=r-1,h=!1;else{if(r!==n)return!1;u-=t.length}}if(0>c)break}return!0}(t,e,this.wildcard)}handleArray(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);let c=0;for(const u of e){const e=c.toString(),n=""===r?e:r+this.delimiter+c;(a===this.wildcard||a===e||this.shortMatch(a,e))&&(o?i[n]=u:this.goFurther(t,u,s+1,n,i)),c++}return i}handleObject(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);for(let c in e){c=c.toString();const n=""===r?c:r+this.delimiter+c;(a===this.wildcard||a===c||this.shortMatch(a,c))&&(o?i[n]=e[c]:this.goFurther(t,e[c],s+1,n,i))}return i}goFurther(t,e,n,r,i={}){return Array.isArray(e)?this.handleArray(t,e,n,r,i):this.handleObject(t,e,n,r,i)}get(t){return this.goFurther(t,this.obj,0,"")}}class vr{static get(t,e,n=!1){if(!e)return;let r=e;for(const i of t)if(i in r)r=r[i];else{if(!n)return;r[i]=Object.create({}),r=r[i]}return r}static set(t,e,n){if(!n)return;if(0===t.length){for(const t in n)delete n[t];for(const t in e)n[t]=e[t];return}const r=t.slice(),i=r.pop(),s=vr.get(r,n,!0);return"object"==typeof s&&(s[i]=e),e}}let mr,wr=0,jr=null;function _r(){return null!==jr&&jr.buffer===mr.memory.buffer||(jr=new Uint8Array(mr.memory.buffer)),jr}let Or=new TextEncoder("utf-8");const Sr="function"==typeof Or.encodeInto?function(t,e){return Or.encodeInto(t,e)}:function(t,e){const n=Or.encode(t);return e.set(n),{read:t.length,written:n.length}};function Dr(t,e,n){if(void 0===n){const n=Or.encode(t),r=e(n.length);return _r().subarray(r,r+n.length).set(n),wr=n.length,r}let r=t.length,i=e(r);const s=_r();let o=0;for(;o<r;o++){const e=t.charCodeAt(o);if(e>127)break;s[i+o]=e}if(o!==r){0!==o&&(t=t.slice(o)),i=n(i,r,r=o+3*t.length);const e=_r().subarray(i+o,i+r);o+=Sr(t,e).written}return wr=o,i}function Ar(t,e){var n=Dr(t,mr.__wbindgen_malloc,mr.__wbindgen_realloc),r=wr,i=Dr(e,mr.__wbindgen_malloc,mr.__wbindgen_realloc),s=wr;return 0!==mr.is_match(n,r,i,s)}async function Er(t){("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:n}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if("application/wasm"==t.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,{});return mr=e.exports,Er.__wbindgen_wasm_module=n,mr}const $r={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function Cr(t,e){console.debug(t,e)}function Mr(t){return t&&t.constructor?"Object"===t.constructor.name:"object"==typeof t&&null!==t}class Ir{constructor(t={},e={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:Cr,Promise:Promise}),e),this.data=t,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=vr.get,this.pathSet=vr.set),e.Promise?this.resolved=e.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new br(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(t,e=this.data,n=!1){const r=t.join(this.options.delimiter),i=this.cache.get(r);if(i){const t=i.deref();if(t)return t}const s=vr.get(t,e,n);return(Mr(s)||Array.isArray(s))&&this.cache.set(r,new WeakRef(s)),s}cacheSet(t,e,n=this.data){const r=t.join(this.options.delimiter);return Mr(e)||Array.isArray(e)?this.cache.set(r,new WeakRef(e)):this.cache.delete(r),vr.set(t,e,n)}silentSet(t,e){return this.pathSet(this.split(t),e,this.data)}loadWasmMatcher(t){return gr(this,0,void 0,(function*(){yield Er(t),this.is_match=Ar,this.scan=new br(this.data,this.options.delimiter,this.options.wildcard,this.is_match)}))}same(t,e){return(["number","string","undefined","boolean"].includes(typeof t)||null===t)&&e===t}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(t,e,n=!0){return this.is_match?this.is_match(t,e):t===e||t===this.options.wildcard||e===this.options.wildcard||!(!n&&this.getIndicesCount(this.options.delimiter,t)<this.getIndicesCount(this.options.delimiter,e))&&this.scan.match(t,e)}getIndicesOf(t,e){if(this.options.useIndicesCache&&this.indices.has(e))return this.indices.get(e);const n=t.length;if(0==n)return[];let r,i=0,s=[];for(;(r=e.indexOf(t,i))>-1;)s.push(r),i=r+n;return this.options.useIndicesCache&&this.indices.set(e,s),s}getIndicesCount(t,e){if(this.options.useIndicesCache&&this.indicesCount.has(e))return this.indicesCount.get(e);const n=t.length;if(0==n)return 0;let r,i=0,s=0;for(;(r=e.indexOf(t,i))>-1;)s++,i=r+n;return this.options.useIndicesCache&&this.indicesCount.set(e,s),s}cutPath(t,e){if(""===e)return"";if((t=this.cleanNotRecursivePath(t))===(e=this.cleanNotRecursivePath(e)))return t;const n=this.getIndicesCount(this.options.delimiter,e),r=this.getIndicesOf(this.options.delimiter,t);return t.substring(0,r[n])}trimPath(t){return(t=this.cleanNotRecursivePath(t)).charAt(0)===this.options.delimiter?t.substr(1):t}split(t){if(""===t)return[];if(!this.options.useSplitCache)return t.split(this.options.delimiter);const e=this.splitCache.get(t);if(e)return e.slice();const n=t.split(this.options.delimiter);return this.splitCache.set(t,n.slice()),n}isWildcard(t){return t.includes(this.options.wildcard)||this.hasParams(t)}isNotRecursive(t){return t.endsWith(this.options.notRecursive)}cleanNotRecursivePath(t){return this.isNotRecursive(t)?t.substring(0,t.length-1):t}hasParams(t){return t.includes(this.options.param)}getParamsInfo(t){let e={replaced:"",original:t,params:{}},n=0,r=[];for(const i of this.split(t)){e.params[n]={original:i,replaced:"",name:""};const t=new RegExp(`\\${this.options.param}([^\\${this.options.delimiter}\\${this.options.param}]+)`,"g");let s=t.exec(i);s?(e.params[n].name=s[1],t.lastIndex=0,e.params[n].replaced=i.replace(t,this.options.wildcard),r.push(e.params[n].replaced),n++):(delete e.params[n],r.push(i),n++)}return e.replaced=r.join(this.options.delimiter),e}getParams(t,e){if(!t)return;const n=this.split(e),r={};for(const i in t.params)r[t.params[i].name]=n[i];return r}waitForAll(t,e){const n={};for(let r of t)n[r]={dirty:!1},this.hasParams(r)&&(n[r].paramsInfo=this.getParamsInfo(r)),n[r].isWildcard=this.isWildcard(r),n[r].isRecursive=!this.isNotRecursive(r);return this.waitingListeners.set(t,{fn:e,paths:n}),e(n),function(){this.waitingListeners.delete(t)}}executeWaitingListeners(t){if(!this.destroyed)for(const e of this.waitingListeners.values()){const{fn:n,paths:r}=e;let i=0,s=0;for(let e in r){const n=r[e];let o=!1;n.isRecursive&&(t=this.cutPath(t,e)),n.isWildcard&&this.match(e,t)&&(o=!0),t===e&&(o=!0),o&&(n.dirty=!0),n.dirty&&i++,s++}i===s&&n(r)}}subscribeAll(t,e,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let r=[],i=0,s=null;"boolean"==typeof n.group&&n.group?(this.groupId++,s=this.groupId,n.bulk=!0):"string"==typeof n.group&&(n.bulk=!0,s=n.group);for(const o of t)r.push(this.subscribe(o,e,n,{all:t,index:i,groupId:s})),i++;return function(){for(const t of r)t()}}getCleanListenersCollection(t={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},t)}getCleanListener(t,e=this.getDefaultListenerOptions()){return{fn:t,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),e),groupId:null}}getListenerCollectionMatch(t,e,n){t=this.cleanNotRecursivePath(t);const r=this;return function(i,s=!1){let o=t;return e?i=r.cutPath(i,t):o=r.cutPath(r.cleanNotRecursivePath(t),i),s&&console.log("[getListenerCollectionMatch]",{listenerPath:t,scopedListenerPath:o,path:i,isRecursive:e,isWildcard:n}),!(!n||!r.match(o,i,e))||o===i}}getListenersCollection(t,e){if(this.listeners.has(t)){let n=this.listeners.get(t);return n.listeners.set(++this.id,e),e.id=this.id,n}const n=this.hasParams(t);let r;n&&(r=this.getParamsInfo(t));let i={isRecursive:!this.isNotRecursive(t),isWildcard:this.isWildcard(t),hasParams:n,paramsInfo:r,originalPath:t,path:n?r.replaced:t};i.isRecursive||(i.path=this.cleanNotRecursivePath(i.path));let s=this.getCleanListenersCollection(Object.assign(Object.assign({},i),{match:this.getListenerCollectionMatch(i.path,i.isRecursive,i.isWildcard)}));return this.id++,s.listeners.set(this.id,e),e.id=this.id,this.listeners.set(i.originalPath,s),s}subscribe(t,e,n=this.getDefaultListenerOptions(),r={all:[t],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const i="subscribe";let s=this.getCleanListener(e,n);n.group&&(n.bulk=!0,"string"==typeof n.group?s.groupId=n.group:r.groupId&&(s.groupId=r.groupId)),this.listenersIgnoreCache.set(s,{truthy:[],falsy:[]});const o=this.getListenersCollection(t,s);n.debug&&console.log("[subscribe]",{listenerPath:t,options:n}),o.count++;let a=!0;if(s.groupId&&("string"==typeof s.groupId?this.namedGroups.includes(s.groupId)?a=!1:this.namedGroups.push(s.groupId):"number"==typeof s.groupId&&(this.numberGroups.includes(s.groupId)?a=!1:this.numberGroups.push(s.groupId))),a){const r=this.cleanNotRecursivePath(o.path),a=this.split(r);if(o.isWildcard){const a=this.scan.get(r);if(n.bulk){const r=[];for(const t in a)this.isMuted(t)||r.push({path:t,params:this.getParams(o.paramsInfo,t),value:a[t]});this.isMuted(e)||e(r,{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const r in a)this.isMuted(r)||this.isMuted(e)||e(a[r],{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(o.paramsInfo,r),options:n})}else this.isMuted(r)||this.isMuted(e)||e(this.pathGet(a,this.data),{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(t)},params:this.getParams(o.paramsInfo,r),options:n})}return this.debugSubscribe(s,o,t),this.jobsRunning--,this.unsubscribe(t,this.id)}unsubscribe(t,e){const n=this.listeners,r=n.get(t);return function(){r.listeners.delete(e),r.count--,0===r.count&&n.delete(t)}}runQueuedListeners(){if(!this.destroyed&&0!==this.subscribeQueue.length)if(0===this.jobsRunning){this.queueRuns=0;const t=[...this.subscribeQueue];for(let e=0,n=t.length;e<n;e++)t[e]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then((()=>this.runQueuedListeners())).catch((t=>{throw t}))}}getQueueNotifyListeners(t,e=[]){for(const n in t){if(this.isMuted(n))continue;let{single:r,bulk:i}=t[n];for(const t of r){let n=!1,r=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(r=t.listener.id+":"+t.eventInfo.path.listener);for(const t of e)if(r===t.resolvedIdPath){n=!0;break}if(n)continue;const i=this.debugTime(t);if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)}));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(i,t)}for(const t of i){let n=!1;for(const s of e)if(s.id===t.listener.id){n=!0;break}if(n)continue;const r=this.debugTime(t),i=[];for(const e of t.value)i.push(Object.assign(Object.assign({},e),{value:e.value?e.value():void 0}));if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>!this.jobsRunning&&(t.listener.fn(i,t.eventInfo),!0)));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(i,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(r,t)}}return Promise.resolve().then((()=>this.runQueuedListeners())),e}shouldIgnore(t,e){if(!t.options.ignore)return!1;for(const n of t.options.ignore){if(e.startsWith(n))return!0;if(this.is_match&&this.is_match(n,e))return!0;{const t=this.cutPath(e,n);if(this.match(n,t))return!0}}return!1}getSubscribedListeners(t,e,n,r="update",i=null){n=Object.assign(Object.assign({},$r),n);const s={};for(let[o,a]of this.listeners)if(a.match(t)){s[o]={single:[],bulk:[],bulkData:[]};const c=a.paramsInfo?this.getParams(a.paramsInfo,t):void 0,u=this.cutPath(t,o),h=a.isRecursive||a.isWildcard?()=>this.get(u):()=>e,l=[{value:h,path:t,params:c}];for(const e of a.listeners.values())this.shouldIgnore(e,t)?e.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:e,listenersCollection:a}):e.options.bulk?s[o].bulk.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:void 0},params:c,options:n},value:l}):s[o].single.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:this.cleanNotRecursivePath(t)},params:c,options:n},value:h})}else if(this.options.extraDebug){let e=!1;for(const n of a.listeners.values())n.options.debug&&(e=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:n,listenersCollection:a,updatePath:t}));e&&a.match(t,!0)}return s}notifySubscribedListeners(t,e,n,r="update",i=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(t,e,n,r,i))}useBulkValue(t){for(const[e,n]of t.listeners){if(n.options.bulk&&n.options.bulkValue)return!0;if(!n.options.bulk)return!0}return!1}getNestedListeners(t,e,n,r="update",i=null){const s={},o={};for(let[a,c]of this.listeners){if(!c.isRecursive)continue;const u=this.cutPath(a,t);if(this.match(u,t)){s[a]={single:[],bulk:[]};const h=this.trimPath(a.substr(u.length)),l=this.useBulkValue(c);let d;l&&(d=o[h]?o[h]:new br(e,this.options.delimiter,this.options.wildcard).get(h),o[h]=d);const p=c.paramsInfo?this.getParams(c.paramsInfo,t):void 0,f=[],g={};for(const[e,o]of c.listeners)if(l)for(const u in d){const h=()=>d[u],l=[t,u].join(this.options.delimiter),y={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:this.cleanNotRecursivePath(l)},params:p,options:n};this.shouldIgnore(o,t)||(o.options.bulk?(f.push({value:h,path:l,params:p}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:y,value:h}))}else{const u={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:void 0},params:p,options:n};if(this.shouldIgnore(o,t))continue;o.options.bulk?(f.push({value:void 0,path:void 0,params:p}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:u,value:void 0})}for(const e in g){const i=g[e],o={type:r,listener:i,listenersCollection:c,path:{listener:a,update:t,resolved:void 0},options:n,params:p};s[a].bulk.push({listener:i,listenersCollection:c,eventInfo:o,value:f})}}else if(this.options.extraDebug)for(const e of c.listeners.values())e.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:e,listenersCollection:c,currentCutPath:u,updatePath:t})}return s}notifyNestedListeners(t,e,n,r="update",i,s=null){return this.getQueueNotifyListeners(this.getNestedListeners(t,e,n,r,s),i)}getNotifyOnlyListeners(t,e,n,r="update",i=null){const s={};if("object"!=typeof n.only||!Array.isArray(n.only)||void 0===n.only[0]||!this.canBeNested(e))return s;for(const o of n.only){const a=new br(e,this.options.delimiter,this.options.wildcard).get(o);s[o]={bulk:[],single:[]};for(const e in a){const c=t+this.options.delimiter+e;for(const[u,h]of this.listeners){const l=h.paramsInfo?this.getParams(h.paramsInfo,c):void 0;if(this.match(u,c)){const d=()=>a[e],p=[{value:d,path:c,params:l}];for(const e of h.listeners.values()){const a={type:r,listener:e,listenersCollection:h,path:{listener:u,update:i||t,resolved:this.cleanNotRecursivePath(c)},params:l,options:n};this.shouldIgnore(e,t)||(e.options.bulk?s[o].bulk.some((t=>t.listener===e))||s[o].bulk.push({listener:e,listenersCollection:h,eventInfo:a,value:p}):s[o].single.push({listener:e,listenersCollection:h,eventInfo:a,value:d}))}}}}}return s}runQueue(t){const e=[];for(const n of t)n.options.group?e.includes(n.groupId)||(n.fn(),e.push(n.groupId)):n.fn()}sortAndRunQueue(t,e){t.sort((function(t,e){return t.id-e.id})),this.options.debug&&console.log(`[deep-state-observer] queue for ${e}`,t),this.runQueue(t)}notifyOnly(t,e,n,r="update",i=""){const s=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(t,e,n,r,i));this.sortAndRunQueue(s,t)}canBeNested(t){return"object"==typeof t&&null!==t}getUpdateValues(t,e){let n=e;return"function"==typeof e&&(n=e(t)),{newValue:n,oldValue:t}}wildcardNotify(t,e){let n=[];for(const r of t)this.getQueueNotifyListeners(r,n);for(const r of e)this.executeWaitingListeners(r);return this.jobsRunning--,n}wildcardUpdate(t,e,n=$r,r=!1){++this.jobsRunning,n=Object.assign(Object.assign({},$r),n);const i=this.scan.get(t),s={};for(const u in i){const t=this.split(u),{oldValue:r,newValue:o}=this.getUpdateValues(i[u],e);this.same(o,r)&&!n.force||(this.pathSet(t,o,this.data),s[u]=o)}const o=[],a=[];for(const u in s){const e=s[u];n.only.length?o.push(this.getNotifyOnlyListeners(u,e,n,"update",t)):(o.push(this.getSubscribedListeners(u,e,n,"update",t)),this.canBeNested(e)&&o.push(this.getNestedListeners(u,e,n,"update",t))),n.debug&&this.options.log("Wildcard update",{path:u,newValue:e}),a.push(u)}if(r){const e=this;return function(){const n=e.wildcardNotify(o,a);e.sortAndRunQueue(n,t)}}const c=this.wildcardNotify(o,a);this.sortAndRunQueue(c,t)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const t=this.updateQueue.shift();t.options.queue=!1,this.update(t.updatePath,t.fnOrValue,t.options,t.multi)}}updateNotify(t,e,n){const r=this.notifySubscribedListeners(t,e,n);this.canBeNested(e)&&this.notifyNestedListeners(t,e,n,"update",r),this.sortAndRunQueue(r,t),this.executeWaitingListeners(t)}updateNotifyAll(t){let e=[];for(const n of t){const t=n.newValue;if(this.tracing.length){const e=this.tracing[this.tracing.length-1],r=this.traceMap.get(e);r.changed.push({traceId:e,updatePath:n.updatePath,fnOrValue:t,options:n.options}),this.traceMap.set(e,r)}e=e.concat(this.notifySubscribedListeners(n.updatePath,t,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,t,n.options,"update",e)}this.runQueue(e)}updateNotifyOnly(t,e,n){this.notifyOnly(t,e,n),this.executeWaitingListeners(t)}update(t,e,n=Object.assign({},$r),r=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(t,e,n);if(this.tracing.length){const r=this.tracing[this.tracing.length-1],i=this.traceMap.get(r);i.changed.push({traceId:r,updatePath:t,fnOrValue:e,options:n}),this.traceMap.set(r,i)}const i=this.jobsRunning;if((this.options.queue||n.queue)&&i){if(i>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:t,fnOrValue:e,options:n,multi:r});const s=Promise.resolve().then((()=>{this.runUpdateQueue()}));return r?function(){return s}:s}if(this.isWildcard(t))return this.wildcardUpdate(t,e,n,r);++this.jobsRunning;const s=this.split(t),o=this.pathGet(s,this.data);let{oldValue:a,newValue:c}=this.getUpdateValues(o,e);if(n.debug&&this.options.log(`Updating ${t} ${n.source?`from ${n.source}`:""}`,{oldValue:a,newValue:c}),this.same(c,a)&&!n.force)return--this.jobsRunning,r?function(){return c}:c;if(this.pathSet(s,c,this.data),null===(n=Object.assign(Object.assign({},$r),n)).only)return--this.jobsRunning,r?function(){}:c;if(n.only.length){if(--this.jobsRunning,r){const e=this;return function(){return e.updateNotifyOnly(t,c,n)}}return this.updateNotifyOnly(t,c,n),c}if(r){--this.jobsRunning;const e=this;return function(){return e.updateNotify(t,c,n)}}return this.updateNotify(t,c,n),--this.jobsRunning,c}multi(t=!1){if(this.destroyed)return{update(){return this},done(){},getStack:()=>[]};if(this.collection)return this.collection;const e=this,n=[],r=[];return{update(i,s,o=$r){if(t){const t=e.split(i);let r=s;const a=e.pathGet(t,e.data);"function"==typeof r&&(r=r(a)),e.pathSet(t,r,e.data),n.push({updatePath:i,newValue:r,options:o})}else r.push(e.update(i,s,o,!0));return this},done(){if(0===e.collections){if(t)e.updateNotifyAll(n);else for(const t of r)t();n.length=0}},getStack:()=>n}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,0===this.collections&&this.collection){const t=this.collection;this.collection=null,t.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(t=void 0){if(!this.destroyed)return void 0===t||""===t?this.data:this.isWildcard(t)?this.scan.get(t):this.pathGet(this.split(t),this.data)}last(t){let e=this.lastExecs.get(t);e||(e={calls:0},this.lastExecs.set(t,e));const n=++e.calls;this.resolved.then((()=>{n===e.calls&&(this.lastExecs.set(t,{calls:0}),t())}))}isMuted(t){if(!this.options.useMute)return!1;if("function"==typeof t)return this.isMutedListener(t);for(const e of this.muted){const n=!this.isNotRecursive(e),r=this.trimPath(e);if(this.match(t,r))return!0;if(this.match(r,t))return!0;if(n){const n=this.cutPath(r,t);if(this.match(n,e))return!0;if(this.match(e,n))return!0}}return!1}isMutedListener(t){return this.mutedListeners.has(t)}mute(t){if("function"==typeof t)return this.mutedListeners.add(t);this.muted.add(t)}unmute(t){if("function"==typeof t)return this.mutedListeners.delete(t);this.muted.delete(t)}debugSubscribe(t,e,n){t.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:t,listenersCollection:e})}debugListener(t,e){(e.eventInfo.options.debug||e.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-t,info:e})}debugTime(t){return t.listener.options.debug||t.eventInfo.options.debug?Date.now():0}startTrace(t,e=null){this.traceId++;const n=this.traceId+":"+t;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map((t=>t)),additionalData:e,changed:[]}),this.tracing.push(n),n}stopTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),e}saveTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),this.savedTrace.push(e),e}getSavedTraces(){const t=this.savedTrace.map((t=>t));return t.sort(((t,e)=>t.sort-e.sort)),this.savedTrace=[],t}}var Lr="object"==typeof global&&global&&global.Object===Object&&global,xr="object"==typeof self&&self&&self.Object===Object&&self,Tr=Lr||xr||Function("return this")(),Pr=Tr.Symbol,kr=Object.prototype,Rr=kr.hasOwnProperty,Nr=kr.toString,zr=Pr?Pr.toStringTag:void 0,Fr=Object.prototype.toString,Wr="[object Null]",Ur="[object Undefined]",Vr=Pr?Pr.toStringTag:void 0;function qr(t){return null==t?void 0===t?Ur:Wr:Vr&&Vr in Object(t)?function(t){var e=Rr.call(t,zr),n=t[zr];try{t[zr]=void 0;var r=!0}catch(s){}var i=Nr.call(t);return r&&(e?t[zr]=n:delete t[zr]),i}(t):function(t){return Fr.call(t)}(t)}function Br(t){return null!=t&&"object"==typeof t}var Hr=Array.isArray;function Qr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Gr(t){return t}var Yr="[object AsyncFunction]",Jr="[object Function]",Kr="[object GeneratorFunction]",Zr="[object Proxy]";function Xr(t){if(!Qr(t))return!1;var e=qr(t);return e==Jr||e==Kr||e==Yr||e==Zr}var ti=Tr["__core-js_shared__"],ei=function(){var t=/[^.]+$/.exec(ti&&ti.keys&&ti.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ni=Function.prototype.toString;function ri(t){if(null!=t){try{return ni.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var ii=/^\[object .+?Constructor\]$/,si=Function.prototype,oi=Object.prototype,ai=si.toString,ci=oi.hasOwnProperty,ui=RegExp("^"+ai.call(ci).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hi(t){return!(!Qr(t)||(e=t,ei&&ei in e))&&(Xr(t)?ui:ii).test(ri(t));var e}function li(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return hi(n)?n:void 0}var di,pi,fi,gi=li(Tr,"WeakMap"),yi=Object.create,bi=function(){function t(){}return function(e){if(!Qr(e))return{};if(yi)return yi(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),vi=Date.now,mi=function(){try{var t=li(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),wi=mi?function(t,e){return mi(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Gr,ji=(di=wi,pi=0,fi=0,function(){var t=vi(),e=16-(t-fi);if(fi=t,e>0){if(++pi>=800)return arguments[0]}else pi=0;return di.apply(void 0,arguments)});function _i(t){return t!=t}function Oi(t,e){return!(null==t||!t.length)&&function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n){for(var r=t.length,i=n+-1;++i<r;)if(e(t[i],i,t))return i;return-1}(t,_i,n)}(t,e,0)>-1}var Si=9007199254740991,Di=/^(?:0|[1-9]\d*)$/;function Ai(t,e){var n=typeof t;return!!(e=null==e?Si:e)&&("number"==n||"symbol"!=n&&Di.test(t))&&t>-1&&t%1==0&&t<e}function Ei(t,e){return t===e||t!=t&&e!=e}var $i=Object.prototype.hasOwnProperty;function Ci(t,e,n){var r=t[e];$i.call(t,e)&&Ei(r,n)&&(void 0!==n||e in t)||function(t,e,n){"__proto__"==e&&mi?mi(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}(t,e,n)}var Mi=Math.max,Ii=9007199254740991;function Li(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Ii}function xi(t){return null!=t&&Li(t.length)&&!Xr(t)}var Ti=Object.prototype;function Pi(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ti)}function ki(t){return Br(t)&&"[object Arguments]"==qr(t)}var Ri=Object.prototype,Ni=Ri.hasOwnProperty,zi=Ri.propertyIsEnumerable,Fi=ki(function(){return arguments}())?ki:function(t){return Br(t)&&Ni.call(t,"callee")&&!zi.call(t,"callee")},Wi="object"==typeof t&&t&&!t.nodeType&&t,Ui=Wi&&"object"==typeof e&&e&&!e.nodeType&&e,Vi=Ui&&Ui.exports===Wi?Tr.Buffer:void 0,qi=(Vi?Vi.isBuffer:void 0)||function(){return!1},Bi={};function Hi(t){return function(e){return t(e)}}Bi["[object Float32Array]"]=Bi["[object Float64Array]"]=Bi["[object Int8Array]"]=Bi["[object Int16Array]"]=Bi["[object Int32Array]"]=Bi["[object Uint8Array]"]=Bi["[object Uint8ClampedArray]"]=Bi["[object Uint16Array]"]=Bi["[object Uint32Array]"]=!0,Bi["[object Arguments]"]=Bi["[object Array]"]=Bi["[object ArrayBuffer]"]=Bi["[object Boolean]"]=Bi["[object DataView]"]=Bi["[object Date]"]=Bi["[object Error]"]=Bi["[object Function]"]=Bi["[object Map]"]=Bi["[object Number]"]=Bi["[object Object]"]=Bi["[object RegExp]"]=Bi["[object Set]"]=Bi["[object String]"]=Bi["[object WeakMap]"]=!1;var Qi="object"==typeof t&&t&&!t.nodeType&&t,Gi=Qi&&"object"==typeof e&&e&&!e.nodeType&&e,Yi=Gi&&Gi.exports===Qi&&Lr.process,Ji=function(){try{var t=Gi&&Gi.require&&Gi.require("util").types;return t||Yi&&Yi.binding&&Yi.binding("util")}catch(e){}}(),Ki=Ji&&Ji.isTypedArray,Zi=Ki?Hi(Ki):function(t){return Br(t)&&Li(t.length)&&!!Bi[qr(t)]},Xi=Object.prototype.hasOwnProperty;function ts(t,e){var n=Hr(t),r=!n&&Fi(t),i=!n&&!r&&qi(t),s=!n&&!r&&!i&&Zi(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!Xi.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ai(u,c))||a.push(u);return a}function es(t,e){return function(n){return t(e(n))}}var ns=es(Object.keys,Object),rs=Object.prototype.hasOwnProperty;function is(t){return xi(t)?ts(t):function(t){if(!Pi(t))return ns(t);var e=[];for(var n in Object(t))rs.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var ss=li(Object,"create"),os=Object.prototype.hasOwnProperty,as=Object.prototype.hasOwnProperty;function cs(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function us(t,e){for(var n=t.length;n--;)if(Ei(t[n][0],e))return n;return-1}cs.prototype.clear=function(){this.__data__=ss?ss(null):{},this.size=0},cs.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},cs.prototype.get=function(t){var e=this.__data__;if(ss){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return os.call(e,t)?e[t]:void 0},cs.prototype.has=function(t){var e=this.__data__;return ss?void 0!==e[t]:as.call(e,t)},cs.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ss&&void 0===e?"__lodash_hash_undefined__":e,this};var hs=Array.prototype.splice;function ls(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ls.prototype.clear=function(){this.__data__=[],this.size=0},ls.prototype.delete=function(t){var e=this.__data__,n=us(e,t);return!(n<0||(n==e.length-1?e.pop():hs.call(e,n,1),--this.size,0))},ls.prototype.get=function(t){var e=this.__data__,n=us(e,t);return n<0?void 0:e[n][1]},ls.prototype.has=function(t){return us(this.__data__,t)>-1},ls.prototype.set=function(t,e){var n=this.__data__,r=us(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var ds=li(Tr,"Map");function ps(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function fs(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function gs(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}fs.prototype.clear=function(){this.size=0,this.__data__={hash:new cs,map:new(ds||ls),string:new cs}},fs.prototype.delete=function(t){var e=ps(this,t).delete(t);return this.size-=e?1:0,e},fs.prototype.get=function(t){return ps(this,t).get(t)},fs.prototype.has=function(t){return ps(this,t).has(t)},fs.prototype.set=function(t,e){var n=ps(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var ys=Pr?Pr.isConcatSpreadable:void 0;function bs(t){return Hr(t)||Fi(t)||!!(ys&&t&&t[ys])}var vs=es(Object.getPrototypeOf,Object);function ms(t){var e=this.__data__=new ls(t);this.size=e.size}ms.prototype.clear=function(){this.__data__=new ls,this.size=0},ms.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ms.prototype.get=function(t){return this.__data__.get(t)},ms.prototype.has=function(t){return this.__data__.has(t)},ms.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ls){var r=n.__data__;if(!ds||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new fs(r)}return n.set(t,e),this.size=n.size,this};var ws="object"==typeof t&&t&&!t.nodeType&&t,js=ws&&"object"==typeof e&&e&&!e.nodeType&&e,_s=js&&js.exports===ws?Tr.Buffer:void 0;_s&&_s.allocUnsafe;var Os=Object.prototype.propertyIsEnumerable,Ss=Object.getOwnPropertySymbols,Ds=Ss?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}(Ss(t),(function(e){return Os.call(t,e)})))}:function(){return[]};function As(t){return function(t,e,n){var r=e(t);return Hr(t)?r:gs(r,n(t))}(t,is,Ds)}var Es=li(Tr,"DataView"),$s=li(Tr,"Promise"),Cs=li(Tr,"Set"),Ms="[object Map]",Is="[object Promise]",Ls="[object Set]",xs="[object WeakMap]",Ts="[object DataView]",Ps=ri(Es),ks=ri(ds),Rs=ri($s),Ns=ri(Cs),zs=ri(gi),Fs=qr;(Es&&Fs(new Es(new ArrayBuffer(1)))!=Ts||ds&&Fs(new ds)!=Ms||$s&&Fs($s.resolve())!=Is||Cs&&Fs(new Cs)!=Ls||gi&&Fs(new gi)!=xs)&&(Fs=function(t){var e=qr(t),n="[object Object]"==e?t.constructor:void 0,r=n?ri(n):"";if(r)switch(r){case Ps:return Ts;case ks:return Ms;case Rs:return Is;case Ns:return Ls;case zs:return xs}return e});var Ws=Object.prototype.hasOwnProperty,Us=Tr.Uint8Array;function Vs(t){var e=new t.constructor(t.byteLength);return new Us(e).set(new Us(t)),e}var qs=/\w*$/,Bs=Pr?Pr.prototype:void 0,Hs=Bs?Bs.valueOf:void 0,Qs="[object Boolean]",Gs="[object Date]",Ys="[object Map]",Js="[object Number]",Ks="[object RegExp]",Zs="[object Set]",Xs="[object String]",to="[object Symbol]",eo="[object ArrayBuffer]",no="[object DataView]",ro="[object Float32Array]",io="[object Float64Array]",so="[object Int8Array]",oo="[object Int16Array]",ao="[object Int32Array]",co="[object Uint8Array]",uo="[object Uint8ClampedArray]",ho="[object Uint16Array]",lo="[object Uint32Array]";function po(t,e,n){var r,i,s,o,a,c=t.constructor;switch(e){case eo:return Vs(t);case Qs:case Gs:return new c(+t);case no:return a=Vs((o=t).buffer),new o.constructor(a,o.byteOffset,o.byteLength);case ro:case io:case so:case oo:case ao:case co:case uo:case ho:case lo:return function(t){var e=Vs(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case Ys:return new c;case Js:case Xs:return new c(t);case Ks:return(s=new(i=t).constructor(i.source,qs.exec(i))).lastIndex=i.lastIndex,s;case Zs:return new c;case to:return r=t,Hs?Object(Hs.call(r)):{}}}var fo=Ji&&Ji.isMap,go=fo?Hi(fo):function(t){return Br(t)&&"[object Map]"==Fs(t)},yo=Ji&&Ji.isSet,bo=yo?Hi(yo):function(t){return Br(t)&&"[object Set]"==Fs(t)},vo="[object Arguments]",mo="[object Function]",wo="[object GeneratorFunction]",jo="[object Object]",_o={};function Oo(t,e,n,r,i,s){var o;if(void 0!==o)return o;if(!Qr(t))return t;var a=Hr(t);if(a)o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ws.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t);else{var c=Fs(t),u=c==mo||c==wo;if(qi(t))return t.slice();if(c==jo||c==vo||u&&!i)o=u?{}:function(t){return"function"!=typeof t.constructor||Pi(t)?{}:bi(vs(t))}(t);else{if(!_o[c])return i?t:{};o=po(t,c)}}s||(s=new ms);var h=s.get(t);if(h)return h;s.set(t,o),bo(t)?t.forEach((function(r){o.add(Oo(r,e,n,0,t,s))})):go(t)&&t.forEach((function(r,i){o.set(i,Oo(r,e,n,0,t,s))}));var l=a?void 0:As(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(l||t,(function(r,i){l&&(r=t[i=r]),Ci(o,i,Oo(r,e,n,0,t,s))})),o}function So(t){return Oo(t,5)}function Do(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new fs;++e<n;)this.add(t[e])}function Ao(t,e){return t.has(e)}function Eo(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function $o(t){return Br(t)&&xi(t)}_o[vo]=_o["[object Array]"]=_o["[object ArrayBuffer]"]=_o["[object DataView]"]=_o["[object Boolean]"]=_o["[object Date]"]=_o["[object Float32Array]"]=_o["[object Float64Array]"]=_o["[object Int8Array]"]=_o["[object Int16Array]"]=_o["[object Int32Array]"]=_o["[object Map]"]=_o["[object Number]"]=_o[jo]=_o["[object RegExp]"]=_o["[object Set]"]=_o["[object String]"]=_o["[object Symbol]"]=_o["[object Uint8Array]"]=_o["[object Uint8ClampedArray]"]=_o["[object Uint16Array]"]=_o["[object Uint32Array]"]=!0,_o["[object Error]"]=_o[mo]=_o["[object WeakMap]"]=!1,Do.prototype.add=Do.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Do.prototype.has=function(t){return this.__data__.has(t)};var Co=Cs&&1/Eo(new Cs([,-0]))[1]==1/0?function(t){return new Cs(t)}:function(){},Mo=function(t,e){return ji(function(t,e,n){return e=Mi(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=Mi(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,a)}}(t,e,Gr),t+"")}((function(t){return function(t,e,n){var r=-1,i=Oi,s=t.length,o=!0,a=[],c=a;if(s>=200){var u=Co(t);if(u)return Eo(u);o=!1,i=Ao,c=new Do}else c=a;t:for(;++r<s;){var h=t[r],l=h;if(h=0!==h?h:0,o&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue t;a.push(h)}else i(c,l,n)||(c!==a&&c.push(l),a.push(h))}return a}(function(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=bs),i||(i=[]);++s<o;){var a=t[s];n(a)&&gs(i,a)}return i}(t,0,$o))}));class Io{}class Lo extends Io{data={};event=(()=>new j.EventEmitter)();constructor(t){super(),this.data=t}update(t,e){e?Zn(e,t,this.data):this.data=t;const n={updateData:t,path:e??""};e&&this.event.emit(e,n),this.event.emit("",n)}on(t,e){this.event.on(t,e)}off(t,e){this.event.off(t,e)}getData(t){return t?Kn(t,this.data):this.data}destroy(){}}class xo extends _{isInit=!1;app;mockData;#t="base";#e;#n;#r;#i=[];#s=[];constructor(t){super(),this.#e=t.schema.id,this.#n=t.schema,this.app=t.app,this.setFields(t.schema.fields),this.setMethods(t.schema.methods||[]);let e=t.initialData;const n=t.ObservedDataClass||Lo;if("editor"===this.app.platform)this.mockData=t.schema.mocks?.find((t=>t.useInEditor))?.data||this.getDefaultData(),e=So(this.mockData);else if("boolean"==typeof t.useMock&&t.useMock)this.mockData=t.schema.mocks?.find((t=>t.enable))?.data,e=this.mockData||this.getDefaultData();else{if(t.initialData)return this.#r=new n(t.initialData??{}),void(this.isInit=!0);e=this.getDefaultData()}this.#r=new n(e??{})}get id(){return this.#e}get type(){return this.#t}get schema(){return this.#n}get fields(){return this.#i}get methods(){return this.#s}setFields(t){this.#i=t}setMethods(t){this.#s=t}get data(){return this.#r.getData("")}setData(t,e){this.#r.update(t,e);const n={updateData:t,path:e};this.emit("change",n)}setValue(t,e){return this.setData(e,t)}onDataChange(t,e){this.#r.on(t,e)}offDataChange(t,e){this.#r.off(t,e)}getDefaultData(){return sr(this.#i)}async init(){this.isInit=!0}destroy(){this.#i=[],this.removeAllListeners(),this.#r.destroy()}}const To=t=>Object.entries(t).reduce(((t,[e,n])=>{let r=n;return"object"==typeof n&&(r=JSON.stringify(n)),void 0!==n?`${t}${t?"&":""}${globalThis.encodeURIComponent(e)}=${globalThis.encodeURIComponent(`${r}`)}`:t}),""),Po=async t=>{const{url:e,method:n="GET",headers:r={},params:i={},data:s={},...o}=t,a=To(i);let c=JSON.stringify(s);return r["Content-Type"]?.includes("application/x-www-form-urlencoded")&&(c=To(s)),(await globalThis.fetch(a?`${e}?${a}`:e,{method:n,headers:r,body:"GET"===n?void 0:c,...o})).json()},ko=new Map,Ro=(t,e)=>{const n=`${t.id}:${e.map((t=>t.id)).join(":")}`;if(ko.has(n))return ko.get(n);const r=new fr;r.addTarget(new hr({id:t.id,type:"data-source",isTarget:(e,n)=>!`${e}`.includes(nr)&&dr(t,e,n,!0)})),r.addTarget(new hr({id:t.id,type:"cond",isTarget:(e,n)=>((t,e,n,r=!1)=>{if(!Array.isArray(n)||!t)return!1;const[i,...s]=n;if(i!==t.id||!`${e}`.startsWith(Fn))return!1;if(t.fields?.find((t=>t.name===s[0]))){const e=lr(s,t.fields);return r?e:!e}return!1})(t,e,n,!0)})),r.collect(e,{},!0);const{deps:i}=r.getTarget(t.id,"data-source"),{deps:s}=r.getTarget(t.id,"cond"),o={deps:i,condDeps:s};return ko.set(n,o),o},No=(t,e)=>{let n=!0;for(const{op:i,value:s,range:o,field:a}of t){const[t,...c]=a,u=e[t];if(!u||!c.length)break;try{const t=Kn(c.join("."),u);if(!ir(i,t,s,o)){n=!1;break}}catch(r){console.warn(r)}}return n},zo=(t,e)=>{if(!t[Fn]||!Array.isArray(t[Fn])||!t[Fn].length)return!0;for(const{cond:n}of t[Fn])if(n&&No(n,e))return!0;return!1},Fo=(t,e)=>{if(Yn(t)||(t=>!!t&&Boolean(t.type?.toLowerCase()===zn.PAGE_FRAGMENT))(t)){const n=e.items?.findIndex((e=>e.id===t.id));e.items.splice(n,1,t)}else er(t,e.items)},Wo=(t,e,n=[],r={})=>{const i={...r,[e]:{}};let s=So(r[e]),o=i[e];return n.forEach(((e,r)=>{Object.assign(o,s),r!==n.length-1?(Array.isArray(s[e])&&(s[e]={},o[e]={}),s=s[e],o=o[e]):o[e]=t})),i},Uo=(t,e)=>t.replaceAll(cr,((t,n)=>{try{return Kn(n,e)}catch(r){return t}})),Vo=(t,e)=>"string"==typeof t?Uo(t,e):t?.isBindDataSource&&t.dataSourceId?e[t.dataSourceId]:t?.isBindDataSourceField&&t.dataSourceId&&"string"==typeof t.template?Uo(t.template,e[t.dataSourceId]):Array.isArray(t)&&"string"==typeof t[0]?((t,e)=>{const[n,...r]=t,i=n.indexOf(or);if(i>-1){const o=e[n.substring(i+10)];if(!o)return t;try{return Kn(r.join("."),o)}catch(s){return t}}return t})(t,e):t,qo=({compile:t,dsId:e,item:n,deps:r,condDeps:i,inEditor:s,ctxData:o})=>{const{items:a,...c}=n,u=So(c);return i[c.id]?.keys.length&&!s&&(u.condResult=zo(c,o)),Array.isArray(a)&&a.length?u.items=a.map((n=>qo({compile:t,dsId:e,item:n,deps:r,condDeps:i,inEditor:s,ctxData:o}))):a&&(u.items=a),r[u.id]?.keys.length?rr(t,u,{[e]:r},e):u};class Bo extends _{static dataSourceClassMap=(()=>new Map)();static ObservedDataClass=(()=>Lo)();static register(t,e){Bo.dataSourceClassMap.set(t,e)}static getDataSourceClass(t){return Bo.dataSourceClassMap.get(t)}static registerObservedData(t){Bo.ObservedDataClass=t}app;dataSourceMap=(()=>new Map)();data={};useMock=!1;constructor({app:t,useMock:e,initialData:n}){super(),this.app=t,this.useMock=e,n&&(this.data=n),t.dsl?.dataSources?.forEach((t=>{this.addDataSource(t)}));const r=Array.from(this.dataSourceMap);"function"==typeof Promise.allSettled?Promise.allSettled(r.map((([,t])=>this.init(t)))).then((t=>{const e={},n={};t.forEach(((t,i)=>{const s=r[i][0];"fulfilled"===t.status?e[s]=this.data[s]:"rejected"===t.status&&(n[s]=t.reason)})),this.emit("init",e,n)})):Promise.all(r.map((([,t])=>this.init(t)))).then((()=>{this.emit("init",this.data)})).catch((()=>{this.emit("init",this.data)}))}async init(t){if(!(t.isInit||this.app.jsEngine&&t.schema.disabledInitInJsEngine?.includes(this.app.jsEngine))){for(const e of t.methods){if("function"!=typeof e.content)return;"beforeInit"===e.timing&&e.content({params:{},dataSource:t,app:this.app})}await t.init(),t.methods.forEach((e=>{"function"==typeof e.content&&"afterInit"===e.timing&&e.content({params:{},dataSource:t,app:this.app})}))}}get(t){return this.dataSourceMap.get(t)}async addDataSource(t){if(!t)return;const e=new(Bo.dataSourceClassMap.get(t.type)||xo)({app:this.app,schema:t,request:this.app.request,useMock:this.useMock,initialData:this.data[t.id],ObservedDataClass:Bo.ObservedDataClass});this.dataSourceMap.set(t.id,e),this.data[e.id]=e.data,e.on("change",(t=>{this.setData(e,t)}))}setData(t,e){this.data[t.id]=t.data,this.emit("change",t.id,e)}removeDataSource(t){this.get(t)?.destroy(),delete this.data[t],this.dataSourceMap.delete(t)}updateSchema(t){t.forEach((t=>{if(!this.get(t.id))return;this.removeDataSource(t.id),this.addDataSource(t);const e=this.get(t.id);e&&this.init(e)}))}compiledNode({items:t,...e},n,r=!1){const i=So(e);return t&&(i.items=Array.isArray(t)&&r?t.map((t=>this.compiledNode(t,n,r))):t),!1===e.condResult||!1===e.visible?i:rr((t=>Vo(t,this.data)),i,this.app.dsl?.dataSourceDeps||{},n)}compliedConds(t){return zo(t,this.data)}compliedIteratorItemConds(t,e,n=[]){const[r,...i]=n,s=this.get(r);if(!s)return!0;const o=Wo(t,s.id,i,this.data);return zo(e,o)}compliedIteratorItems(t,e,n=[]){const[r,...i]=n,s=this.get(r);if(!s)return e;const o=Wo(t,s.id,i,this.data),{deps:a={},condDeps:c={}}=Ro(s.schema,e);return Object.keys(a).length||Object.keys(c).length?e.map((t=>qo({compile:t=>Vo(t,o),dsId:s.id,item:t,deps:a,condDeps:c,inEditor:"editor"===this.app.platform,ctxData:o}))):e}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach((t=>{t.destroy()})),this.dataSourceMap.clear()}onDataChange(t,e,n){return this.get(t)?.onDataChange(e,n)}offDataChange(t,e,n){return this.get(t)?.offDataChange(e,n)}}Bo.register("http",class extends xo{isLoading=!1;error;httpOptions;#o;#a=[];#c=[];#t="http";constructor(t){const{options:e}=t.schema;super(t),this.httpOptions=e,"function"==typeof t.request?this.#o=t.request:"function"==typeof globalThis.fetch&&(this.#o=Po),this.methods.forEach((t=>{"function"==typeof t.content&&("beforeRequest"===t.timing&&this.#a.push(t.content),"afterRequest"===t.timing&&this.#c.push(t.content))}))}get type(){return this.#t}async init(){this.schema.autoFetch&&await this.request(this.httpOptions),super.init()}async request(t={}){this.isLoading=!0;let e={...this.httpOptions,...t};try{for(const n of this.#a)await n({options:e,params:{},dataSource:this,app:this.app});"function"==typeof this.schema.beforeRequest&&(e=this.schema.beforeRequest(e,{app:this.app,dataSource:this}));let t=this.mockData?this.mockData:await(this.#o?.(e));for(const n of this.#c)await n({res:t,options:e,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.afterResponse&&(t=this.schema.afterResponse(t,{app:this.app,dataSource:this,options:e})),this.schema.responseOptions?.dataPath){const e=Kn(this.schema.responseOptions.dataPath,t);this.setData(e)}else this.setData(t);this.error=void 0}catch(n){this.error={msg:n.message},this.emit("error",n)}this.isLoading=!1}get(t){return this.request({...t,method:"GET"})}post(t){return this.request({...t,method:"POST"})}});class Ho{isIos=!1;isIphone=!1;isIpad=!1;isAndroid=!1;isAndroidPad=!1;isMac=!1;isWin=!1;isMqq=!1;isWechat=!1;isWeb=!1;isOpenHarmony=!1;constructor(t=globalThis.navigator.userAgent,e={}){this.isIphone=t.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(t),this.isIos=this.isIphone||this.isIpad,this.isAndroid=t.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&t.indexOf("Mobile")<0,this.isMac=t.indexOf("Macintosh")>=0,this.isWin=t.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(t),this.isWechat=t.indexOf("MicroMessenger")>=0&&t.indexOf("wxwork")<0,this.isOpenHarmony=t.includes("OpenHarmony"),this.isWeb=!(this.isIos||this.isAndroid||this.isOpenHarmony||/(WebOS|BlackBerry)/.test(t)),Object.entries(e).forEach((([t,e])=>{this[t]=e}))}}const Qo=(t,e)=>{if(!t)return{};let n={};const r={};n="string"==typeof t?(t=>{if("string"!=typeof t)return t;const e={};return t.split(";").forEach((t=>{if(!t)return;const n=t.split(":");let r=n.shift(),i=n.join(":");r&&(r=r.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/^\s*/,"").replace(/\s*$/,""),r=r.split("-").map(((t,e)=>e>0?`${t[0].toUpperCase()}${t.substr(1)}`:t)).join(""),e[r]=i)})),e})(t):{...t};const i="hippy"===e,s=["zIndex","opacity","fontWeight"];return Object.entries(n).forEach((([t,n])=>{"scale"===t&&!r.transform&&i?r.transform=[{scale:n}]:"backgroundImage"!==t||i?"transform"===t&&"string"!=typeof n?r[t]=((t,e)=>{if(!t)return[];const n=Object.entries(t).map((([t,n])=>n.trim()?("rotate"===t&&(t=>/^(-?\d+)(\.\d+)?$/.test(t))(n)&&(n=`${n}deg`),"hippy"!==e?`${t}(${n})`:{[t]:n}):""));if("hippy"===e)return n;const r=n.join(" ");return r.trim()?r:"none"})(n,e):!s.includes(t)&&n&&/^[-]?[0-9]*[.]?[0-9]*$/.test(n)?r[t]=i?n:n/100+"rem":r[t]=n:n&&(r[t]=(t=>!t||/^url/.test(t)||/^linear-gradient/.test(t)?t:`url(${t})`)(n))})),r},Go="magic:common:events:",Yo="magic:common:actions:",Jo="show",Ko="hide",Zo="scrollIntoView",Xo="scrollToTop",ta=(t,e)=>{if(!t)return;const n=qn(t);return n?e.getNode(n,t.dataset.tmagicIteratorContainerId?.split(","),t.dataset.tmagicIteratorIndex?.split(",").map((t=>globalThis.parseInt(t,10)))):ta(t.parentElement,e)};class ea extends j.EventEmitter{app;nodeEventList=(()=>new Map)();dataSourceEventList=(()=>new Map)();constructor({app:t}){super(),this.app=t,globalThis.document.body.addEventListener("click",this.commonClickEventHandler)}destroy(){this.removeNodeEvents(),this.removeAllListeners(),globalThis.document.body.removeEventListener("click",this.commonClickEventHandler)}bindNodeEvents(t){t.events?.forEach(((e,n)=>{let r=`${e.name}_${t.data.id}`;const i=e.name.split(".");i.length>1&&(r=`${i[1]}_${i[0]}`);let s=Symbol(r);t.eventKeys.has(r)?s=t.eventKeys.get(r):t.eventKeys.set(r,s);const o=(e,...r)=>{this.eventHandler(n,t,r)};this.nodeEventList.set(o,s),this.on(s,o)}))}removeNodeEvents(){Array.from(this.nodeEventList.keys()).forEach((t=>{const e=this.nodeEventList.get(t);e&&this.off(e,t)})),this.nodeEventList.clear()}bindDataSourceEvents(t){this.removeDataSourceEvents(t),t.forEach((t=>{const e=this.dataSourceEventList.get(t.id)??new Map;(t.schema.events||[]).forEach((n=>{const[r,...i]=n.name?.split(".")||[];if(!r)return;const s=(...e)=>{this.eventHandler(n,t,e)};e.set(n.name,s),r===ar?t?.onDataChange(i.join("."),s):t.on(r,s)})),this.dataSourceEventList.set(t.id,e)}))}removeDataSourceEvents(t){this.dataSourceEventList.size&&(t.forEach((t=>{const e=this.dataSourceEventList.get(t.id);e&&Array.from(e.keys()).forEach((n=>{const[r,...i]=n.split(".");r===ar?t.offDataChange(i.join("."),e.get(n)):t.off(r,e.get(n))}))})),this.dataSourceEventList.clear())}async eventHandler(t,e,n){const r="number"==typeof t?e.events[t]:t;if(kn(r,"actions")){const{actions:i}=r;for(let r=0;r<i.length;r++)if("number"==typeof t){const i=e.events[t].actions[r];this.actionHandler(i,e,n)}else this.actionHandler(i[r],e,n)}else await this.compActionHandler(r,e,n)}async actionHandler(t,e,n){if(t.actionType===Wn.COMP){const r=t;await this.compActionHandler(r,e,n)}else if(t.actionType===Wn.CODE){const e=t;await this.app.runCode(e.codeId,e.params||{},n)}else if(t.actionType===Wn.DATA_SOURCE){const e=t,[r,i]=e.dataSourceMethod;await this.app.runDataSourceMethod(r,i,e.params||{},n)}}async compActionHandler(t,e,n){if(!this.app.page)throw new Error("当前没有页面");let{method:r,to:i}=t;Array.isArray(r)&&([i,r]=r);const s=this.app.getNode(i);if(!s)throw`ID为${i}的组件不存在`;if((t=>t.startsWith(Yo))(r))return((t,e)=>{const{instance:n}=e;if(n)switch(t.replace(Yo,"")){case Jo:n.show();break;case Ko:n.hide();break;case Zo:n.$el?.scrollIntoView({behavior:"smooth"});break;case Xo:window.scrollTo({top:0,behavior:"smooth"})}})(r,s);s.instance?"function"==typeof s.instance[r]&&await s.instance[r](e,...n):s.addEventToQueue({method:r,fromCpt:e,args:n})}commonClickEventHandler=t=>{if(!t.target)return;const e=ta(t.target,this.app),n=`${r="click",r.startsWith(Go)?r:`${Go}${r}`}_${e?.data.id}`;var r;e?.eventKeys.has(n)&&this.emit(e.eventKeys.get(n),e)}}class na{designWidth=375;tid;constructor(t){"complete"===globalThis.document.readyState?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),void 0!==t?.designWidth&&this.setDesignWidth(t.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(t){this.designWidth=t,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:t}=document.documentElement.getBoundingClientRect(),e=t/(this.designWidth/100);globalThis.document.documentElement.style.fontSize=`${e}px`,globalThis.document.documentElement.style.fontSize=`${this.correctRem(e)}px`}correctRem(t){const{document:e}=globalThis,n=e.createElement("div");n.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",e.documentElement.appendChild(n);const r=n.offsetWidth;return e.documentElement.removeChild(n),Math.abs(r-t)>1?t**2/r:t}resizeHandler=()=>{clearTimeout(this.tid),this.tid=setTimeout((()=>{this.refreshRem()}),300)};pageshowHandler=t=>{t.persisted&&this.resizeHandler()}}class ra{data={};set(t,e){this.data[t]=e}get(t){return this.data[t]}}class ia extends j.EventEmitter{data;style;events=[];instance;page;parent;app;store=(()=>new ra)();eventKeys=(()=>new Map)();eventQueue=[];constructor(t){super(),this.page=t.page,this.parent=t.parent,this.app=t.app,this.setData(t.config),this.listenLifeSafe()}setData(t){this.data=t;const{events:e,style:n}=t;this.events=e||[],this.style=n||{},this.emit("update-data",t)}addEventToQueue(t){this.eventQueue.push(t)}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",(async t=>{this.once("destroy",(()=>{this.instance=null,"function"==typeof this.data.destroy&&this.data.destroy(this),this.listenLifeSafe()})),this.instance=t,await this.runHookCode("created")})),this.once("mounted",(async t=>{this.instance=t;for(let e=this.eventQueue.shift();e;e=this.eventQueue.shift())"function"==typeof t[e.method]&&await t[e.method](e.fromCpt,...e.args);await this.runHookCode("mounted")}))}async runHookCode(t){if("function"==typeof this.data[t])return void(await this.data[t](this));const e=this.data[t];if(e?.hookType===Un.CODE)for(const n of e.hookData){const{codeType:t=Vn.CODE,codeId:e,params:r={}}=n;let i;const s={app:this.app,params:r};if(t===Vn.CODE&&"string"==typeof e&&this.app.codeDsl?.[e])i=this.app.codeDsl[e].content;else if(t===Vn.DATA_SOURCE_METHOD&&Array.isArray(e)&&e.length>1){const t=this.app.dataSourceManager?.get(e[0]);i=t?.methods.find((t=>t.name===e[1]))?.content,s.dataSource=t}i&&"function"==typeof i&&await i(s)}}}class sa extends ia{nodes=[];setData(t){this.resetNodes(),super.setData(t)}resetNodes(){this.nodes?.forEach((t=>{t.forEach((t=>{t.destroy()}))})),this.nodes=[]}initNode(t,e,n){if(n.has(t.id)&&n.get(t.id)?.destroy(),t.type&&this.app.iteratorContainerType.has(t.type)){const r=new sa({config:t,parent:e,page:this.page,app:this.app});return n.set(t.id,r),void this.app.eventHelper?.bindNodeEvents(r)}const r=new ia({config:t,parent:e,page:this.page,app:this.app});if(this.app.eventHelper?.bindNodeEvents(r),n.set(t.id,r),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const e=this.app.dsl?.items?.find((e=>e.id===t.pageFragmentId));e&&(t.items=[e])}t.items?.forEach((t=>{this.initNode(t,r,n)}))}setNodes(t,e){const n=this.nodes[e]||new Map;t.forEach((t=>{this.initNode(t,this,n)})),this.nodes[e]=n}getNode(t,e){return this.nodes[e]?.get(t)}destroy(){super.destroy(),this.resetNodes()}}class oa extends ia{nodes=(()=>new Map)();constructor(t){super(t),this.setNode(t.config.id,this),t.config.items.forEach((t=>{this.initNode(t,this)}))}initNode(t,e){if(t.type&&this.app.iteratorContainerType.has(t.type))return void this.setNode(t.id,new sa({config:t,parent:e,page:this,app:this.app}));const n=new ia({config:t,parent:e,page:this,app:this.app});if(this.setNode(t.id,n),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const e=this.app.dsl?.items?.find((e=>e.id===t.pageFragmentId));e&&(t.items=[e])}t.items?.forEach((t=>{this.initNode(t,n)}))}getNode(t,e,n){if(this.nodes.has(t))return this.nodes.get(t);if(Array.isArray(e)&&e.length&&Array.isArray(n)){let r=this.nodes.get(e[0]);for(let t=1,i=e.length;t<i;t++)r=r?.getNode(e[t],n[t-1]);return r?.getNode(t,n[n.length-1])}}setNode(t,e){this.nodes.set(t,e)}deleteNode(t){this.nodes.delete(t)}destroy(){super.destroy(),this.nodes.clear()}}class aa extends j.EventEmitter{env=(()=>new Ho)();dsl;codeDsl;dataSourceManager;page;useMock=!1;platform="mobile";jsEngine="browser";components=(()=>new Map)();pageFragmentContainerType=(()=>new Set(["page-fragment-container"]))();iteratorContainerType=(()=>new Set(["iterator-container"]))();request;transformStyle;eventHelper;flexible;constructor(t){super(),this.setEnv(t.ua),this.codeDsl=t.config?.codeBlocks,t.platform&&(this.platform=t.platform),t.jsEngine&&(this.jsEngine=t.jsEngine),t.pageFragmentContainerType&&(Array.isArray(t.pageFragmentContainerType)?t.pageFragmentContainerType:[t.pageFragmentContainerType]).forEach((t=>{this.pageFragmentContainerType.add(t)})),t.iteratorContainerType&&(Array.isArray(t.iteratorContainerType)?t.iteratorContainerType:[t.iteratorContainerType]).forEach((t=>{this.iteratorContainerType.add(t)})),"boolean"==typeof t.useMock&&(this.useMock=t.useMock),"browser"===this.jsEngine&&(this.flexible=new na({designWidth:t.designWidth})),"editor"!==this.platform&&(this.eventHelper=new ea({app:this})),this.transformStyle=t.transformStyle||(t=>Qo(t,this.jsEngine)),t.request&&(this.request=t.request),t.config&&this.setConfig(t.config,t.curPage)}setEnv(t){this.env=new Ho(t)}setDesignWidth(t){this.flexible?.setDesignWidth(t)}setConfig(t,e){this.dsl=t,!e&&t.items.length&&(e=t.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=((t,e,n)=>{const{dsl:r,platform:i}=t;if(!r?.dataSources)return;const s=new Bo({app:t,useMock:e,initialData:n});return r.dataSources&&r.dataSourceCondDeps&&"editor"!==i&&Xn(tr(r.dataSourceCondDeps),r.items).forEach((t=>{t.condResult=s.compliedConds(t),Fo(t,r)})),r.dataSources&&r.dataSourceDeps&&Xn(tr(r.dataSourceDeps),r.items).forEach((t=>{Fo(s.compiledNode(t),r)})),"nodejs"!==t.jsEngine&&s.on("change",((e,n)=>{const i=r.dataSourceDeps?.[e]||{},o=r.dataSourceCondDeps?.[e]||{},a=Mo([...Object.keys(o),...Object.keys(i)]),c=t.page?.data&&"editor"!==t.platform?[t.page.data]:r.items;s.emit("update-data",Xn(a,c).map((e=>{"editor"!==t.platform&&(e.condResult=s.compliedConds(e));const n=s.compiledNode(e);if("function"==typeof t.page?.setData)if(Yn(n))t.page.setData(n);else{const r=t.page.getNode(e.id);r?.setData(n)}return n})),e,n)})),s})(this,this.useMock),this.codeDsl=t.codeBlocks,this.setPage(e||this.page?.data?.id);const n=Array.from(this.dataSourceManager.dataSourceMap.values());this.eventHelper?.bindDataSourceEvents(n)}setPage(t){const e=this.dsl?.items.find((e=>`${e.id}`==`${t}`));if(!e)return this.deletePage(),void super.emit("page-change");e!==this.page?.data&&(this.page?.destroy(),this.page=new oa({config:e,app:this}),this.eventHelper?.removeNodeEvents(),this.page.nodes.forEach((t=>{this.eventHelper?.bindNodeEvents(t)})),super.emit("page-change",this.page))}deletePage(){this.page?.destroy(),this.eventHelper?.removeNodeEvents(),this.page=void 0}getPage(t){return t?this.page&&`${this.page.data.id}`==`${t}`?this.page:void 0:this.page}getNode(t,e,n){return this.page?.getNode(t,e,n)}registerComponent(t,e){this.components.set(t,e)}unregisterComponent(t){this.components.delete(t)}resolveComponent(t){return this.components.get(t)}emit(t,...e){const[n,...r]=e;return this.eventHelper&&n instanceof ia&&n.data?.id&&n.eventKeys.has(`${String(t)}_${n.data.id}`)?this.eventHelper?.emit(n.eventKeys.get(`${String(t)}_${n.data.id}`),n,...r):super.emit(t,...e)}async runCode(t,e,n){if(!t||function(t){if(null==t)return!0;if(Ot(t)&&(z(t)||"string"==typeof t||"function"==typeof t.splice||Tt(t)||Ut(t)||Mt(t)))return!t.length;var e=Qe(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(Dt(t))return!Gt(t).length;for(var n in t)if(Rn.call(t,n))return!1;return!0}(this.codeDsl))return;const r=this.codeDsl?.[t]?.content;"function"==typeof r&&await r({app:this,params:e,eventParams:n})}async runDataSourceMethod(t,e,n,r){if(!t||!e)return;const i=this.dataSourceManager?.get(t);if(!i)return;const s=(i.methods||[]).find((t=>t.name===e));s&&"function"==typeof s.content&&await s.content({app:this,params:n,dataSource:i,eventParams:r})}destroy(){this.removeAllListeners(),this.page=void 0,this.flexible?.destroy(),this.flexible=void 0,this.eventHelper?.destroy()}}const ca=(t,e=window)=>{const n=VueDemi.ref(),r=VueDemi.ref(),i=VueDemi.ref(),s=VueDemi.computed((()=>n.value?.items?.find((t=>t.id===r.value))||n.value?.items?.[0]));return VueDemi.watch(s,(async()=>{await VueDemi.nextTick();const t=document.querySelector(".magic-ui-page");t&&e.magic?.onPageElUpdate(t)})),e.magic?.onRuntimeReady({getApp:()=>t,updateRootConfig(e){n.value=e,t?.setConfig(e,r.value)},updatePageId(e){r.value=e,t?.setPage(e)},select(e){i.value=e,t?.getPage(e)&&this.updatePageId?.(e);const n=Hn()(document,`${e}`);return n||VueDemi.nextTick().then((()=>Hn()(document,`${e}`)))},add({config:e,parentId:r}){if(!n.value)throw new Error("error");if(!i.value)throw new Error("error");if(!r)throw new Error("error");const s=Qn(r,[n.value]).pop();if(!s)throw new Error("未找到父节点");if("page"!==e.type){const n=t?.page?.getNode(s.id);n&&t?.page?.initNode(e,n)}if(s.id!==i.value){const t=s.items?.findIndex((t=>t.id===i.value));s.items?.splice(t+1,0,e)}else s.items?.push(e)},update({config:e,parentId:r}){if(!n.value||!t)throw new Error("error");const i=t.dataSourceManager?.compiledNode(e,void 0,!0)||e;er(VueDemi.reactive(i),[n.value],r);const s=t.getNode(e.id);s&&s.setData(i),t.page?.data.id===e.id&&t.page.setData(i)},remove({id:e,parentId:r}){if(!n.value)throw new Error("error");const i=Qn(e,[n.value]).pop();if(!i)throw new Error("未找到目标元素");const s=Qn(r,[n.value]).pop();if(!s)throw new Error("未找到父元素");"page"===i.type?t?.deletePage():t?.page?.deleteNode(i.id);const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1)}}),{pageConfig:s}},ua=Vue.defineComponent({__name:"App",setup(t){const e=Vue.inject("app"),{pageConfig:n}=ca(e);return(t,e)=>{const r=Vue.resolveComponent("magic-ui-page");return Vue.unref(n)?(Vue.openBlock(),Vue.createBlock(r,{key:Vue.unref(n).id,config:Vue.unref(n)},null,8,["config"])):Vue.createCommentVNode("",!0)}}});Bo.registerObservedData(class extends Io{state;subscribers=(()=>new Map)();constructor(t){super(),this.state=new Ir(t)}update=(t,e)=>{this.state?.update(e??"",t)};on=(t,e)=>{const n=this.state.subscribe(t,(t=>{let e=0;return(...n)=>{if(0!==e)return t(...n);e+=1}})(e)),r=this.subscribers.get(t)??new Map;r.set(e,n),this.subscribers.set(t,r)};off=(t,e)=>{const n=this.subscribers.get(t);n&&(n.get(e)?.(),n.delete(e))};getData=t=>this.state?this.state?.get(t):{};destroy=()=>{this.subscribers.forEach((t=>{t.forEach((t=>t()))}))}}),Promise.all([r((()=>e.import("./comp-entry-legacy-BXoqZcr0.js"))),r((()=>e.import("./plugin-entry-legacy-Du67ziIl.js"))),r((()=>e.import("./datasource-entry-legacy-Du67ziIl.js")))]).then((([t,e,n])=>{const r=Vue.createApp(ua),i=new aa({ua:window.navigator.userAgent,platform:"editor"});i.env.isWeb&&i.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(t.default).forEach((([t,e])=>{r.component(`magic-ui-${t}`,e)})),Object.entries(n.default).forEach((([t,e])=>{Bo.register(t,e)})),Object.values(e.default).forEach((t=>{r.use(t,{app:i})})),window.appInstance=i,r.config.globalProperties.app=i,r.provide("app",i),r.mount("#app")}))}}}));
//# sourceMappingURL=index-legacy-CVy2I8wN.js.map
