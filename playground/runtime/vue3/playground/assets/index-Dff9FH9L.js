const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/comp-entry-CvKOmN5P.js","assets/comp-entry-CvQ1UB0Q.css"])))=>i.map(i=>d[i]);
var Bs=Object.defineProperty;var mr=e=>{throw TypeError(e)};var zs=(e,r,t)=>r in e?Bs(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var d=(e,r,t)=>zs(e,typeof r!="symbol"?r+"":r,t),yr=(e,r,t)=>r.has(e)||mr("Cannot "+t);var F=(e,r,t)=>(yr(e,r,"read from private field"),t?t.call(e):r.get(e)),z=(e,r,t)=>r.has(e)?mr("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),G=(e,r,t,n)=>(yr(e,r,"write to private field"),n?n.call(e,t):r.set(e,t),t);function Hd(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const Gs="modulepreload",qs=function(e){return"/tmagic-editor/playground/runtime/vue3/playground/"+e},br={},xt=function(r,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.all(t.map(a=>{if(a=qs(a),a in br)return;br[a]=!0;const c=a.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(a,'"]').concat(u)))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Gs,c||(f.as="script",f.crossOrigin=""),f.href=a,i&&f.setAttribute("nonce",i),document.head.appendChild(f),c)return new Promise((l,h)=>{f.addEventListener("load",l),f.addEventListener("error",()=>h(new Error("Unable to preload CSS for ".concat(a))))})}))}return s.then(()=>r()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})};var An=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Vt={exports:{}},Ee=typeof Reflect=="object"?Reflect:null,vr=Ee&&typeof Ee.apply=="function"?Ee.apply:function(r,t,n){return Function.prototype.apply.call(r,t,n)},ft;Ee&&typeof Ee.ownKeys=="function"?ft=Ee.ownKeys:Object.getOwnPropertySymbols?ft=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:ft=function(r){return Object.getOwnPropertyNames(r)};function Ks(e){console&&console.warn&&console.warn(e)}var Cn=Number.isNaN||function(r){return r!==r};function j(){j.init.call(this)}Vt.exports=j;Vt.exports.once=Xs;j.EventEmitter=j;j.prototype._events=void 0;j.prototype._eventsCount=0;j.prototype._maxListeners=void 0;var $r=10;function _t(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(j,"defaultMaxListeners",{enumerable:!0,get:function(){return $r},set:function(e){if(typeof e!="number"||e<0||Cn(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");$r=e}});j.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};j.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||Cn(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function In(e){return e._maxListeners===void 0?j.defaultMaxListeners:e._maxListeners}j.prototype.getMaxListeners=function(){return In(this)};j.prototype.emit=function(r){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=r==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=o[r];if(c===void 0)return!1;if(typeof c=="function")vr(c,this,t);else for(var u=c.length,f=Pn(c,u),n=0;n<u;++n)vr(f[n],this,t);return!0};function Dn(e,r,t,n){var s,o,i;if(_t(t),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",r,t.listener?t.listener:t),o=e._events),i=o[r]),i===void 0)i=o[r]=t,++e._eventsCount;else if(typeof i=="function"?i=o[r]=n?[t,i]:[i,t]:n?i.unshift(t):i.push(t),s=In(e),s>0&&i.length>s&&!i.warned){i.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=r,a.count=i.length,Ks(a)}return e}j.prototype.addListener=function(r,t){return Dn(this,r,t,!1)};j.prototype.on=j.prototype.addListener;j.prototype.prependListener=function(r,t){return Dn(this,r,t,!0)};function Vs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xn(e,r,t){var n={fired:!1,wrapFn:void 0,target:e,type:r,listener:t},s=Vs.bind(n);return s.listener=t,n.wrapFn=s,s}j.prototype.once=function(r,t){return _t(t),this.on(r,xn(this,r,t)),this};j.prototype.prependOnceListener=function(r,t){return _t(t),this.prependListener(r,xn(this,r,t)),this};j.prototype.removeListener=function(r,t){var n,s,o,i,a;if(_t(t),s=this._events,s===void 0)return this;if(n=s[r],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[r],s.removeListener&&this.emit("removeListener",r,n.listener||t));else if(typeof n!="function"){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;o===0?n.shift():Ys(n,o),n.length===1&&(s[r]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",r,a||t)}return this};j.prototype.off=j.prototype.removeListener;j.prototype.removeAllListeners=function(r){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[r]),this;if(arguments.length===0){var o=Object.keys(n),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[r],typeof t=="function")this.removeListener(r,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(r,t[s]);return this};function Mn(e,r,t){var n=e._events;if(n===void 0)return[];var s=n[r];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?Js(s):Pn(s,s.length)}j.prototype.listeners=function(r){return Mn(this,r,!0)};j.prototype.rawListeners=function(r){return Mn(this,r,!1)};j.listenerCount=function(e,r){return typeof e.listenerCount=="function"?e.listenerCount(r):Ln.call(e,r)};j.prototype.listenerCount=Ln;function Ln(e){var r=this._events;if(r!==void 0){var t=r[e];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}j.prototype.eventNames=function(){return this._eventsCount>0?ft(this._events):[]};function Pn(e,r){for(var t=new Array(r),n=0;n<r;++n)t[n]=e[n];return t}function Ys(e,r){for(;r+1<e.length;r++)e[r]=e[r+1];e.pop()}function Js(e){for(var r=new Array(e.length),t=0;t<r.length;++t)r[t]=e[t].listener||e[t];return r}function Xs(e,r){return new Promise(function(t,n){function s(i){e.removeListener(r,o),n(i)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",s),t([].slice.call(arguments))}Nn(e,r,o,{once:!0}),r!=="error"&&Zs(e,s,{once:!0})})}function Zs(e,r,t){typeof e.on=="function"&&Nn(e,"error",r,t)}function Nn(e,r,t,n){if(typeof e.on=="function")n.once?e.once(r,t):e.on(r,t);else if(typeof e.addEventListener=="function")e.addEventListener(r,function s(o){n.once&&e.removeEventListener(r,s),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var nt=Vt.exports;const Rn=Qs(nt);var Fn=typeof global=="object"&&global&&global.Object===Object&&global,ei=typeof self=="object"&&self&&self.Object===Object&&self,K=Fn||ei||Function("return this")(),se=K.Symbol,Un=Object.prototype,ti=Un.hasOwnProperty,ri=Un.toString,We=se?se.toStringTag:void 0;function ni(e){var r=ti.call(e,We),t=e[We];try{e[We]=void 0;var n=!0}catch(o){}var s=ri.call(e);return n&&(r?e[We]=t:delete e[We]),s}var si=Object.prototype,ii=si.toString;function oi(e){return ii.call(e)}var ai="[object Null]",ci="[object Undefined]",wr=se?se.toStringTag:void 0;function Me(e){return e==null?e===void 0?ci:ai:wr&&wr in Object(e)?ni(e):oi(e)}function Le(e){return e!=null&&typeof e=="object"}var ui="[object Symbol]";function Yt(e){return typeof e=="symbol"||Le(e)&&Me(e)==ui}function fi(e,r){for(var t=-1,n=e==null?0:e.length,s=Array(n);++t<n;)s[t]=r(e[t],t,e);return s}var oe=Array.isArray,li=1/0,_r=se?se.prototype:void 0,Tr=_r?_r.toString:void 0;function Hn(e){if(typeof e=="string")return e;if(oe(e))return fi(e,Hn)+"";if(Yt(e))return Tr?Tr.call(e):"";var r=e+"";return r=="0"&&1/e==-li?"-0":r}function de(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var hi="[object AsyncFunction]",di="[object Function]",pi="[object GeneratorFunction]",gi="[object Proxy]";function Wn(e){if(!de(e))return!1;var r=Me(e);return r==di||r==pi||r==hi||r==gi}var Mt=K["__core-js_shared__"],Or=function(){var e=/[^.]+$/.exec(Mt&&Mt.keys&&Mt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function mi(e){return!!Or&&Or in e}var yi=Function.prototype,bi=yi.toString;function ye(e){if(e!=null){try{return bi.call(e)}catch(r){}try{return e+""}catch(r){}}return""}var vi=/[\\^$.*+?()[\]{}|]/g,$i=/^\[object .+?Constructor\]$/,wi=Function.prototype,_i=Object.prototype,Ti=wi.toString,Oi=_i.hasOwnProperty,Si=RegExp("^"+Ti.call(Oi).replace(vi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ji(e){if(!de(e)||mi(e))return!1;var r=Wn(e)?Si:$i;return r.test(ye(e))}function Ei(e,r){return e==null?void 0:e[r]}function be(e,r){var t=Ei(e,r);return ji(t)?t:void 0}var Ht=be(K,"WeakMap"),Sr=Object.create,Ai=function(){function e(){}return function(r){if(!de(r))return{};if(Sr)return Sr(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}();function Ci(e,r){var t=-1,n=e.length;for(r||(r=Array(n));++t<n;)r[t]=e[t];return r}var jr=function(){try{var e=be(Object,"defineProperty");return e({},"",{}),e}catch(r){}}();function Ii(e,r){for(var t=-1,n=e==null?0:e.length;++t<n&&r(e[t],t,e)!==!1;);return e}var Di=9007199254740991,xi=/^(?:0|[1-9]\d*)$/;function Jt(e,r){var t=typeof e;return r=r==null?Di:r,!!r&&(t=="number"||t!="symbol"&&xi.test(e))&&e>-1&&e%1==0&&e<r}function kn(e,r,t){r=="__proto__"&&jr?jr(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}function Bn(e,r){return e===r||e!==e&&r!==r}var Mi=Object.prototype,Li=Mi.hasOwnProperty;function Xt(e,r,t){var n=e[r];(!(Li.call(e,r)&&Bn(n,t))||t===void 0&&!(r in e))&&kn(e,r,t)}function Tt(e,r,t,n){var s=!t;t||(t={});for(var o=-1,i=r.length;++o<i;){var a=r[o],c=void 0;c===void 0&&(c=e[a]),s?kn(t,a,c):Xt(t,a,c)}return t}var Pi=9007199254740991;function Zt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Pi}function er(e){return e!=null&&Zt(e.length)&&!Wn(e)}var Ni=Object.prototype;function Ot(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||Ni;return e===t}function Ri(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}var Fi="[object Arguments]";function Er(e){return Le(e)&&Me(e)==Fi}var zn=Object.prototype,Ui=zn.hasOwnProperty,Hi=zn.propertyIsEnumerable,tr=Er(function(){return arguments}())?Er:function(e){return Le(e)&&Ui.call(e,"callee")&&!Hi.call(e,"callee")};function Wi(){return!1}var Gn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ar=Gn&&typeof module=="object"&&module&&!module.nodeType&&module,ki=Ar&&Ar.exports===Gn,Cr=ki?K.Buffer:void 0,Bi=Cr?Cr.isBuffer:void 0,rr=Bi||Wi,zi="[object Arguments]",Gi="[object Array]",qi="[object Boolean]",Qi="[object Date]",Ki="[object Error]",Vi="[object Function]",Yi="[object Map]",Ji="[object Number]",Xi="[object Object]",Zi="[object RegExp]",eo="[object Set]",to="[object String]",ro="[object WeakMap]",no="[object ArrayBuffer]",so="[object DataView]",io="[object Float32Array]",oo="[object Float64Array]",ao="[object Int8Array]",co="[object Int16Array]",uo="[object Int32Array]",fo="[object Uint8Array]",lo="[object Uint8ClampedArray]",ho="[object Uint16Array]",po="[object Uint32Array]",x={};x[io]=x[oo]=x[ao]=x[co]=x[uo]=x[fo]=x[lo]=x[ho]=x[po]=!0;x[zi]=x[Gi]=x[no]=x[qi]=x[so]=x[Qi]=x[Ki]=x[Vi]=x[Yi]=x[Ji]=x[Xi]=x[Zi]=x[eo]=x[to]=x[ro]=!1;function go(e){return Le(e)&&Zt(e.length)&&!!x[Me(e)]}function nr(e){return function(r){return e(r)}}var qn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Be=qn&&typeof module=="object"&&module&&!module.nodeType&&module,mo=Be&&Be.exports===qn,Lt=mo&&Fn.process,Ie=function(){try{var e=Be&&Be.require&&Be.require("util").types;return e||Lt&&Lt.binding&&Lt.binding("util")}catch(r){}}(),Ir=Ie&&Ie.isTypedArray,Qn=Ir?nr(Ir):go,yo=Object.prototype,bo=yo.hasOwnProperty;function Kn(e,r){var t=oe(e),n=!t&&tr(e),s=!t&&!n&&rr(e),o=!t&&!n&&!s&&Qn(e),i=t||n||s||o,a=i?Ri(e.length,String):[],c=a.length;for(var u in e)(r||bo.call(e,u))&&!(i&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Jt(u,c)))&&a.push(u);return a}function Vn(e,r){return function(t){return e(r(t))}}var vo=Vn(Object.keys,Object),$o=Object.prototype,wo=$o.hasOwnProperty;function Yn(e){if(!Ot(e))return vo(e);var r=[];for(var t in Object(e))wo.call(e,t)&&t!="constructor"&&r.push(t);return r}function sr(e){return er(e)?Kn(e):Yn(e)}function _o(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}var To=Object.prototype,Oo=To.hasOwnProperty;function So(e){if(!de(e))return _o(e);var r=Ot(e),t=[];for(var n in e)n=="constructor"&&(r||!Oo.call(e,n))||t.push(n);return t}function ir(e){return er(e)?Kn(e,!0):So(e)}var jo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Eo=/^\w*$/;function Ao(e,r){if(oe(e))return!1;var t=typeof e;return t=="number"||t=="symbol"||t=="boolean"||e==null||Yt(e)?!0:Eo.test(e)||!jo.test(e)||r!=null&&e in Object(r)}var qe=be(Object,"create");function Co(){this.__data__=qe?qe(null):{},this.size=0}function Io(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var Do="__lodash_hash_undefined__",xo=Object.prototype,Mo=xo.hasOwnProperty;function Lo(e){var r=this.__data__;if(qe){var t=r[e];return t===Do?void 0:t}return Mo.call(r,e)?r[e]:void 0}var Po=Object.prototype,No=Po.hasOwnProperty;function Ro(e){var r=this.__data__;return qe?r[e]!==void 0:No.call(r,e)}var Fo="__lodash_hash_undefined__";function Uo(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=qe&&r===void 0?Fo:r,this}function pe(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}pe.prototype.clear=Co;pe.prototype.delete=Io;pe.prototype.get=Lo;pe.prototype.has=Ro;pe.prototype.set=Uo;function Ho(){this.__data__=[],this.size=0}function St(e,r){for(var t=e.length;t--;)if(Bn(e[t][0],r))return t;return-1}var Wo=Array.prototype,ko=Wo.splice;function Bo(e){var r=this.__data__,t=St(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():ko.call(r,t,1),--this.size,!0}function zo(e){var r=this.__data__,t=St(r,e);return t<0?void 0:r[t][1]}function Go(e){return St(this.__data__,e)>-1}function qo(e,r){var t=this.__data__,n=St(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function Z(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Z.prototype.clear=Ho;Z.prototype.delete=Bo;Z.prototype.get=zo;Z.prototype.has=Go;Z.prototype.set=qo;var Qe=be(K,"Map");function Qo(){this.size=0,this.__data__={hash:new pe,map:new(Qe||Z),string:new pe}}function Ko(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function jt(e,r){var t=e.__data__;return Ko(r)?t[typeof r=="string"?"string":"hash"]:t.map}function Vo(e){var r=jt(this,e).delete(e);return this.size-=r?1:0,r}function Yo(e){return jt(this,e).get(e)}function Jo(e){return jt(this,e).has(e)}function Xo(e,r){var t=jt(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function ae(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ae.prototype.clear=Qo;ae.prototype.delete=Vo;ae.prototype.get=Yo;ae.prototype.has=Jo;ae.prototype.set=Xo;var Zo="Expected a function";function or(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError(Zo);var t=function(){var n=arguments,s=r?r.apply(this,n):n[0],o=t.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return t.cache=o.set(s,i)||o,i};return t.cache=new(or.Cache||ae),t}or.Cache=ae;var ea=500;function ta(e){var r=or(e,function(n){return t.size===ea&&t.clear(),n}),t=r.cache;return r}var ra=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,na=/\\(\\)?/g,sa=ta(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(ra,function(t,n,s,o){r.push(s?o.replace(na,"$1"):n||t)}),r});function ia(e){return e==null?"":Hn(e)}function Jn(e,r){return oe(e)?e:Ao(e,r)?[e]:sa(ia(e))}var oa=1/0;function Xn(e){if(typeof e=="string"||Yt(e))return e;var r=e+"";return r=="0"&&1/e==-oa?"-0":r}function Zn(e,r){for(var t=-1,n=r.length,s=e.length;++t<n;)e[s+t]=r[t];return e}var es=Vn(Object.getPrototypeOf,Object);function aa(){this.__data__=new Z,this.size=0}function ca(e){var r=this.__data__,t=r.delete(e);return this.size=r.size,t}function ua(e){return this.__data__.get(e)}function fa(e){return this.__data__.has(e)}var la=200;function ha(e,r){var t=this.__data__;if(t instanceof Z){var n=t.__data__;if(!Qe||n.length<la-1)return n.push([e,r]),this.size=++t.size,this;t=this.__data__=new ae(n)}return t.set(e,r),this.size=t.size,this}function Pe(e){var r=this.__data__=new Z(e);this.size=r.size}Pe.prototype.clear=aa;Pe.prototype.delete=ca;Pe.prototype.get=ua;Pe.prototype.has=fa;Pe.prototype.set=ha;function da(e,r){return e&&Tt(r,sr(r),e)}function pa(e,r){return e&&Tt(r,ir(r),e)}var ts=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dr=ts&&typeof module=="object"&&module&&!module.nodeType&&module,ga=Dr&&Dr.exports===ts,xr=ga?K.Buffer:void 0,Mr=xr?xr.allocUnsafe:void 0;function ma(e,r){if(r)return e.slice();var t=e.length,n=Mr?Mr(t):new e.constructor(t);return e.copy(n),n}function ya(e,r){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var i=e[t];r(i,t,e)&&(o[s++]=i)}return o}function rs(){return[]}var ba=Object.prototype,va=ba.propertyIsEnumerable,Lr=Object.getOwnPropertySymbols,ar=Lr?function(e){return e==null?[]:(e=Object(e),ya(Lr(e),function(r){return va.call(e,r)}))}:rs;function $a(e,r){return Tt(e,ar(e),r)}var wa=Object.getOwnPropertySymbols,ns=wa?function(e){for(var r=[];e;)Zn(r,ar(e)),e=es(e);return r}:rs;function _a(e,r){return Tt(e,ns(e),r)}function ss(e,r,t){var n=r(e);return oe(e)?n:Zn(n,t(e))}function Ta(e){return ss(e,sr,ar)}function Oa(e){return ss(e,ir,ns)}var Wt=be(K,"DataView"),kt=be(K,"Promise"),Bt=be(K,"Set"),Pr="[object Map]",Sa="[object Object]",Nr="[object Promise]",Rr="[object Set]",Fr="[object WeakMap]",Ur="[object DataView]",ja=ye(Wt),Ea=ye(Qe),Aa=ye(kt),Ca=ye(Bt),Ia=ye(Ht),Q=Me;(Wt&&Q(new Wt(new ArrayBuffer(1)))!=Ur||Qe&&Q(new Qe)!=Pr||kt&&Q(kt.resolve())!=Nr||Bt&&Q(new Bt)!=Rr||Ht&&Q(new Ht)!=Fr)&&(Q=function(e){var r=Me(e),t=r==Sa?e.constructor:void 0,n=t?ye(t):"";if(n)switch(n){case ja:return Ur;case Ea:return Pr;case Aa:return Nr;case Ca:return Rr;case Ia:return Fr}return r});var Da=Object.prototype,xa=Da.hasOwnProperty;function Ma(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&xa.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var Hr=K.Uint8Array;function cr(e){var r=new e.constructor(e.byteLength);return new Hr(r).set(new Hr(e)),r}function La(e,r){var t=r?cr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var Pa=/\w*$/;function Na(e){var r=new e.constructor(e.source,Pa.exec(e));return r.lastIndex=e.lastIndex,r}var Wr=se?se.prototype:void 0,kr=Wr?Wr.valueOf:void 0;function Ra(e){return kr?Object(kr.call(e)):{}}function Fa(e,r){var t=r?cr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var Ua="[object Boolean]",Ha="[object Date]",Wa="[object Map]",ka="[object Number]",Ba="[object RegExp]",za="[object Set]",Ga="[object String]",qa="[object Symbol]",Qa="[object ArrayBuffer]",Ka="[object DataView]",Va="[object Float32Array]",Ya="[object Float64Array]",Ja="[object Int8Array]",Xa="[object Int16Array]",Za="[object Int32Array]",ec="[object Uint8Array]",tc="[object Uint8ClampedArray]",rc="[object Uint16Array]",nc="[object Uint32Array]";function sc(e,r,t){var n=e.constructor;switch(r){case Qa:return cr(e);case Ua:case Ha:return new n(+e);case Ka:return La(e,t);case Va:case Ya:case Ja:case Xa:case Za:case ec:case tc:case rc:case nc:return Fa(e,t);case Wa:return new n;case ka:case Ga:return new n(e);case Ba:return Na(e);case za:return new n;case qa:return Ra(e)}}function ic(e){return typeof e.constructor=="function"&&!Ot(e)?Ai(es(e)):{}}var oc="[object Map]";function ac(e){return Le(e)&&Q(e)==oc}var Br=Ie&&Ie.isMap,cc=Br?nr(Br):ac,uc="[object Set]";function fc(e){return Le(e)&&Q(e)==uc}var zr=Ie&&Ie.isSet,lc=zr?nr(zr):fc,hc=1,dc=2,pc=4,is="[object Arguments]",gc="[object Array]",mc="[object Boolean]",yc="[object Date]",bc="[object Error]",os="[object Function]",vc="[object GeneratorFunction]",$c="[object Map]",wc="[object Number]",as="[object Object]",_c="[object RegExp]",Tc="[object Set]",Oc="[object String]",Sc="[object Symbol]",jc="[object WeakMap]",Ec="[object ArrayBuffer]",Ac="[object DataView]",Cc="[object Float32Array]",Ic="[object Float64Array]",Dc="[object Int8Array]",xc="[object Int16Array]",Mc="[object Int32Array]",Lc="[object Uint8Array]",Pc="[object Uint8ClampedArray]",Nc="[object Uint16Array]",Rc="[object Uint32Array]",I={};I[is]=I[gc]=I[Ec]=I[Ac]=I[mc]=I[yc]=I[Cc]=I[Ic]=I[Dc]=I[xc]=I[Mc]=I[$c]=I[wc]=I[as]=I[_c]=I[Tc]=I[Oc]=I[Sc]=I[Lc]=I[Pc]=I[Nc]=I[Rc]=!0;I[bc]=I[os]=I[jc]=!1;function lt(e,r,t,n,s,o){var i,a=r&hc,c=r&dc,u=r&pc;if(i!==void 0)return i;if(!de(e))return e;var f=oe(e);if(f){if(i=Ma(e),!a)return Ci(e,i)}else{var l=Q(e),h=l==os||l==vc;if(rr(e))return ma(e,a);if(l==as||l==is||h&&!s){if(i=c||h?{}:ic(e),!a)return c?_a(e,pa(i,e)):$a(e,da(i,e))}else{if(!I[l])return s?e:{};i=sc(e,l,a)}}o||(o=new Pe);var p=o.get(e);if(p)return p;o.set(e,i),lc(e)?e.forEach(function(_){i.add(lt(_,r,t,_,e,o))}):cc(e)&&e.forEach(function(_,A){i.set(A,lt(_,r,t,A,e,o))});var v=u?c?Oa:Ta:c?ir:sr,b=f?void 0:v(e);return Ii(b||e,function(_,A){b&&(A=_,_=e[A]),Xt(i,A,lt(_,r,t,A,e,o))}),i}var Fc=1,Uc=4;function Hc(e){return lt(e,Fc|Uc)}function Wc(e,r,t){r=Jn(r,e);for(var n=-1,s=r.length,o=!1;++n<s;){var i=Xn(r[n]);if(!(o=e!=null&&t(e,i)))break;e=e[i]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&Zt(s)&&Jt(i,s)&&(oe(e)||tr(e)))}var kc=Object.prototype,Bc=kc.hasOwnProperty;function zc(e,r){return e!=null&&Bc.call(e,r)}function Gc(e,r){return e!=null&&Wc(e,r,zc)}var qc="[object Map]",Qc="[object Set]",Kc=Object.prototype,Vc=Kc.hasOwnProperty;function Yc(e){if(e==null)return!0;if(er(e)&&(oe(e)||typeof e=="string"||typeof e.splice=="function"||rr(e)||Qn(e)||tr(e)))return!e.length;var r=Q(e);if(r==qc||r==Qc)return!e.size;if(Ot(e))return!Yn(e).length;for(var t in e)if(Vc.call(e,t))return!1;return!0}function Jc(e,r,t,n){if(!de(e))return e;r=Jn(r,e);for(var s=-1,o=r.length,i=o-1,a=e;a!=null&&++s<o;){var c=Xn(r[s]),u=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=i){var f=a[c];u=void 0,u===void 0&&(u=de(f)?f:Jt(r[s+1])?[]:{})}Xt(a,c,u),a=a[c]}return e}function Xc(e,r,t){return e==null?e:Jc(e,r,t)}var Zc={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(An,function(){var t=1e3,n=6e4,s=36e5,o="millisecond",i="second",a="minute",c="hour",u="day",f="week",l="month",h="quarter",p="year",v="date",b="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,A=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,E={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(w){var y=["th","st","nd","rd"],g=w%100;return"["+w+(y[(g-20)%10]||y[g]||y[0])+"]"}},P=function(w,y,g){var $=String(w);return!$||$.length>=y?w:""+Array(y+1-$.length).join(g)+w},ce={s:P,z:function(w){var y=-w.utcOffset(),g=Math.abs(y),$=Math.floor(g/60),m=g%60;return(y<=0?"+":"-")+P($,2,"0")+":"+P(m,2,"0")},m:function w(y,g){if(y.date()<g.date())return-w(g,y);var $=12*(g.year()-y.year())+(g.month()-y.month()),m=y.clone().add($,l),T=g-m<0,O=y.clone().add($+(T?-1:1),l);return+(-($+(g-m)/(T?m-O:O-m))||0)},a:function(w){return w<0?Math.ceil(w)||0:Math.floor(w)},p:function(w){return{M:l,y:p,w:f,d:u,D:v,h:c,m:a,s:i,ms:o,Q:h}[w]||String(w||"").toLowerCase().replace(/s$/,"")},u:function(w){return w===void 0}},W="en",k={};k[W]=E;var _e="$isDayjsObject",Fe=function(w){return w instanceof it||!(!w||!w[_e])},te=function w(y,g,$){var m;if(!y)return W;if(typeof y=="string"){var T=y.toLowerCase();k[T]&&(m=T),g&&(k[T]=g,m=T);var O=y.split("-");if(!m&&O.length>1)return w(O[0])}else{var C=y.name;k[C]=y,m=C}return!$&&m&&(W=m),m||!$&&W},N=function(w,y){if(Fe(w))return w.clone();var g=typeof y=="object"?y:{};return g.date=w,g.args=arguments,new it(g)},S=ce;S.l=te,S.i=Fe,S.w=function(w,y){return N(w,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var it=function(){function w(g){this.$L=te(g.locale,null,!0),this.parse(g),this.$x=this.$x||g.x||{},this[_e]=!0}var y=w.prototype;return y.parse=function(g){this.$d=function($){var m=$.date,T=$.utc;if(m===null)return new Date(NaN);if(S.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var O=m.match(_);if(O){var C=O[2]-1||0,L=(O[7]||"0").substring(0,3);return T?new Date(Date.UTC(O[1],C,O[3]||1,O[4]||0,O[5]||0,O[6]||0,L)):new Date(O[1],C,O[3]||1,O[4]||0,O[5]||0,O[6]||0,L)}}return new Date(m)}(g),this.init()},y.init=function(){var g=this.$d;this.$y=g.getFullYear(),this.$M=g.getMonth(),this.$D=g.getDate(),this.$W=g.getDay(),this.$H=g.getHours(),this.$m=g.getMinutes(),this.$s=g.getSeconds(),this.$ms=g.getMilliseconds()},y.$utils=function(){return S},y.isValid=function(){return this.$d.toString()!==b},y.isSame=function(g,$){var m=N(g);return this.startOf($)<=m&&m<=this.endOf($)},y.isAfter=function(g,$){return N(g)<this.startOf($)},y.isBefore=function(g,$){return this.endOf($)<N(g)},y.$g=function(g,$,m){return S.u(g)?this[$]:this.set(m,g)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(g,$){var m=this,T=!!S.u($)||$,O=S.p(g),C=function(fe,H){var re=S.w(m.$u?Date.UTC(m.$y,H,fe):new Date(m.$y,H,fe),m);return T?re:re.endOf(u)},L=function(fe,H){return S.w(m.toDate()[fe].apply(m.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(H)),m)},R=this.$W,U=this.$M,B=this.$D,Te="set"+(this.$u?"UTC":"");switch(O){case p:return T?C(1,0):C(31,11);case l:return T?C(1,U):C(0,U+1);case f:var ue=this.$locale().weekStart||0,Ue=(R<ue?R+7:R)-ue;return C(T?B-Ue:B+(6-Ue),U);case u:case v:return L(Te+"Hours",0);case c:return L(Te+"Minutes",1);case a:return L(Te+"Seconds",2);case i:return L(Te+"Milliseconds",3);default:return this.clone()}},y.endOf=function(g){return this.startOf(g,!1)},y.$set=function(g,$){var m,T=S.p(g),O="set"+(this.$u?"UTC":""),C=(m={},m[u]=O+"Date",m[v]=O+"Date",m[l]=O+"Month",m[p]=O+"FullYear",m[c]=O+"Hours",m[a]=O+"Minutes",m[i]=O+"Seconds",m[o]=O+"Milliseconds",m)[T],L=T===u?this.$D+($-this.$W):$;if(T===l||T===p){var R=this.clone().set(v,1);R.$d[C](L),R.init(),this.$d=R.set(v,Math.min(this.$D,R.daysInMonth())).$d}else C&&this.$d[C](L);return this.init(),this},y.set=function(g,$){return this.clone().$set(g,$)},y.get=function(g){return this[S.p(g)]()},y.add=function(g,$){var m,T=this;g=Number(g);var O=S.p($),C=function(U){var B=N(T);return S.w(B.date(B.date()+Math.round(U*g)),T)};if(O===l)return this.set(l,this.$M+g);if(O===p)return this.set(p,this.$y+g);if(O===u)return C(1);if(O===f)return C(7);var L=(m={},m[a]=n,m[c]=s,m[i]=t,m)[O]||1,R=this.$d.getTime()+g*L;return S.w(R,this)},y.subtract=function(g,$){return this.add(-1*g,$)},y.format=function(g){var $=this,m=this.$locale();if(!this.isValid())return m.invalidDate||b;var T=g||"YYYY-MM-DDTHH:mm:ssZ",O=S.z(this),C=this.$H,L=this.$m,R=this.$M,U=m.weekdays,B=m.months,Te=m.meridiem,ue=function(H,re,He,ot){return H&&(H[re]||H($,T))||He[re].slice(0,ot)},Ue=function(H){return S.s(C%12||12,H,"0")},fe=Te||function(H,re,He){var ot=H<12?"AM":"PM";return He?ot.toLowerCase():ot};return T.replace(A,function(H,re){return re||function(He){switch(He){case"YY":return String($.$y).slice(-2);case"YYYY":return S.s($.$y,4,"0");case"M":return R+1;case"MM":return S.s(R+1,2,"0");case"MMM":return ue(m.monthsShort,R,B,3);case"MMMM":return ue(B,R);case"D":return $.$D;case"DD":return S.s($.$D,2,"0");case"d":return String($.$W);case"dd":return ue(m.weekdaysMin,$.$W,U,2);case"ddd":return ue(m.weekdaysShort,$.$W,U,3);case"dddd":return U[$.$W];case"H":return String(C);case"HH":return S.s(C,2,"0");case"h":return Ue(1);case"hh":return Ue(2);case"a":return fe(C,L,!0);case"A":return fe(C,L,!1);case"m":return String(L);case"mm":return S.s(L,2,"0");case"s":return String($.$s);case"ss":return S.s($.$s,2,"0");case"SSS":return S.s($.$ms,3,"0");case"Z":return O}return null}(H)||O.replace(":","")})},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(g,$,m){var T,O=this,C=S.p($),L=N(g),R=(L.utcOffset()-this.utcOffset())*n,U=this-L,B=function(){return S.m(O,L)};switch(C){case p:T=B()/12;break;case l:T=B();break;case h:T=B()/3;break;case f:T=(U-R)/6048e5;break;case u:T=(U-R)/864e5;break;case c:T=U/s;break;case a:T=U/n;break;case i:T=U/t;break;default:T=U}return m?T:S.a(T)},y.daysInMonth=function(){return this.endOf(l).$D},y.$locale=function(){return k[this.$L]},y.locale=function(g,$){if(!g)return this.$L;var m=this.clone(),T=te(g,$,!0);return T&&(m.$L=T),m},y.clone=function(){return S.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},w}(),gr=it.prototype;return N.prototype=gr,[["$ms",o],["$s",i],["$m",a],["$H",c],["$W",u],["$M",l],["$y",p],["$D",v]].forEach(function(w){gr[w[1]]=function(y){return this.$g(y,w[0],w[1])}}),N.extend=function(w,y){return w.$i||(w(y,it,N),w.$i=!0),N},N.locale=te,N.isDayjs=Fe,N.unix=function(w){return N(1e3*w)},N.en=k[W],N.Ls=k,N.p={},N})})(Zc);var eu={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(An,function(){var t="minute",n=/[+-]\d\d(?::?\d\d)?/g,s=/([+-]|\d\d)/g;return function(o,i,a){var c=i.prototype;a.utc=function(b){var _={date:b,utc:!0,args:arguments};return new i(_)},c.utc=function(b){var _=a(this.toDate(),{locale:this.$L,utc:!0});return b?_.add(this.utcOffset(),t):_},c.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var u=c.parse;c.parse=function(b){b.utc&&(this.$u=!0),this.$utils().u(b.$offset)||(this.$offset=b.$offset),u.call(this,b)};var f=c.init;c.init=function(){if(this.$u){var b=this.$d;this.$y=b.getUTCFullYear(),this.$M=b.getUTCMonth(),this.$D=b.getUTCDate(),this.$W=b.getUTCDay(),this.$H=b.getUTCHours(),this.$m=b.getUTCMinutes(),this.$s=b.getUTCSeconds(),this.$ms=b.getUTCMilliseconds()}else f.call(this)};var l=c.utcOffset;c.utcOffset=function(b,_){var A=this.$utils().u;if(A(b))return this.$u?0:A(this.$offset)?l.call(this):this.$offset;if(typeof b=="string"&&(b=function(W){W===void 0&&(W="");var k=W.match(n);if(!k)return null;var _e=(""+k[0]).match(s)||["-",0,0],Fe=_e[0],te=60*+_e[1]+ +_e[2];return te===0?0:Fe==="+"?te:-te}(b),b===null))return this;var E=Math.abs(b)<=16?60*b:b,P=this;if(_)return P.$offset=E,P.$u=b===0,P;if(b!==0){var ce=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(P=this.local().add(E+ce,t)).$offset=E,P.$x.$localOffset=ce}else P=this.utc();return P};var h=c.format;c.format=function(b){var _=b||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,_)},c.valueOf=function(){var b=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*b},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var p=c.toDate;c.toDate=function(b){return b==="s"&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():p.call(this)};var v=c.diff;c.diff=function(b,_,A){if(b&&this.$u===b.$u)return v.call(this,b,_,A);var E=this.local(),P=a(b).local();return v.call(E,P,_,A)}}})})(eu);var ur=(e=>(e.CONTAINER="container",e.PAGE="page",e.ROOT="app",e.PAGE_FRAGMENT="page-fragment",e))(ur||{});const Se="displayConds";var ht=(e=>(e.COMP="comp",e.CODE="code",e.DATA_SOURCE="data-source",e))(ht||{}),cs=(e=>(e.CODE="code",e))(cs||{}),dt=(e=>(e.CODE="code",e.DATA_SOURCE_METHOD="data-source-method",e))(dt||{});const us={getIdFromEl:e=>{var r;return(r=e==null?void 0:e.dataset)==null?void 0:r.tmagicId},getElById:(e,r)=>e==null?void 0:e.querySelector('[data-tmagic-id="'.concat(r,'"]')),setIdToEl:(e,r)=>{e.dataset.tmagicId="".concat(r)}},tu=()=>us.getIdFromEl,Gr=()=>us.getElById,ze=(e,r=[])=>{const t=[],n=function(s,o){if(!Array.isArray(o))return null;for(let i=0,a=o.length;i<a;i++){const c=o[i];if(t.push(c),"".concat(c.id)==="".concat(s))return c;if(c.items){const u=n(s,c.items);if(u)return u}t.pop()}return null};return n(e,r),t},Ke=e=>Object.prototype.toString.call(e)==="[object Object]",fs=e=>{var r;return e?((r=e.type)==null?void 0:r.toLowerCase())===ur.PAGE:!1},ru=e=>{var r;return e?((r=e.type)==null?void 0:r.toLowerCase())===ur.PAGE_FRAGMENT:!1},fr=e=>"".concat(e).replaceAll(/\[(\d+)\]/g,".$1").split("."),ge=(e="",r={})=>(Array.isArray(e)?e:fr(e)).reduce((n,s)=>{if(Ke(n)||Array.isArray(n)&&/^\d*$/.test("".concat(s)))return n[s];throw new Error("".concat(r,"中不存在").concat(e))},r),zt=(e,r,t={})=>Xc(t,e,r),Pt=(e,r=[])=>{const t=[],n=function(s,o){if(Array.isArray(o))for(let i=0,a=o.length;i<a;i++){const c=o[i],u=s.findIndex(f=>"".concat(f)==="".concat(c.id));u>-1&&(s.slice(u,1),t.push(c)),c.items&&n(s,c.items)}};return n(e,r),t},nu=(e={},r)=>Array.from(Object.values(e).reduce((t,n)=>{var s;return(((s=n[r])==null?void 0:s.keys)||[]).forEach(o=>t.add(o)),t},new Set)),qr=(e={})=>Array.from(Object.values(e).reduce((r,t)=>(Object.keys(t).forEach(n=>{r.add(n)}),r),new Set)),ls=(e,r,t)=>{var a;const n=ze(e.id,r),s=n.pop();let o=n.pop();if(t&&(o=ze(t,r).pop()),!s)throw new Error("未找到目标节点");if(!o)throw new Error("未找到父节点");const i=(a=o.items)==null?void 0:a.findIndex(c=>c.id===s.id);o.items.splice(i,1,e)},hs="__tmagic__",ds=(e,r,t={},n)=>{let s=[];if(!n)s=nu(t,r.id);else{const o=t[n];s=(o==null?void 0:o[r.id].keys)||[]}return s.forEach(o=>{const i=fr(o),a=i.map((f,l)=>l<i.length-1?f:"".concat(hs).concat(f));let c=ge(a,r);if(typeof c>"u")try{const f=ge(o,r);zt(a.join("."),f,r),c=f}catch(f){console.warn(f);return}let u;try{u=e(c)}catch(f){console.error(f),u=""}zt(o,u,r)}),r},su=(e,r,t,n=[])=>{var s,o;switch(typeof r=="string"&&typeof t>"u"&&(t=""),e){case"is":return r===t;case"not":return r!==t;case"=":return r===t;case"!=":return r!==t;case">":return r>t;case">=":return r>=t;case"<":return r<t;case"<=":return r<=t;case"between":return n.length>1&&r>=n[0]&&r<=n[1];case"not_between":return n.length<2||r<n[0]||r>n[1];case"include":return(s=r==null?void 0:r.includes)==null?void 0:s.call(r,t);case"not_include":return typeof r>"u"||!((o=r.includes)!=null&&o.call(r,t))}return!1},ps=e=>{const r={},t={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return e.forEach(n=>{if(typeof n.defaultValue<"u"){if(n.type==="array"&&!Array.isArray(n.defaultValue)){r[n.name]=t.array;return}if(n.type==="object"&&!Ke(n.defaultValue)){if(typeof n.defaultValue=="string"){try{r[n.name]=JSON.parse(n.defaultValue)}catch(s){r[n.name]=t.object}return}r[n.name]=t.object;return}r[n.name]=Hc(n.defaultValue);return}if(n.type==="object"){r[n.name]=n.fields?ps(n.fields):t.object;return}if(n.type){r[n.name]=t[n.type];return}r[n.name]=void 0}),r},mt="ds-field::",Qr="ds-field-changed",gs=/\$\{([\s\S]+?)\}/g;var ne=(e=>(e.DEFAULT="default",e.CODE_BLOCK="code-block",e.DATA_SOURCE="data-source",e.DATA_SOURCE_METHOD="data-source-method",e.DATA_SOURCE_COND="data-source-cond",e))(ne||{});class Kr{constructor(r){d(this,"isTarget");d(this,"id");d(this,"name");d(this,"type",ne.DEFAULT);d(this,"deps",{});d(this,"isCollectByDefault");var t;this.isTarget=r.isTarget,this.id=r.id,this.name=r.name,this.isCollectByDefault=(t=r.isCollectByDefault)!=null?t:!0,r.type&&(this.type=r.type),r.initialDeps&&(this.deps=r.initialDeps)}updateDep({id:r,name:t,key:n,data:s}){const o=this.deps[r]||{name:t,keys:[]};o.name=t,o.data=s,this.deps[r]=o,o.keys.indexOf(n)===-1&&o.keys.push(n)}removeDep(r,t){if(typeof r>"u"){Object.keys(this.deps).forEach(s=>{delete this.deps[s]});return}const n=this.deps[r];if(n)if(t){const s=n.keys.indexOf(t);n.keys.splice(s,1),n.keys.length===0&&delete this.deps[r]}else delete this.deps[r]}hasDep(r,t){const n=this.deps[r];return!!(n!=null&&n.keys.find(s=>s===t))}destroy(){this.deps={}}}const lr=(e,r)=>{let t=r;return e.some((n,s)=>{const o=t.find(({name:i})=>i===n);return t=(o==null?void 0:o.fields)||[],o&&o.type==="array"&&/^(?!\d+$).*$/.test("".concat(e[s+1]))&&s<e.length-1})},iu=(e,r,t=!1)=>{const n=e.match(gs)||[];if(n.length<=0)return!1;const s=[],o=[];return n.forEach(i=>{const a=i.substring(2,i.length-1),c=fr(a),u=c.shift();!u||u!==r.id||(lr(c,r.fields)?s.push(i):o.push(i))}),t?s.length>0:o.length>0},ou=(e,r)=>(e==null?void 0:e.isBindDataSourceField)&&e.dataSourceId&&e.dataSourceId===r&&typeof e.template=="string",au=(e,r)=>{if(!Array.isArray(e)||typeof e[0]!="string")return!1;const[t]=e,n=t.indexOf(mt);return n===-1?!1:t.substring(n+mt.length)===r},cu=(e,r,t,n=!1)=>{if("".concat(r).startsWith(Se))return!1;if(typeof t=="string")return iu(t,e,n);if(Ke(t)&&(t!=null&&t.isBindDataSource)&&t.dataSourceId&&t.dataSourceId===e.id||ou(t,e.id))return!0;if(au(t,e.id)){const[,...s]=t,o=lr(s,e.fields);return n?o:!o}return!1},uu=(e,r,t,n=!1)=>{var i;if(!Array.isArray(t)||!e)return!1;const[s,...o]=t;if(s!==e.id||!"".concat(r).startsWith(Se))return!1;if((i=e.fields)!=null&&i.find(a=>a.name===o[0])){const a=lr(o,e.fields);return n?a:!a}return!1},Vr=(e,r,t)=>{Object.values(e).forEach(n=>{Object.values(n).forEach(s=>{t&&s.type!==t||r(s)})})};class fu{constructor(r){d(this,"targetsList",{});d(this,"childrenProp","items");d(this,"idProp","id");d(this,"nameProp","name");r!=null&&r.initialTargets&&(this.targetsList=r.initialTargets),r!=null&&r.childrenProp&&(this.childrenProp=r.childrenProp)}getTargetsList(){return this.targetsList}getTargets(r=ne.DEFAULT){return this.targetsList[r]||{}}addTarget(r){const t=this.getTargets(r.type)||{};this.targetsList[r.type]=t,t[r.id]=r}getTarget(r,t=ne.DEFAULT){return this.getTargets(t)[r]}hasTarget(r,t=ne.DEFAULT){return!!this.getTarget(r,t)}hasSpecifiedTypeTarget(r=ne.DEFAULT){return Object.keys(this.getTargets(r)).length>0}removeTarget(r,t=ne.DEFAULT){const n=this.getTargets(t);n[r]&&(n[r].destroy(),delete n[r])}removeTargets(r=ne.DEFAULT){const t=this.targetsList[r];if(t){for(const n of Object.values(t))n.destroy();delete this.targetsList[r]}}clearTargets(){Object.keys(this.targetsList).forEach(r=>{delete this.targetsList[r]})}collect(r,t={},n=!1,s){this.collectByCallback(r,s,({node:o,target:i})=>{this.removeTargetDep(i,o),this.collectItem(o,i,t,n)})}collectByCallback(r,t,n){Vr(this.targetsList,s=>{!t&&!s.isCollectByDefault||r.forEach(o=>{n({node:o,target:s})})},t)}clear(r,t){let{targetsList:n}=this;t&&(n={[t]:this.getTargets(t)});const s=[];Vr(n,o=>{r?r.forEach(i=>{o.removeDep(i[this.idProp]),Array.isArray(i[this.childrenProp])&&i[this.childrenProp].length&&!s.includes(i[this.idProp])&&(s.push(i[this.idProp]),this.clear(i[this.childrenProp]))}):o.removeDep()})}clearByType(r,t){this.clear(t,r)}collectItem(r,t,n={},s=!1){const o=(i,a="")=>{const c=(u,f)=>{const l=u===this.childrenProp,h=a?"".concat(a,".").concat(u):u;t.isTarget(h,f)?t.updateDep({id:r[this.idProp],name:"".concat(r[this.nameProp]||r[this.idProp]),data:n,key:h}):!l&&Array.isArray(f)?f.forEach((p,v)=>{Ke(p)&&o(p,"".concat(h,"[").concat(v,"]"))}):Ke(f)&&o(f,h),l&&s&&Array.isArray(f)&&f.forEach(p=>{this.collectItem(p,t,n,s)})};Object.entries(i).forEach(([u,f])=>{typeof f>"u"||f===""||c(u,f)})};o(r)}removeTargetDep(r,t,n){r.removeDep(t[this.idProp],n),typeof n>"u"&&Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&t[this.childrenProp].forEach(s=>{this.removeTargetDep(r,s,n)})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function lu(e,r,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(f){try{u(n.next(f))}catch(l){i(l)}}function c(f){try{u(n.throw(f))}catch(l){i(l)}}function u(f){f.done?o(f.value):s(f.value).then(a,c)}u((n=n.apply(e,[])).next())})}const le=[];function hu(e,r,t="*"){if(e===t)return!0;le.length=0;let n=0,s=0,o=0,i=0;for(let h=0,p=e.length;h<p;h+=1){const v=e[h];v===t&&(n+=1,h>i&&le.push(e.substring(i,h)),le.push(v),i=h+1)}if(i<e.length&&le.push(e.substring(i)),n?(s=e.length-n,o=1/0):o=s=e.length,le.length===0)return e===r;const a=r.length;if(a<s||a>o)return!1;let c=0,u=le.length-1,f=r.length-1,l=!1;for(;;){const h=le[u];if(u-=1,h===t)l=!0;else{const p=f+1-h.length,v=r.lastIndexOf(h,p);if(v===-1||v>p)return!1;if(l)f=v-1,l=!1;else{if(v!==p)return!1;f-=h.length}}if(c>u)break}return!0}class at{constructor(r,t,n,s=void 0){this.obj=r,this.delimiter=t,this.wildcard=n,this.is_match=s}shortMatch(r,t){if(r===t||r===this.wildcard)return!0;if(this.is_match)return this.is_match(r,t);const n=r.indexOf(this.wildcard);if(n>-1){const s=r.substr(n+1);if(n===0||t.substring(0,n)===r.substring(0,n)){const o=s.length;return o>0?t.substr(-o)===s:!0}}return!1}match(r,t){return this.is_match?this.is_match(r,t):r===t||r===this.wildcard||t===this.wildcard||this.shortMatch(r,t)||hu(r,t,this.wildcard)}handleArray(r,t,n,s,o={}){let i=r.indexOf(this.delimiter,n),a=!1;i===-1&&(a=!0,i=r.length);const c=r.substring(n,i);let u=0;for(const f of t){const l=u.toString(),h=s===""?l:s+this.delimiter+u;(c===this.wildcard||c===l||this.shortMatch(c,l))&&(a?o[h]=f:this.goFurther(r,f,i+1,h,o)),u++}return o}handleObject(r,t,n,s,o={}){let i=r.indexOf(this.delimiter,n),a=!1;i===-1&&(a=!0,i=r.length);const c=r.substring(n,i);for(let u in t){u=u.toString();const f=s===""?u:s+this.delimiter+u;(c===this.wildcard||c===u||this.shortMatch(c,u))&&(a?o[f]=t[u]:this.goFurther(r,t[u],i+1,f,o))}return o}goFurther(r,t,n,s,o={}){return Array.isArray(t)?this.handleArray(r,t,n,s,o):this.handleObject(r,t,n,s,o)}get(r){return this.goFurther(r,this.obj,0,"")}}class je{static get(r,t,n=!1){if(!t)return;let s=t;for(const o of r)if(o in s)s=s[o];else if(n)s[o]=Object.create({}),s=s[o];else return;return s}static set(r,t,n){if(!n)return;if(r.length===0){for(const a in n)delete n[a];for(const a in t)n[a]=t[a];return}const s=r.slice(),o=s.pop(),i=je.get(s,n,!0);return typeof i=="object"&&(i[o]=t),t}}let X,yt=0,ct=null;function Nt(){return(ct===null||ct.buffer!==X.memory.buffer)&&(ct=new Uint8Array(X.memory.buffer)),ct}let pt=new TextEncoder("utf-8");const du=typeof pt.encodeInto=="function"?function(e,r){return pt.encodeInto(e,r)}:function(e,r){const t=pt.encode(e);return r.set(t),{read:e.length,written:t.length}};function Yr(e,r,t){if(t===void 0){const a=pt.encode(e),c=r(a.length);return Nt().subarray(c,c+a.length).set(a),yt=a.length,c}let n=e.length,s=r(n);const o=Nt();let i=0;for(;i<n;i++){const a=e.charCodeAt(i);if(a>127)break;o[s+i]=a}if(i!==n){i!==0&&(e=e.slice(i)),s=t(s,n,n=i+e.length*3);const a=Nt().subarray(s+i,s+n),c=du(e,a);i+=c.written}return yt=i,s}function pu(e,r){var t=Yr(e,X.__wbindgen_malloc,X.__wbindgen_realloc),n=yt,s=Yr(r,X.__wbindgen_malloc,X.__wbindgen_realloc),o=yt,i=X.is_match(t,n,s,o);return i!==0}async function gu(e,r){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,r)}else{const t=await WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}async function ms(e){const r={};(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=await gu(await e,r);return X=t.exports,ms.__wbindgen_wasm_module=n,X}const Oe={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function mu(e,r){console.debug(e,r)}function yu(){return{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:mu,Promise}}function Jr(e){return e&&e.constructor?e.constructor.name==="Object":typeof e=="object"&&e!==null}class bu{constructor(r={},t={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},yu()),t),this.data=r,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=je.get,this.pathSet=je.set),t.Promise?this.resolved=t.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new at(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(r,t=this.data,n=!1){const s=r.join(this.options.delimiter),o=this.cache.get(s);if(o){const a=o.deref();if(a)return a}const i=je.get(r,t,n);return(Jr(i)||Array.isArray(i))&&this.cache.set(s,new WeakRef(i)),i}cacheSet(r,t,n=this.data){const s=r.join(this.options.delimiter);return Jr(t)||Array.isArray(t)?this.cache.set(s,new WeakRef(t)):this.cache.delete(s),je.set(r,t,n)}silentSet(r,t){return this.pathSet(this.split(r),t,this.data)}loadWasmMatcher(r){return lu(this,void 0,void 0,function*(){yield ms(r),this.is_match=pu,this.scan=new at(this.data,this.options.delimiter,this.options.wildcard,this.is_match)})}same(r,t){return(["number","string","undefined","boolean"].includes(typeof r)||r===null)&&t===r}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(r,t,n=!0){return this.is_match?this.is_match(r,t):r===t||r===this.options.wildcard||t===this.options.wildcard?!0:!n&&this.getIndicesCount(this.options.delimiter,r)<this.getIndicesCount(this.options.delimiter,t)?!1:this.scan.match(r,t)}getIndicesOf(r,t){if(this.options.useIndicesCache&&this.indices.has(t))return this.indices.get(t);const n=r.length;if(n==0)return[];let s=0,o,i=[];for(;(o=t.indexOf(r,s))>-1;)i.push(o),s=o+n;return this.options.useIndicesCache&&this.indices.set(t,i),i}getIndicesCount(r,t){if(this.options.useIndicesCache&&this.indicesCount.has(t))return this.indicesCount.get(t);const n=r.length;if(n==0)return 0;let s=0,o,i=0;for(;(o=t.indexOf(r,s))>-1;)i++,s=o+n;return this.options.useIndicesCache&&this.indicesCount.set(t,i),i}cutPath(r,t){if(t==="")return"";if(r=this.cleanNotRecursivePath(r),t=this.cleanNotRecursivePath(t),r===t)return r;const n=this.getIndicesCount(this.options.delimiter,t),s=this.getIndicesOf(this.options.delimiter,r);return r.substring(0,s[n])}trimPath(r){return r=this.cleanNotRecursivePath(r),r.charAt(0)===this.options.delimiter?r.substr(1):r}split(r){if(r==="")return[];if(!this.options.useSplitCache)return r.split(this.options.delimiter);const t=this.splitCache.get(r);if(t)return t.slice();const n=r.split(this.options.delimiter);return this.splitCache.set(r,n.slice()),n}isWildcard(r){return r.includes(this.options.wildcard)||this.hasParams(r)}isNotRecursive(r){return r.endsWith(this.options.notRecursive)}cleanNotRecursivePath(r){return this.isNotRecursive(r)?r.substring(0,r.length-1):r}hasParams(r){return r.includes(this.options.param)}getParamsInfo(r){let t={replaced:"",original:r,params:{}},n=0,s=[];for(const o of this.split(r)){t.params[n]={original:o,replaced:"",name:""};const i=new RegExp("\\".concat(this.options.param,"([^\\").concat(this.options.delimiter,"\\").concat(this.options.param,"]+)"),"g");let a=i.exec(o);if(a)t.params[n].name=a[1];else{delete t.params[n],s.push(o),n++;continue}i.lastIndex=0,t.params[n].replaced=o.replace(i,this.options.wildcard),s.push(t.params[n].replaced),n++}return t.replaced=s.join(this.options.delimiter),t}getParams(r,t){if(!r)return;const n=this.split(t),s={};for(const o in r.params){const i=r.params[o];s[i.name]=n[o]}return s}waitForAll(r,t){const n={};for(let s of r)n[s]={dirty:!1},this.hasParams(s)&&(n[s].paramsInfo=this.getParamsInfo(s)),n[s].isWildcard=this.isWildcard(s),n[s].isRecursive=!this.isNotRecursive(s);return this.waitingListeners.set(r,{fn:t,paths:n}),t(n),function(){this.waitingListeners.delete(r)}}executeWaitingListeners(r){if(!this.destroyed)for(const t of this.waitingListeners.values()){const{fn:n,paths:s}=t;let o=0,i=0;for(let a in s){const c=s[a];let u=!1;c.isRecursive&&(r=this.cutPath(r,a)),c.isWildcard&&this.match(a,r)&&(u=!0),r===a&&(u=!0),u&&(c.dirty=!0),c.dirty&&o++,i++}o===i&&n(s)}}subscribeAll(r,t,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let s=[],o=0,i=null;typeof n.group=="boolean"&&n.group?(this.groupId++,i=this.groupId,n.bulk=!0):typeof n.group=="string"&&(n.bulk=!0,i=n.group);for(const a of r)s.push(this.subscribe(a,t,n,{all:r,index:o,groupId:i})),o++;return function(){for(const c of s)c()}}getCleanListenersCollection(r={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},r)}getCleanListener(r,t=this.getDefaultListenerOptions()){return{fn:r,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),t),groupId:null}}getListenerCollectionMatch(r,t,n){r=this.cleanNotRecursivePath(r);const s=this;return function(i,a=!1){let c=r;return t?i=s.cutPath(i,r):c=s.cutPath(s.cleanNotRecursivePath(r),i),a&&console.log("[getListenerCollectionMatch]",{listenerPath:r,scopedListenerPath:c,path:i,isRecursive:t,isWildcard:n}),n&&s.match(c,i,t)?!0:c===i}}getListenersCollection(r,t){if(this.listeners.has(r)){let a=this.listeners.get(r);return a.listeners.set(++this.id,t),t.id=this.id,a}const n=this.hasParams(r);let s;n&&(s=this.getParamsInfo(r));let o={isRecursive:!this.isNotRecursive(r),isWildcard:this.isWildcard(r),hasParams:n,paramsInfo:s,originalPath:r,path:n?s.replaced:r};o.isRecursive||(o.path=this.cleanNotRecursivePath(o.path));let i=this.getCleanListenersCollection(Object.assign(Object.assign({},o),{match:this.getListenerCollectionMatch(o.path,o.isRecursive,o.isWildcard)}));return this.id++,i.listeners.set(this.id,t),t.id=this.id,this.listeners.set(o.originalPath,i),i}subscribe(r,t,n=this.getDefaultListenerOptions(),s={all:[r],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const o="subscribe";let i=this.getCleanListener(t,n);n.group&&(n.bulk=!0,typeof n.group=="string"?i.groupId=n.group:s.groupId&&(i.groupId=s.groupId)),this.listenersIgnoreCache.set(i,{truthy:[],falsy:[]});const a=this.getListenersCollection(r,i);n.debug&&console.log("[subscribe]",{listenerPath:r,options:n}),a.count++;let c=!0;if(i.groupId&&(typeof i.groupId=="string"?this.namedGroups.includes(i.groupId)?c=!1:this.namedGroups.push(i.groupId):typeof i.groupId=="number"&&(this.numberGroups.includes(i.groupId)?c=!1:this.numberGroups.push(i.groupId))),c){const u=this.cleanNotRecursivePath(a.path),f=this.split(u);if(!a.isWildcard)!this.isMuted(u)&&!this.isMuted(t)&&t(this.pathGet(f,this.data),{type:o,listener:i,listenersCollection:a,path:{listener:r,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(a.paramsInfo,u),options:n});else{const l=this.scan.get(u);if(n.bulk){const h=[];for(const p in l)this.isMuted(p)||h.push({path:p,params:this.getParams(a.paramsInfo,p),value:l[p]});this.isMuted(t)||t(h,{type:o,listener:i,listenersCollection:a,path:{listener:r,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const h in l)!this.isMuted(h)&&!this.isMuted(t)&&t(l[h],{type:o,listener:i,listenersCollection:a,path:{listener:r,update:void 0,resolved:this.cleanNotRecursivePath(h)},params:this.getParams(a.paramsInfo,h),options:n})}}return this.debugSubscribe(i,a,r),this.jobsRunning--,this.unsubscribe(r,this.id)}unsubscribe(r,t){const n=this.listeners,s=n.get(r);return function(){s.listeners.delete(t),s.count--,s.count===0&&n.delete(r)}}runQueuedListeners(){if(!this.destroyed&&this.subscribeQueue.length!==0)if(this.jobsRunning===0){this.queueRuns=0;const r=[...this.subscribeQueue];for(let t=0,n=r.length;t<n;t++)r[t]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then(()=>this.runQueuedListeners()).catch(r=>{throw r})}}getQueueNotifyListeners(r,t=[]){for(const n in r){if(this.isMuted(n))continue;let{single:s,bulk:o}=r[n];for(const i of s){let a=!1,c=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(c=i.listener.id+":"+i.eventInfo.path.listener);for(const f of t)if(c===f.resolvedIdPath){a=!0;break}if(a)continue;const u=this.debugTime(i);if(!this.isMuted(i.listener.fn))if(i.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>{i.listener.fn(i.value?i.value():void 0,i.eventInfo)});else{let f=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(f=i.listener.id+":"+i.eventInfo.path.listener),t.push({id:i.listener.id,resolvedPath:i.eventInfo.path.resolved,resolvedIdPath:f,originalFn:i.listener.fn,fn:()=>{i.listener.fn(i.value?i.value():void 0,i.eventInfo)},options:i.listener.options,groupId:i.listener.groupId})}this.debugListener(u,i)}for(const i of o){let a=!1;for(const f of t)if(f.id===i.listener.id){a=!0;break}if(a)continue;const c=this.debugTime(i),u=[];for(const f of i.value)u.push(Object.assign(Object.assign({},f),{value:f.value?f.value():void 0}));if(!this.isMuted(i.listener.fn))if(i.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>this.jobsRunning?!1:(i.listener.fn(u,i.eventInfo),!0));else{let f=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(f=i.listener.id+":"+i.eventInfo.path.listener),t.push({id:i.listener.id,resolvedPath:i.eventInfo.path.resolved,resolvedIdPath:f,originalFn:i.listener.fn,fn:()=>{i.listener.fn(u,i.eventInfo)},options:i.listener.options,groupId:i.listener.groupId})}this.debugListener(c,i)}}return Promise.resolve().then(()=>this.runQueuedListeners()),t}shouldIgnore(r,t){if(!r.options.ignore)return!1;for(const n of r.options.ignore){if(t.startsWith(n)||this.is_match&&this.is_match(n,t))return!0;{const s=this.cutPath(t,n);if(this.match(n,s))return!0}}return!1}getSubscribedListeners(r,t,n,s="update",o=null){n=Object.assign(Object.assign({},Oe),n);const i={};for(let[a,c]of this.listeners)if(c.match(r)){i[a]={single:[],bulk:[],bulkData:[]};const u=c.paramsInfo?this.getParams(c.paramsInfo,r):void 0,f=this.cutPath(r,a),h=c.isRecursive||c.isWildcard?()=>this.get(f):()=>t,p=[{value:h,path:r,params:u}];for(const v of c.listeners.values()){if(this.shouldIgnore(v,r)){v.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:v,listenersCollection:c});continue}v.options.bulk?i[a].bulk.push({listener:v,listenersCollection:c,eventInfo:{type:s,listener:v,path:{listener:a,update:o||r,resolved:void 0},params:u,options:n},value:p}):i[a].single.push({listener:v,listenersCollection:c,eventInfo:{type:s,listener:v,path:{listener:a,update:o||r,resolved:this.cleanNotRecursivePath(r)},params:u,options:n},value:h})}}else if(this.options.extraDebug){let u=!1;for(const f of c.listeners.values())f.options.debug&&(u=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:f,listenersCollection:c,updatePath:r}));u&&c.match(r,!0)}return i}notifySubscribedListeners(r,t,n,s="update",o=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(r,t,n,s,o))}useBulkValue(r){for(const[t,n]of r.listeners)if(n.options.bulk&&n.options.bulkValue||!n.options.bulk)return!0;return!1}getNestedListeners(r,t,n,s="update",o=null){const i={},a={};for(let[c,u]of this.listeners){if(!u.isRecursive)continue;const f=this.cutPath(c,r);if(this.match(f,r)){i[c]={single:[],bulk:[]};const l=this.trimPath(c.substr(f.length)),h=this.useBulkValue(u);let p;h&&(p=a[l]?a[l]:new at(t,this.options.delimiter,this.options.wildcard).get(l),a[l]=p);const v=u.paramsInfo?this.getParams(u.paramsInfo,r):void 0,b=[],_={};for(const[A,E]of u.listeners)if(h)for(const P in p){const ce=()=>p[P],W=[r,P].join(this.options.delimiter),k={type:s,listener:E,listenersCollection:u,path:{listener:c,update:o||r,resolved:this.cleanNotRecursivePath(W)},params:v,options:n};this.shouldIgnore(E,r)||(E.options.bulk?(b.push({value:ce,path:W,params:v}),_[A]=E):i[c].single.push({listener:E,listenersCollection:u,eventInfo:k,value:ce}))}else{const P={type:s,listener:E,listenersCollection:u,path:{listener:c,update:o||r,resolved:void 0},params:v,options:n};if(this.shouldIgnore(E,r))continue;E.options.bulk?(b.push({value:void 0,path:void 0,params:v}),_[A]=E):i[c].single.push({listener:E,listenersCollection:u,eventInfo:P,value:void 0})}for(const A in _){const E=_[A],P={type:s,listener:E,listenersCollection:u,path:{listener:c,update:r,resolved:void 0},options:n,params:v};i[c].bulk.push({listener:E,listenersCollection:u,eventInfo:P,value:b})}}else if(this.options.extraDebug)for(const l of u.listeners.values())l.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:l,listenersCollection:u,currentCutPath:f,updatePath:r})}return i}notifyNestedListeners(r,t,n,s="update",o,i=null){return this.getQueueNotifyListeners(this.getNestedListeners(r,t,n,s,i),o)}getNotifyOnlyListeners(r,t,n,s="update",o=null){const i={};if(typeof n.only!="object"||!Array.isArray(n.only)||typeof n.only[0]>"u"||!this.canBeNested(t))return i;for(const a of n.only){const c=new at(t,this.options.delimiter,this.options.wildcard).get(a);i[a]={bulk:[],single:[]};for(const u in c){const f=r+this.options.delimiter+u;for(const[l,h]of this.listeners){const p=h.paramsInfo?this.getParams(h.paramsInfo,f):void 0;if(this.match(l,f)){const v=()=>c[u],b=[{value:v,path:f,params:p}];for(const _ of h.listeners.values()){const A={type:s,listener:_,listenersCollection:h,path:{listener:l,update:o||r,resolved:this.cleanNotRecursivePath(f)},params:p,options:n};this.shouldIgnore(_,r)||(_.options.bulk?i[a].bulk.some(E=>E.listener===_)||i[a].bulk.push({listener:_,listenersCollection:h,eventInfo:A,value:b}):i[a].single.push({listener:_,listenersCollection:h,eventInfo:A,value:v}))}}}}}return i}runQueue(r){const t=[];for(const n of r)n.options.group?t.includes(n.groupId)||(n.fn(),t.push(n.groupId)):n.fn()}sortAndRunQueue(r,t){r.sort(function(n,s){return n.id-s.id}),this.options.debug&&console.log("[deep-state-observer] queue for ".concat(t),r),this.runQueue(r)}notifyOnly(r,t,n,s="update",o=""){const i=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(r,t,n,s,o));this.sortAndRunQueue(i,r)}canBeNested(r){return typeof r=="object"&&r!==null}getUpdateValues(r,t){let n=t;return typeof t=="function"&&(n=t(r)),{newValue:n,oldValue:r}}wildcardNotify(r,t){let n=[];for(const s of r)this.getQueueNotifyListeners(s,n);for(const s of t)this.executeWaitingListeners(s);return this.jobsRunning--,n}wildcardUpdate(r,t,n=Oe,s=!1){++this.jobsRunning,n=Object.assign(Object.assign({},Oe),n);const o=this.scan.get(r),i={};for(const f in o){const l=this.split(f),{oldValue:h,newValue:p}=this.getUpdateValues(o[f],t);(!this.same(p,h)||n.force)&&(this.pathSet(l,p,this.data),i[f]=p)}const a=[],c=[];for(const f in i){const l=i[f];n.only.length?a.push(this.getNotifyOnlyListeners(f,l,n,"update",r)):(a.push(this.getSubscribedListeners(f,l,n,"update",r)),this.canBeNested(l)&&a.push(this.getNestedListeners(f,l,n,"update",r))),n.debug&&this.options.log("Wildcard update",{path:f,newValue:l}),c.push(f)}if(s){const f=this;return function(){const l=f.wildcardNotify(a,c);f.sortAndRunQueue(l,r)}}const u=this.wildcardNotify(a,c);this.sortAndRunQueue(u,r)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const r=this.updateQueue.shift();r.options.queue=!1,this.update(r.updatePath,r.fnOrValue,r.options,r.multi)}}updateNotify(r,t,n){const s=this.notifySubscribedListeners(r,t,n);this.canBeNested(t)&&this.notifyNestedListeners(r,t,n,"update",s),this.sortAndRunQueue(s,r),this.executeWaitingListeners(r)}updateNotifyAll(r){let t=[];for(const n of r){const s=n.newValue;if(this.tracing.length){const o=this.tracing[this.tracing.length-1],i=this.traceMap.get(o);i.changed.push({traceId:o,updatePath:n.updatePath,fnOrValue:s,options:n.options}),this.traceMap.set(o,i)}t=t.concat(this.notifySubscribedListeners(n.updatePath,s,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,s,n.options,"update",t)}this.runQueue(t)}updateNotifyOnly(r,t,n){this.notifyOnly(r,t,n),this.executeWaitingListeners(r)}update(r,t,n=Object.assign({},Oe),s=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(r,t,n);if(this.tracing.length){const f=this.tracing[this.tracing.length-1],l=this.traceMap.get(f);l.changed.push({traceId:f,updatePath:r,fnOrValue:t,options:n}),this.traceMap.set(f,l)}const o=this.jobsRunning;if((this.options.queue||n.queue)&&o){if(o>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:r,fnOrValue:t,options:n,multi:s});const f=Promise.resolve().then(()=>{this.runUpdateQueue()});return s?function(){return f}:f}if(this.isWildcard(r))return this.wildcardUpdate(r,t,n,s);++this.jobsRunning;const i=this.split(r),a=this.pathGet(i,this.data);let{oldValue:c,newValue:u}=this.getUpdateValues(a,t);if(n.debug&&this.options.log("Updating ".concat(r," ").concat(n.source?"from ".concat(n.source):""),{oldValue:c,newValue:u}),this.same(u,c)&&!n.force)return--this.jobsRunning,s?function(){return u}:u;if(this.pathSet(i,u,this.data),n=Object.assign(Object.assign({},Oe),n),n.only===null)return--this.jobsRunning,s?function(){}:u;if(n.only.length){if(--this.jobsRunning,s){const f=this;return function(){return f.updateNotifyOnly(r,u,n)}}return this.updateNotifyOnly(r,u,n),u}if(s){--this.jobsRunning;const f=this;return function(){return f.updateNotify(r,u,n)}}return this.updateNotify(r,u,n),--this.jobsRunning,u}multi(r=!1){if(this.destroyed)return{update(){return this},done(){},getStack(){return[]}};if(this.collection)return this.collection;const t=this,n=[],s=[];return{update(i,a,c=Oe){if(r){const u=t.split(i);let f=a;const l=t.pathGet(u,t.data);typeof f=="function"&&(f=f(l)),t.pathSet(u,f,t.data),n.push({updatePath:i,newValue:f,options:c})}else s.push(t.update(i,a,c,!0));return this},done(){if(t.collections===0){if(r)t.updateNotifyAll(n);else for(const i of s)i();n.length=0}},getStack(){return n}}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,this.collections===0&&this.collection){const r=this.collection;this.collection=null,r.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(r=void 0){if(!this.destroyed)return r===void 0||r===""?this.data:this.isWildcard(r)?this.scan.get(r):this.pathGet(this.split(r),this.data)}last(r){let t=this.lastExecs.get(r);t||(t={calls:0},this.lastExecs.set(r,t));const n=++t.calls;this.resolved.then(()=>{n===t.calls&&(this.lastExecs.set(r,{calls:0}),r())})}isMuted(r){if(!this.options.useMute)return!1;if(typeof r=="function")return this.isMutedListener(r);for(const t of this.muted){const n=!this.isNotRecursive(t),s=this.trimPath(t);if(this.match(r,s)||this.match(s,r))return!0;if(n){const o=this.cutPath(s,r);if(this.match(o,t)||this.match(t,o))return!0}}return!1}isMutedListener(r){return this.mutedListeners.has(r)}mute(r){if(typeof r=="function")return this.mutedListeners.add(r);this.muted.add(r)}unmute(r){if(typeof r=="function")return this.mutedListeners.delete(r);this.muted.delete(r)}debugSubscribe(r,t,n){r.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:r,listenersCollection:t})}debugListener(r,t){(t.eventInfo.options.debug||t.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-r,info:t})}debugTime(r){return r.listener.options.debug||r.eventInfo.options.debug?Date.now():0}startTrace(r,t=null){this.traceId++;const n=this.traceId+":"+r;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map(s=>s),additionalData:t,changed:[]}),this.tracing.push(n),n}stopTrace(r){const t=this.traceMap.get(r);return this.tracing.pop(),this.traceMap.delete(r),t}saveTrace(r){const t=this.traceMap.get(r);return this.tracing.pop(),this.traceMap.delete(r),this.savedTrace.push(t),t}getSavedTraces(){const r=this.savedTrace.map(t=>t);return r.sort((t,n)=>t.sort-n.sort),this.savedTrace=[],r}}var ys=typeof global=="object"&&global&&global.Object===Object&&global,vu=typeof self=="object"&&self&&self.Object===Object&&self,V=ys||vu||Function("return this")(),ie=V.Symbol,bs=Object.prototype,$u=bs.hasOwnProperty,wu=bs.toString,ke=ie?ie.toStringTag:void 0;function _u(e){var r=$u.call(e,ke),t=e[ke];try{e[ke]=void 0;var n=!0}catch(o){}var s=wu.call(e);return n&&(r?e[ke]=t:delete e[ke]),s}var Tu=Object.prototype,Ou=Tu.toString;function Su(e){return Ou.call(e)}var ju="[object Null]",Eu="[object Undefined]",Xr=ie?ie.toStringTag:void 0;function st(e){return e==null?e===void 0?Eu:ju:Xr&&Xr in Object(e)?_u(e):Su(e)}function Ne(e){return e!=null&&typeof e=="object"}var Et=Array.isArray;function At(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function vs(e){return e}var Au="[object AsyncFunction]",Cu="[object Function]",Iu="[object GeneratorFunction]",Du="[object Proxy]";function $s(e){if(!At(e))return!1;var r=st(e);return r==Cu||r==Iu||r==Au||r==Du}var Rt=V["__core-js_shared__"],Zr=function(){var e=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function xu(e){return!!Zr&&Zr in e}var Mu=Function.prototype,Lu=Mu.toString;function ve(e){if(e!=null){try{return Lu.call(e)}catch(r){}try{return e+""}catch(r){}}return""}var Pu=/[\\^$.*+?()[\]{}|]/g,Nu=/^\[object .+?Constructor\]$/,Ru=Function.prototype,Fu=Object.prototype,Uu=Ru.toString,Hu=Fu.hasOwnProperty,Wu=RegExp("^"+Uu.call(Hu).replace(Pu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ku(e){if(!At(e)||xu(e))return!1;var r=$s(e)?Wu:Nu;return r.test(ve(e))}function Bu(e,r){return e==null?void 0:e[r]}function $e(e,r){var t=Bu(e,r);return ku(t)?t:void 0}var Gt=$e(V,"WeakMap"),en=Object.create,zu=function(){function e(){}return function(r){if(!At(r))return{};if(en)return en(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}();function Gu(e,r,t){switch(t.length){case 0:return e.call(r);case 1:return e.call(r,t[0]);case 2:return e.call(r,t[0],t[1]);case 3:return e.call(r,t[0],t[1],t[2])}return e.apply(r,t)}function qu(){}var Qu=800,Ku=16,Vu=Date.now;function Yu(e){var r=0,t=0;return function(){var n=Vu(),s=Ku-(n-t);if(t=n,s>0){if(++r>=Qu)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}function Ju(e){return function(){return e}}var bt=function(){try{var e=$e(Object,"defineProperty");return e({},"",{}),e}catch(r){}}(),Xu=bt?function(e,r){return bt(e,"toString",{configurable:!0,enumerable:!1,value:Ju(r),writable:!0})}:vs,Zu=Yu(Xu);function ef(e,r){for(var t=-1,n=e==null?0:e.length;++t<n&&r(e[t],t,e)!==!1;);return e}function tf(e,r,t,n){for(var s=e.length,o=t+-1;++o<s;)if(r(e[o],o,e))return o;return-1}function rf(e){return e!==e}function nf(e,r,t){for(var n=t-1,s=e.length;++n<s;)if(e[n]===r)return n;return-1}function sf(e,r,t){return r===r?nf(e,r,t):tf(e,rf,t)}function of(e,r){var t=e==null?0:e.length;return!!t&&sf(e,r,0)>-1}var af=9007199254740991,cf=/^(?:0|[1-9]\d*)$/;function uf(e,r){var t=typeof e;return r=r==null?af:r,!!r&&(t=="number"||t!="symbol"&&cf.test(e))&&e>-1&&e%1==0&&e<r}function ff(e,r,t){r=="__proto__"&&bt?bt(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}function ws(e,r){return e===r||e!==e&&r!==r}var lf=Object.prototype,hf=lf.hasOwnProperty;function df(e,r,t){var n=e[r];(!(hf.call(e,r)&&ws(n,t))||t===void 0&&!(r in e))&&ff(e,r,t)}var tn=Math.max;function pf(e,r,t){return r=tn(r===void 0?e.length-1:r,0),function(){for(var n=arguments,s=-1,o=tn(n.length-r,0),i=Array(o);++s<o;)i[s]=n[r+s];s=-1;for(var a=Array(r+1);++s<r;)a[s]=n[s];return a[r]=t(i),Gu(e,this,a)}}function gf(e,r){return Zu(pf(e,r,vs),e+"")}var mf=9007199254740991;function _s(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=mf}function Ts(e){return e!=null&&_s(e.length)&&!$s(e)}var yf=Object.prototype;function Os(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||yf;return e===t}function bf(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}var vf="[object Arguments]";function rn(e){return Ne(e)&&st(e)==vf}var Ss=Object.prototype,$f=Ss.hasOwnProperty,wf=Ss.propertyIsEnumerable,js=rn(function(){return arguments}())?rn:function(e){return Ne(e)&&$f.call(e,"callee")&&!wf.call(e,"callee")};function _f(){return!1}var Es=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nn=Es&&typeof module=="object"&&module&&!module.nodeType&&module,Tf=nn&&nn.exports===Es,sn=Tf?V.Buffer:void 0,Of=sn?sn.isBuffer:void 0,As=Of||_f,Sf="[object Arguments]",jf="[object Array]",Ef="[object Boolean]",Af="[object Date]",Cf="[object Error]",If="[object Function]",Df="[object Map]",xf="[object Number]",Mf="[object Object]",Lf="[object RegExp]",Pf="[object Set]",Nf="[object String]",Rf="[object WeakMap]",Ff="[object ArrayBuffer]",Uf="[object DataView]",Hf="[object Float32Array]",Wf="[object Float64Array]",kf="[object Int8Array]",Bf="[object Int16Array]",zf="[object Int32Array]",Gf="[object Uint8Array]",qf="[object Uint8ClampedArray]",Qf="[object Uint16Array]",Kf="[object Uint32Array]",M={};M[Hf]=M[Wf]=M[kf]=M[Bf]=M[zf]=M[Gf]=M[qf]=M[Qf]=M[Kf]=!0;M[Sf]=M[jf]=M[Ff]=M[Ef]=M[Uf]=M[Af]=M[Cf]=M[If]=M[Df]=M[xf]=M[Mf]=M[Lf]=M[Pf]=M[Nf]=M[Rf]=!1;function Vf(e){return Ne(e)&&_s(e.length)&&!!M[st(e)]}function hr(e){return function(r){return e(r)}}var Cs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ge=Cs&&typeof module=="object"&&module&&!module.nodeType&&module,Yf=Ge&&Ge.exports===Cs,Ft=Yf&&ys.process,De=function(){try{var e=Ge&&Ge.require&&Ge.require("util").types;return e||Ft&&Ft.binding&&Ft.binding("util")}catch(r){}}(),on=De&&De.isTypedArray,Jf=on?hr(on):Vf,Xf=Object.prototype,Zf=Xf.hasOwnProperty;function el(e,r){var t=Et(e),n=!t&&js(e),s=!t&&!n&&As(e),o=!t&&!n&&!s&&Jf(e),i=t||n||s||o,a=i?bf(e.length,String):[],c=a.length;for(var u in e)Zf.call(e,u)&&!(i&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||uf(u,c)))&&a.push(u);return a}function Is(e,r){return function(t){return e(r(t))}}var tl=Is(Object.keys,Object),rl=Object.prototype,nl=rl.hasOwnProperty;function sl(e){if(!Os(e))return tl(e);var r=[];for(var t in Object(e))nl.call(e,t)&&t!="constructor"&&r.push(t);return r}function il(e){return Ts(e)?el(e):sl(e)}var Ve=$e(Object,"create");function ol(){this.__data__=Ve?Ve(null):{},this.size=0}function al(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var cl="__lodash_hash_undefined__",ul=Object.prototype,fl=ul.hasOwnProperty;function ll(e){var r=this.__data__;if(Ve){var t=r[e];return t===cl?void 0:t}return fl.call(r,e)?r[e]:void 0}var hl=Object.prototype,dl=hl.hasOwnProperty;function pl(e){var r=this.__data__;return Ve?r[e]!==void 0:dl.call(r,e)}var gl="__lodash_hash_undefined__";function ml(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=Ve&&r===void 0?gl:r,this}function me(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}me.prototype.clear=ol;me.prototype.delete=al;me.prototype.get=ll;me.prototype.has=pl;me.prototype.set=ml;function yl(){this.__data__=[],this.size=0}function Ct(e,r){for(var t=e.length;t--;)if(ws(e[t][0],r))return t;return-1}var bl=Array.prototype,vl=bl.splice;function $l(e){var r=this.__data__,t=Ct(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():vl.call(r,t,1),--this.size,!0}function wl(e){var r=this.__data__,t=Ct(r,e);return t<0?void 0:r[t][1]}function _l(e){return Ct(this.__data__,e)>-1}function Tl(e,r){var t=this.__data__,n=Ct(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function ee(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ee.prototype.clear=yl;ee.prototype.delete=$l;ee.prototype.get=wl;ee.prototype.has=_l;ee.prototype.set=Tl;var Ye=$e(V,"Map");function Ol(){this.size=0,this.__data__={hash:new me,map:new(Ye||ee),string:new me}}function Sl(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function It(e,r){var t=e.__data__;return Sl(r)?t[typeof r=="string"?"string":"hash"]:t.map}function jl(e){var r=It(this,e).delete(e);return this.size-=r?1:0,r}function El(e){return It(this,e).get(e)}function Al(e){return It(this,e).has(e)}function Cl(e,r){var t=It(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function we(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}we.prototype.clear=Ol;we.prototype.delete=jl;we.prototype.get=El;we.prototype.has=Al;we.prototype.set=Cl;function Ds(e,r){for(var t=-1,n=r.length,s=e.length;++t<n;)e[s+t]=r[t];return e}var an=ie?ie.isConcatSpreadable:void 0;function Il(e){return Et(e)||js(e)||!!(an&&e&&e[an])}function Dl(e,r,t,n,s){var o=-1,i=e.length;for(t||(t=Il),s||(s=[]);++o<i;){var a=e[o];t(a)&&Ds(s,a)}return s}var xl=Is(Object.getPrototypeOf,Object);function Ml(){this.__data__=new ee,this.size=0}function Ll(e){var r=this.__data__,t=r.delete(e);return this.size=r.size,t}function Pl(e){return this.__data__.get(e)}function Nl(e){return this.__data__.has(e)}var Rl=200;function Fl(e,r){var t=this.__data__;if(t instanceof ee){var n=t.__data__;if(!Ye||n.length<Rl-1)return n.push([e,r]),this.size=++t.size,this;t=this.__data__=new we(n)}return t.set(e,r),this.size=t.size,this}function Re(e){var r=this.__data__=new ee(e);this.size=r.size}Re.prototype.clear=Ml;Re.prototype.delete=Ll;Re.prototype.get=Pl;Re.prototype.has=Nl;Re.prototype.set=Fl;var xs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cn=xs&&typeof module=="object"&&module&&!module.nodeType&&module,Ul=cn&&cn.exports===xs,un=Ul?V.Buffer:void 0;un&&un.allocUnsafe;function Hl(e,r){return e.slice()}function Wl(e,r){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var i=e[t];r(i,t,e)&&(o[s++]=i)}return o}function kl(){return[]}var Bl=Object.prototype,zl=Bl.propertyIsEnumerable,fn=Object.getOwnPropertySymbols,Gl=fn?function(e){return e==null?[]:(e=Object(e),Wl(fn(e),function(r){return zl.call(e,r)}))}:kl;function ql(e,r,t){var n=r(e);return Et(e)?n:Ds(n,t(e))}function Ql(e){return ql(e,il,Gl)}var qt=$e(V,"DataView"),Qt=$e(V,"Promise"),Ae=$e(V,"Set"),ln="[object Map]",Kl="[object Object]",hn="[object Promise]",dn="[object Set]",pn="[object WeakMap]",gn="[object DataView]",Vl=ve(qt),Yl=ve(Ye),Jl=ve(Qt),Xl=ve(Ae),Zl=ve(Gt),J=st;(qt&&J(new qt(new ArrayBuffer(1)))!=gn||Ye&&J(new Ye)!=ln||Qt&&J(Qt.resolve())!=hn||Ae&&J(new Ae)!=dn||Gt&&J(new Gt)!=pn)&&(J=function(e){var r=st(e),t=r==Kl?e.constructor:void 0,n=t?ve(t):"";if(n)switch(n){case Vl:return gn;case Yl:return ln;case Jl:return hn;case Xl:return dn;case Zl:return pn}return r});var eh=Object.prototype,th=eh.hasOwnProperty;function rh(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&th.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var mn=V.Uint8Array;function dr(e){var r=new e.constructor(e.byteLength);return new mn(r).set(new mn(e)),r}function nh(e,r){var t=dr(e.buffer);return new e.constructor(t,e.byteOffset,e.byteLength)}var sh=/\w*$/;function ih(e){var r=new e.constructor(e.source,sh.exec(e));return r.lastIndex=e.lastIndex,r}var yn=ie?ie.prototype:void 0,bn=yn?yn.valueOf:void 0;function oh(e){return bn?Object(bn.call(e)):{}}function ah(e,r){var t=dr(e.buffer);return new e.constructor(t,e.byteOffset,e.length)}var ch="[object Boolean]",uh="[object Date]",fh="[object Map]",lh="[object Number]",hh="[object RegExp]",dh="[object Set]",ph="[object String]",gh="[object Symbol]",mh="[object ArrayBuffer]",yh="[object DataView]",bh="[object Float32Array]",vh="[object Float64Array]",$h="[object Int8Array]",wh="[object Int16Array]",_h="[object Int32Array]",Th="[object Uint8Array]",Oh="[object Uint8ClampedArray]",Sh="[object Uint16Array]",jh="[object Uint32Array]";function Eh(e,r,t){var n=e.constructor;switch(r){case mh:return dr(e);case ch:case uh:return new n(+e);case yh:return nh(e);case bh:case vh:case $h:case wh:case _h:case Th:case Oh:case Sh:case jh:return ah(e);case fh:return new n;case lh:case ph:return new n(e);case hh:return ih(e);case dh:return new n;case gh:return oh(e)}}function Ah(e){return typeof e.constructor=="function"&&!Os(e)?zu(xl(e)):{}}var Ch="[object Map]";function Ih(e){return Ne(e)&&J(e)==Ch}var vn=De&&De.isMap,Dh=vn?hr(vn):Ih,xh="[object Set]";function Mh(e){return Ne(e)&&J(e)==xh}var $n=De&&De.isSet,Lh=$n?hr($n):Mh,Ms="[object Arguments]",Ph="[object Array]",Nh="[object Boolean]",Rh="[object Date]",Fh="[object Error]",Ls="[object Function]",Uh="[object GeneratorFunction]",Hh="[object Map]",Wh="[object Number]",Ps="[object Object]",kh="[object RegExp]",Bh="[object Set]",zh="[object String]",Gh="[object Symbol]",qh="[object WeakMap]",Qh="[object ArrayBuffer]",Kh="[object DataView]",Vh="[object Float32Array]",Yh="[object Float64Array]",Jh="[object Int8Array]",Xh="[object Int16Array]",Zh="[object Int32Array]",ed="[object Uint8Array]",td="[object Uint8ClampedArray]",rd="[object Uint16Array]",nd="[object Uint32Array]",D={};D[Ms]=D[Ph]=D[Qh]=D[Kh]=D[Nh]=D[Rh]=D[Vh]=D[Yh]=D[Jh]=D[Xh]=D[Zh]=D[Hh]=D[Wh]=D[Ps]=D[kh]=D[Bh]=D[zh]=D[Gh]=D[ed]=D[td]=D[rd]=D[nd]=!0;D[Fh]=D[Ls]=D[qh]=!1;function gt(e,r,t,n,s,o){var i;if(i!==void 0)return i;if(!At(e))return e;var a=Et(e);if(a)i=rh(e);else{var c=J(e),u=c==Ls||c==Uh;if(As(e))return Hl(e);if(c==Ps||c==Ms||u&&!s)i=u?{}:Ah(e);else{if(!D[c])return s?e:{};i=Eh(e,c)}}o||(o=new Re);var f=o.get(e);if(f)return f;o.set(e,i),Lh(e)?e.forEach(function(p){i.add(gt(p,r,t,p,e,o))}):Dh(e)&&e.forEach(function(p,v){i.set(v,gt(p,r,t,v,e,o))});var l=Ql,h=a?void 0:l(e);return ef(h||e,function(p,v){h&&(v=p,p=e[v]),df(i,v,gt(p,r,t,v,e,o))}),i}var sd=1,id=4;function Dt(e){return gt(e,sd|id)}var od="__lodash_hash_undefined__";function ad(e){return this.__data__.set(e,od),this}function cd(e){return this.__data__.has(e)}function vt(e){var r=-1,t=e==null?0:e.length;for(this.__data__=new we;++r<t;)this.add(e[r])}vt.prototype.add=vt.prototype.push=ad;vt.prototype.has=cd;function ud(e,r){return e.has(r)}function Ns(e){var r=-1,t=Array(e.size);return e.forEach(function(n){t[++r]=n}),t}function fd(e){return Ne(e)&&Ts(e)}var ld=1/0,hd=Ae&&1/Ns(new Ae([,-0]))[1]==ld?function(e){return new Ae(e)}:qu,dd=200;function pd(e,r,t){var n=-1,s=of,o=e.length,i=!0,a=[],c=a;if(o>=dd){var u=hd(e);if(u)return Ns(u);i=!1,s=ud,c=new vt}else c=a;e:for(;++n<o;){var f=e[n],l=f;if(f=f!==0?f:0,i&&l===l){for(var h=c.length;h--;)if(c[h]===l)continue e;a.push(f)}else s(c,l,t)||(c!==a&&c.push(l),a.push(f))}return a}var gd=gf(function(e){return pd(Dl(e,1,fd))});class Rs{}class Fs extends Rs{constructor(t){super();d(this,"data",{});d(this,"event",new nt.EventEmitter);this.data=t}update(t,n){n?zt(n,t,this.data):this.data=t;const s={updateData:t,path:n!=null?n:""};n&&this.event.emit(n,s),this.event.emit("",s)}on(t,n){this.event.on(t,n)}off(t,n){this.event.off(t,n)}getData(t){return t?ge(t,this.data):this.data}destroy(){}}var $t,Xe,Ze,q,he,et;class Us extends Rn{constructor(t){var o,i,a,c,u;super();d(this,"isInit",!1);d(this,"app");d(this,"mockData");z(this,$t,"base");z(this,Xe);z(this,Ze);z(this,q);z(this,he,[]);z(this,et,[]);G(this,Xe,t.schema.id),G(this,Ze,t.schema),this.app=t.app,this.setFields(t.schema.fields),this.setMethods(t.schema.methods||[]);let n=t.initialData;const s=t.ObservedDataClass||Fs;if(this.app.platform==="editor")this.mockData=((i=(o=t.schema.mocks)==null?void 0:o.find(f=>f.useInEditor))==null?void 0:i.data)||this.getDefaultData(),n=Dt(this.mockData);else if(typeof t.useMock=="boolean"&&t.useMock)this.mockData=(c=(a=t.schema.mocks)==null?void 0:a.find(f=>f.enable))==null?void 0:c.data,n=this.mockData||this.getDefaultData();else if(!t.initialData)n=this.getDefaultData();else{G(this,q,new s((u=t.initialData)!=null?u:{})),this.isInit=!0;return}G(this,q,new s(n!=null?n:{}))}get id(){return F(this,Xe)}get type(){return F(this,$t)}get schema(){return F(this,Ze)}get fields(){return F(this,he)}get methods(){return F(this,et)}setFields(t){G(this,he,t)}setMethods(t){G(this,et,t)}get data(){return F(this,q).getData("")}setData(t,n){F(this,q).update(t,n);const s={updateData:t,path:n};this.emit("change",s)}setValue(t,n){return this.setData(n,t)}onDataChange(t,n){F(this,q).on(t,n)}offDataChange(t,n){F(this,q).off(t,n)}getDefaultData(){return ps(F(this,he))}async init(){this.isInit=!0}destroy(){G(this,he,[]),this.removeAllListeners(),F(this,q).destroy()}}$t=new WeakMap,Xe=new WeakMap,Ze=new WeakMap,q=new WeakMap,he=new WeakMap,et=new WeakMap;const wn=e=>Object.entries(e).reduce((r,[t,n])=>{let s=n;return typeof n=="object"&&(s=JSON.stringify(n)),typeof n<"u"?"".concat(r).concat(r?"&":"").concat(globalThis.encodeURIComponent(t),"=").concat(globalThis.encodeURIComponent("".concat(s))):r},""),md=async e=>{var f;const{url:r,method:t="GET",headers:n={},params:s={},data:o={},...i}=e,a=wn(s);let c=JSON.stringify(o);return(f=n["Content-Type"])!=null&&f.includes("application/x-www-form-urlencoded")&&(c=wn(o)),(await globalThis.fetch(a?"".concat(r,"?").concat(a):r,{method:t,headers:n,body:t==="GET"?void 0:c,...i})).json()};var Ce,tt,rt,wt;class yd extends Us{constructor(t){const{options:n}=t.schema;super(t);d(this,"isLoading",!1);d(this,"error");d(this,"httpOptions");z(this,Ce);z(this,tt,[]);z(this,rt,[]);z(this,wt,"http");this.httpOptions=n,typeof t.request=="function"?G(this,Ce,t.request):typeof globalThis.fetch=="function"&&G(this,Ce,md),this.methods.forEach(s=>{typeof s.content=="function"&&(s.timing==="beforeRequest"&&F(this,tt).push(s.content),s.timing==="afterRequest"&&F(this,rt).push(s.content))})}get type(){return F(this,wt)}async init(){this.schema.autoFetch&&await this.request(this.httpOptions),super.init()}async request(t={}){var s,o;this.isLoading=!0;let n={...this.httpOptions,...t};try{for(const a of F(this,tt))await a({options:n,params:{},dataSource:this,app:this.app});typeof this.schema.beforeRequest=="function"&&(n=this.schema.beforeRequest(n,{app:this.app,dataSource:this}));let i=this.mockData?this.mockData:await((s=F(this,Ce))==null?void 0:s.call(this,n));for(const a of F(this,rt))await a({res:i,options:n,params:{},dataSource:this,app:this.app});if(typeof this.schema.afterResponse=="function"&&(i=this.schema.afterResponse(i,{app:this.app,dataSource:this,options:n})),(o=this.schema.responseOptions)!=null&&o.dataPath){const a=ge(this.schema.responseOptions.dataPath,i);this.setData(a)}else this.setData(i);this.error=void 0}catch(i){this.error={msg:i.message},this.emit("error",i)}this.isLoading=!1}get(t){return this.request({...t,method:"GET"})}post(t){return this.request({...t,method:"POST"})}}Ce=new WeakMap,tt=new WeakMap,rt=new WeakMap,wt=new WeakMap;const Ut=new Map,bd=(e,r)=>{const t="".concat(e.id,":").concat(r.map(a=>a.id).join(":"));if(Ut.has(t))return Ut.get(t);const n=new fu;n.addTarget(new Kr({id:e.id,type:"data-source",isTarget:(a,c)=>"".concat(a).includes(hs)?!1:cu(e,a,c,!0)})),n.addTarget(new Kr({id:e.id,type:"cond",isTarget:(a,c)=>uu(e,a,c,!0)})),n.collect(r,{},!0);const{deps:s}=n.getTarget(e.id,"data-source"),{deps:o}=n.getTarget(e.id,"cond"),i={deps:s,condDeps:o};return Ut.set(t,i),i},vd=(e,r)=>{let t=!0;for(const{op:n,value:s,range:o,field:i}of e){const[a,...c]=i,u=r[a];if(!u||!c.length)break;try{const f=ge(c.join("."),u);if(!su(n,f,s,o)){t=!1;break}}catch(f){console.warn(f)}}return t},Kt=(e,r)=>{if(!e[Se]||!Array.isArray(e[Se])||!e[Se].length)return!0;for(const{cond:t}of e[Se])if(t&&vd(t,r))return!0;return!1},_n=(e,r)=>{var t;if(fs(e)||ru(e)){const n=(t=r.items)==null?void 0:t.findIndex(s=>s.id===e.id);r.items.splice(n,1,e)}else ls(e,r.items)},Tn=(e,r,t=[],n={})=>{const s={...n,[r]:{}};let o=Dt(n[r]),i=s[r];return t.forEach((a,c)=>{if(Object.assign(i,o),c===t.length-1){i[a]=e;return}Array.isArray(o[a])&&(o[a]={},i[a]={}),o=o[a],i=i[a]}),s},$d=(e,r)=>{const[t,...n]=e,s=t.indexOf(mt);if(s>-1){const o=t.substring(s+mt.length),i=r[o];if(!i)return e;try{return ge(n.join("."),i)}catch(a){return e}}return e},On=(e,r)=>e.replaceAll(gs,(t,n)=>{try{return ge(n,r)}catch(s){return t}}),Sn=(e,r)=>typeof e=="string"?On(e,r):e!=null&&e.isBindDataSource&&e.dataSourceId?r[e.dataSourceId]:e!=null&&e.isBindDataSourceField&&e.dataSourceId&&typeof e.template=="string"?On(e.template,r[e.dataSourceId]):Array.isArray(e)&&typeof e[0]=="string"?$d(e,r):e,Hs=({compile:e,dsId:r,item:t,deps:n,condDeps:s,inEditor:o,ctxData:i})=>{var f,l;const{items:a,...c}=t,u=Dt(c);return(f=s[c.id])!=null&&f.keys.length&&!o&&(u.condResult=Kt(c,i)),Array.isArray(a)&&a.length?u.items=a.map(h=>Hs({compile:e,dsId:r,item:h,deps:n,condDeps:s,inEditor:o,ctxData:i})):a&&(u.items=a),(l=n[u.id])!=null&&l.keys.length?ds(e,u,{[r]:n},r):u},Y=class Y extends Rn{constructor({app:t,useMock:n,initialData:s}){var i,a;super();d(this,"app");d(this,"dataSourceMap",new Map);d(this,"data",{});d(this,"useMock",!1);this.app=t,this.useMock=n,s&&(this.data=s),(a=(i=t.dsl)==null?void 0:i.dataSources)==null||a.forEach(c=>{this.addDataSource(c)});const o=Array.from(this.dataSourceMap);typeof Promise.allSettled=="function"?Promise.allSettled(o.map(([,c])=>this.init(c))).then(c=>{const u={},f={};c.forEach((l,h)=>{const p=o[h][0];l.status==="fulfilled"?u[p]=this.data[p]:l.status==="rejected"&&(f[p]=l.reason)}),this.emit("init",u,f)}):Promise.all(o.map(([,c])=>this.init(c))).then(()=>{this.emit("init",this.data)}).catch(()=>{this.emit("init",this.data)})}static register(t,n){Y.dataSourceClassMap.set(t,n)}static getDataSourceClass(t){return Y.dataSourceClassMap.get(t)}static registerObservedData(t){Y.ObservedDataClass=t}async init(t){var n;if(!t.isInit&&!(this.app.jsEngine&&((n=t.schema.disabledInitInJsEngine)!=null&&n.includes(this.app.jsEngine)))){for(const s of t.methods){if(typeof s.content!="function")return;s.timing==="beforeInit"&&s.content({params:{},dataSource:t,app:this.app})}await t.init(),t.methods.forEach(s=>{typeof s.content=="function"&&s.timing==="afterInit"&&s.content({params:{},dataSource:t,app:this.app})})}}get(t){return this.dataSourceMap.get(t)}async addDataSource(t){if(!t)return;const n=Y.dataSourceClassMap.get(t.type)||Us,s=new n({app:this.app,schema:t,request:this.app.request,useMock:this.useMock,initialData:this.data[t.id],ObservedDataClass:Y.ObservedDataClass});this.dataSourceMap.set(t.id,s),this.data[s.id]=s.data,s.on("change",o=>{this.setData(s,o)})}setData(t,n){this.data[t.id]=t.data,this.emit("change",t.id,n)}removeDataSource(t){var n;(n=this.get(t))==null||n.destroy(),delete this.data[t],this.dataSourceMap.delete(t)}updateSchema(t){t.forEach(n=>{if(!this.get(n.id))return;this.removeDataSource(n.id),this.addDataSource(n);const o=this.get(n.id);o&&this.init(o)})}compiledNode({items:t,...n},s,o=!1){var a;const i=Dt(n);return t&&(i.items=Array.isArray(t)&&o?t.map(c=>this.compiledNode(c,s,o)):t),n.condResult===!1||n.visible===!1?i:ds(c=>Sn(c,this.data),i,((a=this.app.dsl)==null?void 0:a.dataSourceDeps)||{},s)}compliedConds(t){return Kt(t,this.data)}compliedIteratorItemConds(t,n,s=[]){const[o,...i]=s,a=this.get(o);if(!a)return!0;const c=Tn(t,a.id,i,this.data);return Kt(n,c)}compliedIteratorItems(t,n,s=[]){const[o,...i]=s,a=this.get(o);if(!a)return n;const c=Tn(t,a.id,i,this.data),{deps:u={},condDeps:f={}}=bd(a.schema,n);return!Object.keys(u).length&&!Object.keys(f).length?n:n.map(l=>Hs({compile:h=>Sn(h,c),dsId:a.id,item:l,deps:u,condDeps:f,inEditor:this.app.platform==="editor",ctxData:c}))}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach(t=>{t.destroy()}),this.dataSourceMap.clear()}onDataChange(t,n,s){var o;return(o=this.get(t))==null?void 0:o.onDataChange(n,s)}offDataChange(t,n,s){var o;return(o=this.get(t))==null?void 0:o.offDataChange(n,s)}};d(Y,"dataSourceClassMap",new Map),d(Y,"ObservedDataClass",Fs);let xe=Y;xe.register("http",yd);const wd=(e,r,t)=>{const{dsl:n,platform:s}=e;if(!(n!=null&&n.dataSources))return;const o=new xe({app:e,useMock:r,initialData:t});return n.dataSources&&n.dataSourceCondDeps&&s!=="editor"&&Pt(qr(n.dataSourceCondDeps),n.items).forEach(i=>{i.condResult=o.compliedConds(i),_n(i,n)}),n.dataSources&&n.dataSourceDeps&&Pt(qr(n.dataSourceDeps),n.items).forEach(i=>{_n(o.compiledNode(i),n)}),e.jsEngine!=="nodejs"&&o.on("change",(i,a)=>{var h,p,v;const c=((h=n.dataSourceDeps)==null?void 0:h[i])||{},u=((p=n.dataSourceCondDeps)==null?void 0:p[i])||{},f=gd([...Object.keys(u),...Object.keys(c)]),l=(v=e.page)!=null&&v.data&&e.platform!=="editor"?[e.page.data]:n.items;o.emit("update-data",Pt(f,l).map(b=>{var A;e.platform!=="editor"&&(b.condResult=o.compliedConds(b));const _=o.compiledNode(b);if(typeof((A=e.page)==null?void 0:A.setData)=="function")if(fs(_))e.page.setData(_);else{const E=e.page.getNode(b.id);E==null||E.setData(_)}return _}),i,a)}),o},_d=e=>{let r=0;return(...t)=>{if(r===0){r+=1;return}return e(...t)}};class Td extends Rs{constructor(t){super();d(this,"state");d(this,"subscribers",new Map);d(this,"update",(t,n)=>{var s;(s=this.state)==null||s.update(n!=null?n:"",t)});d(this,"on",(t,n)=>{var i;const s=this.state.subscribe(t,_d(n)),o=(i=this.subscribers.get(t))!=null?i:new Map;o.set(n,s),this.subscribers.set(t,o)});d(this,"off",(t,n)=>{var o;const s=this.subscribers.get(t);s&&((o=s.get(n))==null||o(),s.delete(n))});d(this,"getData",t=>{var n;return this.state?(n=this.state)==null?void 0:n.get(t):{}});d(this,"destroy",()=>{this.subscribers.forEach(t=>{t.forEach(n=>n())})});this.state=new bu(t)}}class jn{constructor(r=globalThis.navigator.userAgent,t={}){d(this,"isIos",!1);d(this,"isIphone",!1);d(this,"isIpad",!1);d(this,"isAndroid",!1);d(this,"isAndroidPad",!1);d(this,"isMac",!1);d(this,"isWin",!1);d(this,"isMqq",!1);d(this,"isWechat",!1);d(this,"isWeb",!1);d(this,"isOpenHarmony",!1);this.isIphone=r.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(r),this.isIos=this.isIphone||this.isIpad,this.isAndroid=r.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&r.indexOf("Mobile")<0,this.isMac=r.indexOf("Macintosh")>=0,this.isWin=r.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(r),this.isWechat=r.indexOf("MicroMessenger")>=0&&r.indexOf("wxwork")<0,this.isOpenHarmony=r.includes("OpenHarmony"),this.isWeb=!this.isIos&&!this.isAndroid&&!this.isOpenHarmony&&!/(WebOS|BlackBerry)/.test(r),Object.entries(t).forEach(([n,s])=>{this[n]=s})}}const Od=e=>{if(typeof e!="string")return e;const r={};return e.split(";").forEach(t=>{if(!t)return;const n=t.split(":");let s=n.shift(),o=n.join(":");s&&(s=s.replace(/^\s*/,"").replace(/\s*$/,""),o=o.replace(/^\s*/,"").replace(/\s*$/,""),s=s.split("-").map((i,a)=>a>0?"".concat(i[0].toUpperCase()).concat(i.substr(1)):i).join(""),r[s]=o)}),r},Sd=e=>e&&!/^url/.test(e)&&!/^linear-gradient/.test(e)?"url(".concat(e,")"):e,jd=e=>/^(-?\d+)(\.\d+)?$/.test(e),Ed=(e,r)=>{if(!e)return[];const t=Object.entries(e).map(([s,o])=>o.trim()?(s==="rotate"&&jd(o)&&(o="".concat(o,"deg")),r!=="hippy"?"".concat(s,"(").concat(o,")"):{[s]:o}):"");if(r==="hippy")return t;const n=t.join(" ");return n.trim()?n:"none"},Ad=(e,r)=>{if(!e)return{};let t={};const n={};typeof e=="string"?t=Od(e):t={...e};const s=r==="hippy",o=["zIndex","opacity","fontWeight"];return Object.entries(t).forEach(([i,a])=>{i==="scale"&&!n.transform&&s?n.transform=[{scale:a}]:i==="backgroundImage"&&!s?a&&(n[i]=Sd(a)):i==="transform"&&typeof a!="string"?n[i]=Ed(a,r):!o.includes(i)&&a&&/^[-]?[0-9]*[.]?[0-9]*$/.test(a)?n[i]=s?a:"".concat(a/100,"rem"):n[i]=a}),n},En="magic:common:events:",Ws="magic:common:actions:",ut={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},Cd=e=>e.startsWith(Ws),Id=(e,r)=>{var n;const{instance:t}=r;if(t)switch(e.replace(Ws,"")){case ut.SHOW:t.show();break;case ut.HIDE:t.hide();break;case ut.SCROLL_TO_VIEW:(n=t.$el)==null||n.scrollIntoView({behavior:"smooth"});break;case ut.SCROLL_TO_TOP:window.scrollTo({top:0,behavior:"smooth"});break}},Dd=e=>e.startsWith(En)?e:"".concat(En).concat(e),ks=(e,r)=>{var s,o;if(!e)return;const t=tu()(e);return t?r.getNode(t,(s=e.dataset.tmagicIteratorContainerId)==null?void 0:s.split(","),(o=e.dataset.tmagicIteratorIndex)==null?void 0:o.split(",").map(i=>globalThis.parseInt(i,10))):ks(e.parentElement,r)};class xd extends nt.EventEmitter{constructor({app:t}){super();d(this,"app");d(this,"nodeEventList",new Map);d(this,"dataSourceEventList",new Map);d(this,"commonClickEventHandler",t=>{if(!t.target)return;const n=ks(t.target,this.app),s="".concat(Dd("click"),"_").concat(n==null?void 0:n.data.id);n!=null&&n.eventKeys.has(s)&&this.emit(n.eventKeys.get(s),n)});this.app=t,globalThis.document.body.addEventListener("click",this.commonClickEventHandler)}destroy(){this.removeNodeEvents(),this.removeAllListeners(),globalThis.document.body.removeEventListener("click",this.commonClickEventHandler)}bindNodeEvents(t){var n;(n=t.events)==null||n.forEach((s,o)=>{let i="".concat(s.name,"_").concat(t.data.id);const a=s.name.split(".");a.length>1&&(i="".concat(a[1],"_").concat(a[0]));let c=Symbol(i);t.eventKeys.has(i)?c=t.eventKeys.get(i):t.eventKeys.set(i,c);const u=(f,...l)=>{this.eventHandler(o,t,l)};this.nodeEventList.set(u,c),this.on(c,u)})}removeNodeEvents(){Array.from(this.nodeEventList.keys()).forEach(t=>{const n=this.nodeEventList.get(t);n&&this.off(n,t)}),this.nodeEventList.clear()}bindDataSourceEvents(t){this.removeDataSourceEvents(t),t.forEach(n=>{var o;const s=(o=this.dataSourceEventList.get(n.id))!=null?o:new Map;(n.schema.events||[]).forEach(i=>{var f;const[a,...c]=((f=i.name)==null?void 0:f.split("."))||[];if(!a)return;const u=(...l)=>{this.eventHandler(i,n,l)};s.set(i.name,u),a===Qr?n==null||n.onDataChange(c.join("."),u):n.on(a,u)}),this.dataSourceEventList.set(n.id,s)})}removeDataSourceEvents(t){this.dataSourceEventList.size&&(t.forEach(n=>{const s=this.dataSourceEventList.get(n.id);s&&Array.from(s.keys()).forEach(o=>{const[i,...a]=o.split(".");i===Qr?n.offDataChange(a.join("."),s.get(o)):n.off(i,s.get(o))})}),this.dataSourceEventList.clear())}async eventHandler(t,n,s){const o=typeof t=="number"?n.events[t]:t;if(Gc(o,"actions")){const{actions:i}=o;for(let a=0;a<i.length;a++)if(typeof t=="number"){const c=n.events[t].actions[a];this.actionHandler(c,n,s)}else this.actionHandler(i[a],n,s)}else await this.compActionHandler(o,n,s)}async actionHandler(t,n,s){if(t.actionType===ht.COMP){const o=t;await this.compActionHandler(o,n,s)}else if(t.actionType===ht.CODE){const o=t;await this.app.runCode(o.codeId,o.params||{},s)}else if(t.actionType===ht.DATA_SOURCE){const o=t,[i,a]=o.dataSourceMethod;await this.app.runDataSourceMethod(i,a,o.params||{},s)}}async compActionHandler(t,n,s){if(!this.app.page)throw new Error("当前没有页面");let{method:o,to:i}=t;Array.isArray(o)&&([i,o]=o);const a=this.app.getNode(i);if(!a)throw"ID为".concat(i,"的组件不存在");if(Cd(o))return Id(o,a);a.instance?typeof a.instance[o]=="function"&&await a.instance[o](n,...s):a.addEventToQueue({method:o,fromCpt:n,args:s})}}class Md{constructor(r){d(this,"designWidth",375);d(this,"tid");d(this,"resizeHandler",()=>{clearTimeout(this.tid),this.tid=setTimeout(()=>{this.refreshRem()},300)});d(this,"pageshowHandler",r=>{r.persisted&&this.resizeHandler()});globalThis.document.readyState==="complete"?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),typeof(r==null?void 0:r.designWidth)<"u"&&this.setDesignWidth(r.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(r){this.designWidth=r,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:r}=document.documentElement.getBoundingClientRect(),t=r/(this.designWidth/100);globalThis.document.documentElement.style.fontSize="".concat(t,"px"),globalThis.document.documentElement.style.fontSize="".concat(this.correctRem(t),"px")}correctRem(r){const{document:t}=globalThis,n=t.createElement("div");n.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",t.documentElement.appendChild(n);const s=n.offsetWidth;return t.documentElement.removeChild(n),Math.abs(s-r)>1?r**2/s:r}}class Ld{constructor(){d(this,"data",{})}set(r,t){this.data[r]=t}get(r){return this.data[r]}}class Je extends nt.EventEmitter{constructor(t){super();d(this,"data");d(this,"style");d(this,"events",[]);d(this,"instance");d(this,"page");d(this,"parent");d(this,"app");d(this,"store",new Ld);d(this,"eventKeys",new Map);d(this,"eventQueue",[]);this.page=t.page,this.parent=t.parent,this.app=t.app,this.setData(t.config),this.listenLifeSafe()}setData(t){this.data=t;const{events:n,style:s}=t;this.events=n||[],this.style=s||{},this.emit("update-data",t)}addEventToQueue(t){this.eventQueue.push(t)}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",async t=>{this.once("destroy",()=>{this.instance=null,typeof this.data.destroy=="function"&&this.data.destroy(this),this.listenLifeSafe()}),this.instance=t,await this.runHookCode("created")}),this.once("mounted",async t=>{this.instance=t;for(let n=this.eventQueue.shift();n;n=this.eventQueue.shift())typeof t[n.method]=="function"&&await t[n.method](n.fromCpt,...n.args);await this.runHookCode("mounted")})}async runHookCode(t){var s,o,i;if(typeof this.data[t]=="function"){await this.data[t](this);return}const n=this.data[t];if((n==null?void 0:n.hookType)===cs.CODE)for(const a of n.hookData){const{codeType:c=dt.CODE,codeId:u,params:f={}}=a;let l;const h={app:this.app,params:f};if(c===dt.CODE&&typeof u=="string"&&((s=this.app.codeDsl)!=null&&s[u]))l=this.app.codeDsl[u].content;else if(c===dt.DATA_SOURCE_METHOD&&Array.isArray(u)&&u.length>1){const p=(o=this.app.dataSourceManager)==null?void 0:o.get(u[0]);l=(i=p==null?void 0:p.methods.find(v=>v.name===u[1]))==null?void 0:i.content,h.dataSource=p}l&&typeof l=="function"&&await l(h)}}}class pr extends Je{constructor(){super(...arguments);d(this,"nodes",[])}setData(t){this.resetNodes(),super.setData(t)}resetNodes(){var t;(t=this.nodes)==null||t.forEach(n=>{n.forEach(s=>{s.destroy()})}),this.nodes=[]}initNode(t,n,s){var i,a,c,u,f,l;if(s.has(t.id)&&((i=s.get(t.id))==null||i.destroy()),t.type&&this.app.iteratorContainerType.has(t.type)){const h=new pr({config:t,parent:n,page:this.page,app:this.app});s.set(t.id,h),(a=this.app.eventHelper)==null||a.bindNodeEvents(h);return}const o=new Je({config:t,parent:n,page:this.page,app:this.app});if((c=this.app.eventHelper)==null||c.bindNodeEvents(o),s.set(t.id,o),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const h=(f=(u=this.app.dsl)==null?void 0:u.items)==null?void 0:f.find(p=>p.id===t.pageFragmentId);h&&(t.items=[h])}(l=t.items)==null||l.forEach(h=>{this.initNode(h,o,s)})}setNodes(t,n){const s=this.nodes[n]||new Map;t.forEach(o=>{this.initNode(o,this,s)}),this.nodes[n]=s}getNode(t,n){var s;return(s=this.nodes[n])==null?void 0:s.get(t)}destroy(){super.destroy(),this.resetNodes()}}class Pd extends Je{constructor(t){super(t);d(this,"nodes",new Map);this.setNode(t.config.id,this),t.config.items.forEach(n=>{this.initNode(n,this)})}initNode(t,n){var o,i,a;if(t.type&&this.app.iteratorContainerType.has(t.type)){this.setNode(t.id,new pr({config:t,parent:n,page:this,app:this.app}));return}const s=new Je({config:t,parent:n,page:this,app:this.app});if(this.setNode(t.id,s),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const c=(i=(o=this.app.dsl)==null?void 0:o.items)==null?void 0:i.find(u=>u.id===t.pageFragmentId);c&&(t.items=[c])}(a=t.items)==null||a.forEach(c=>{this.initNode(c,s)})}getNode(t,n,s){if(this.nodes.has(t))return this.nodes.get(t);if(Array.isArray(n)&&n.length&&Array.isArray(s)){let o=this.nodes.get(n[0]);for(let i=1,a=n.length;i<a;i++)o=o==null?void 0:o.getNode(n[i],s[i-1]);return o==null?void 0:o.getNode(t,s[s.length-1])}}setNode(t,n){this.nodes.set(t,n)}deleteNode(t){this.nodes.delete(t)}destroy(){super.destroy(),this.nodes.clear()}}class Nd extends nt.EventEmitter{constructor(t){var n;super();d(this,"env",new jn);d(this,"dsl");d(this,"codeDsl");d(this,"dataSourceManager");d(this,"page");d(this,"useMock",!1);d(this,"platform","mobile");d(this,"jsEngine","browser");d(this,"components",new Map);d(this,"pageFragmentContainerType",new Set(["page-fragment-container"]));d(this,"iteratorContainerType",new Set(["iterator-container"]));d(this,"request");d(this,"transformStyle");d(this,"eventHelper");d(this,"flexible");this.setEnv(t.ua),this.codeDsl=(n=t.config)==null?void 0:n.codeBlocks,t.platform&&(this.platform=t.platform),t.jsEngine&&(this.jsEngine=t.jsEngine),t.pageFragmentContainerType&&(Array.isArray(t.pageFragmentContainerType)?t.pageFragmentContainerType:[t.pageFragmentContainerType]).forEach(o=>{this.pageFragmentContainerType.add(o)}),t.iteratorContainerType&&(Array.isArray(t.iteratorContainerType)?t.iteratorContainerType:[t.iteratorContainerType]).forEach(o=>{this.iteratorContainerType.add(o)}),typeof t.useMock=="boolean"&&(this.useMock=t.useMock),this.jsEngine==="browser"&&(this.flexible=new Md({designWidth:t.designWidth})),this.platform!=="editor"&&(this.eventHelper=new xd({app:this})),this.transformStyle=t.transformStyle||(s=>Ad(s,this.jsEngine)),t.request&&(this.request=t.request),t.config&&this.setConfig(t.config,t.curPage)}setEnv(t){this.env=new jn(t)}setDesignWidth(t){var n;(n=this.flexible)==null||n.setDesignWidth(t)}setConfig(t,n){var o,i,a;this.dsl=t,!n&&t.items.length&&(n=t.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=wd(this,this.useMock),this.codeDsl=t.codeBlocks,this.setPage(n||((i=(o=this.page)==null?void 0:o.data)==null?void 0:i.id));const s=Array.from(this.dataSourceManager.dataSourceMap.values());(a=this.eventHelper)==null||a.bindDataSourceEvents(s)}setPage(t){var s,o,i,a;const n=(s=this.dsl)==null?void 0:s.items.find(c=>"".concat(c.id)==="".concat(t));if(!n){this.deletePage(),super.emit("page-change");return}n!==((o=this.page)==null?void 0:o.data)&&((i=this.page)==null||i.destroy(),this.page=new Pd({config:n,app:this}),(a=this.eventHelper)==null||a.removeNodeEvents(),this.page.nodes.forEach(c=>{var u;(u=this.eventHelper)==null||u.bindNodeEvents(c)}),super.emit("page-change",this.page))}deletePage(){var t,n;(t=this.page)==null||t.destroy(),(n=this.eventHelper)==null||n.removeNodeEvents(),this.page=void 0}getPage(t){if(!t)return this.page;if(this.page&&"".concat(this.page.data.id)==="".concat(t))return this.page}getNode(t,n,s){var o;return(o=this.page)==null?void 0:o.getNode(t,n,s)}registerComponent(t,n){this.components.set(t,n)}unregisterComponent(t){this.components.delete(t)}resolveComponent(t){return this.components.get(t)}emit(t,...n){var i,a;const[s,...o]=n;return this.eventHelper&&s instanceof Je&&((i=s.data)!=null&&i.id)&&s.eventKeys.has("".concat(String(t),"_").concat(s.data.id))?(a=this.eventHelper)==null?void 0:a.emit(s.eventKeys.get("".concat(String(t),"_").concat(s.data.id)),s,...o):super.emit(t,...n)}async runCode(t,n,s){var i,a;if(!t||Yc(this.codeDsl))return;const o=(a=(i=this.codeDsl)==null?void 0:i[t])==null?void 0:a.content;typeof o=="function"&&await o({app:this,params:n,eventParams:s})}async runDataSourceMethod(t,n,s,o){var u;if(!t||!n)return;const i=(u=this.dataSourceManager)==null?void 0:u.get(t);if(!i)return;const c=(i.methods||[]).find(f=>f.name===n);c&&typeof c.content=="function"&&await c.content({app:this,params:s,dataSource:i,eventParams:o})}destroy(){var t,n;this.removeAllListeners(),this.page=void 0,(t=this.flexible)==null||t.destroy(),this.flexible=void 0,(n=this.eventHelper)==null||n.destroy()}}const Rd=(e,r=window)=>{var i;const t=VueDemi.ref(),n=VueDemi.ref(),s=VueDemi.ref(),o=VueDemi.computed(()=>{var a,c,u,f;return((c=(a=t.value)==null?void 0:a.items)==null?void 0:c.find(l=>l.id===n.value))||((f=(u=t.value)==null?void 0:u.items)==null?void 0:f[0])});return VueDemi.watch(o,async()=>{var c;await VueDemi.nextTick();const a=document.querySelector(".magic-ui-page");a&&((c=r.magic)==null||c.onPageElUpdate(a))}),(i=r.magic)==null||i.onRuntimeReady({getApp(){return e},updateRootConfig(a){t.value=a,e==null||e.setConfig(a,n.value)},updatePageId(a){n.value=a,e==null||e.setPage(a)},select(a){var u;s.value=a,e!=null&&e.getPage(a)&&((u=this.updatePageId)==null||u.call(this,a));const c=Gr()(document,"".concat(a));return c||VueDemi.nextTick().then(()=>Gr()(document,"".concat(a)))},add({config:a,parentId:c}){var f,l,h,p,v;if(!t.value)throw new Error("error");if(!s.value)throw new Error("error");if(!c)throw new Error("error");const u=ze(c,[t.value]).pop();if(!u)throw new Error("未找到父节点");if(a.type!=="page"){const b=(f=e==null?void 0:e.page)==null?void 0:f.getNode(u.id);b&&((l=e==null?void 0:e.page)==null||l.initNode(a,b))}if(u.id!==s.value){const b=(h=u.items)==null?void 0:h.findIndex(_=>_.id===s.value);(p=u.items)==null||p.splice(b+1,0,a)}else(v=u.items)==null||v.push(a)},update({config:a,parentId:c}){var l,h;if(!t.value||!e)throw new Error("error");const u=((l=e.dataSourceManager)==null?void 0:l.compiledNode(a,void 0,!0))||a;ls(VueDemi.reactive(u),[t.value],c);const f=e.getNode(a.id);f&&f.setData(u),((h=e.page)==null?void 0:h.data.id)===a.id&&e.page.setData(u)},remove({id:a,parentId:c}){var h,p;if(!t.value)throw new Error("error");const u=ze(a,[t.value]).pop();if(!u)throw new Error("未找到目标元素");const f=ze(c,[t.value]).pop();if(!f)throw new Error("未找到父元素");u.type==="page"?e==null||e.deletePage():(h=e==null?void 0:e.page)==null||h.deleteNode(u.id);const l=(p=f.items)==null?void 0:p.findIndex(v=>v.id===u.id);f.items.splice(l,1)}}),{pageConfig:o}},Fd=Vue.defineComponent({__name:"App",setup(e){const r=Vue.inject("app"),{pageConfig:t}=Rd(r);return(n,s)=>{const o=Vue.resolveComponent("magic-ui-page");return Vue.unref(t)?(Vue.openBlock(),Vue.createBlock(o,{key:Vue.unref(t).id,config:Vue.unref(t)},null,8,["config"])):Vue.createCommentVNode("",!0)}}});xe.registerObservedData(Td);Promise.all([xt(()=>import("./comp-entry-CvKOmN5P.js"),__vite__mapDeps([0,1])),xt(()=>import("./plugin-entry-B1O5LaIO.js"),[]),xt(()=>import("./datasource-entry-yoD6TSFD.js"),[])]).then(([e,r,t])=>{const n=Vue.createApp(Fd),s=new Nd({ua:window.navigator.userAgent,platform:"editor"});s.env.isWeb&&s.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(e.default).forEach(([o,i])=>{n.component("magic-ui-".concat(o),i)}),Object.entries(t.default).forEach(([o,i])=>{xe.register(o,i)}),Object.values(r.default).forEach(o=>{n.use(o,{app:s})}),window.appInstance=s,n.config.globalProperties.app=s,n.provide("app",s),n.mount("#app")});export{Hd as __vite_legacy_guard};
//# sourceMappingURL=index-Dff9FH9L.js.map
