{"version":3,"file":"IteratorContainer-legacy-a9Gxdk8q.js","sources":["../../../../../../vue-components/iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <div>\n    <magic-ui-container\n      v-for=\"(item, index) in configs\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"[...(iteratorContainerId || []), config.id]\"\n      :key=\"index\"\n      :config=\"item\"\n    ></magic-ui-container>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, type PropType, watch } from 'vue-demi';\n\nimport type { IteratorContainer as TMagicIteratorContainer } from '@tmagic/core';\nimport type { Id, MIteratorContainer, MNode } from '@tmagic/schema';\nimport { useApp } from '@tmagic/vue-runtime-help';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<IteratorContainerSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { app } = useApp({\n      config: props.config,\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      methods: {},\n    });\n\n    const configs = computed<IteratorItemSchema[]>(() => {\n      let { iteratorData = [] } = props.config;\n      const { itemConfig, dsField, items } = props.config;\n\n      if (!Array.isArray(iteratorData)) {\n        iteratorData = [];\n      }\n\n      if (app?.platform === 'editor' && !iteratorData.length) {\n        iteratorData.push({});\n      }\n\n      return iteratorData.map((itemData: any) => {\n        const condResult =\n          app?.platform !== 'editor'\n            ? app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true\n            : true;\n\n        const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n        return {\n          items: newItems,\n          condResult,\n          style: {\n            position: 'relative',\n            left: 0,\n            top: 0,\n            ...itemConfig.style,\n          },\n        };\n      });\n    });\n\n    watch(\n      configs,\n      (configs) => {\n        if (!props.config.id) {\n          return;\n        }\n\n        const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(\n          props.config.id,\n          props.iteratorContainerId,\n          props.iteratorIndex,\n        );\n\n        if (!iteratorContainerNode) {\n          return;\n        }\n\n        iteratorContainerNode.resetNodes();\n\n        configs.forEach((config, index) => {\n          iteratorContainerNode.setNodes(config.items, index);\n        });\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      configs,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main","VueDemi","defineComponent","props","config","type","Object","required","iteratorIndex","Array","iteratorContainerId","model","default","setup","app","useApp","methods","configs","iteratorData","itemConfig","dsField","items","isArray","platform","length","push","map","itemData","condResult","dataSourceManager","compliedIteratorItemConds","compliedIteratorItems","style","position","left","top","watch","configs2","id","iteratorContainerNode","getNode","resetNodes","forEach","index","setNodes","immediate","Vue","resolveComponent","openBlock","createElementBlock","renderList","_ctx","item","createBlock","_component_magic_ui_container","key"],"mappings":"8LAgCe,MAAAA,EAAAC,QAAgBC,gBAAA,CAAAC,MAAA,CACtBC,OAAA,CACGC,KAAAC,OACAC,UAAA,GAERC,cAAAC,MACeC,oBAAAD,MACME,MAAA,CACdN,KAAAC,OACCM,QAAAA,KAAA,CAAA,KAGVC,KAAAA,CAAAV,GAGE,MAAAW,IAAAA,GAAAC,EAAA,CAAuBX,OAAAD,EAAAC,OACPM,oBAAAP,EAAAO,oBACaF,cAAAL,EAAAK,cACNQ,QAAA,CAAA,IAIvBC,EAAgBhB,uBACd,IAAAiB,aAAAA,EAAA,IAAAf,EAAAC,OACA,MAAAe,WAAAA,EAAAC,QAAAA,EAAAC,MAAAA,GAAAlB,EAAAC,OAUA,OARAK,MAAAa,QAAAJ,KACEA,EAAA,IAGF,WAAAJ,GAAAS,UAAAL,EAAAM,QACEN,EAAAO,KAAA,CAAA,GAGFP,EAAAQ,KAAAC,IACE,MAAAC,EAAA,WAAAd,GAAAS,WAAAT,GAAAe,mBAAAC,0BAAAH,EAAAR,EAAAC,KAAA,GAOA,MAAA,CAAOC,MAFPP,GAAAe,mBAAAE,sBAAAJ,EAAAN,EAAAD,IAAAC,EAGSO,aACPI,MAAA,CACOC,SAAA,WACKC,KAAA,EACJC,IAAA,KACDhB,EAAAa,OAEP,GACF,IAgCJ,OA5BA/B,QAAAmC,MAAAnB,GACEoB,IAEE,IAAAlC,EAAAC,OAAAkC,GACE,OAGF,MAAAC,EAAAzB,GAAA0B,QAAmCrC,EAAAC,OAAAkC,GACpBnC,EAAAO,oBACPP,EAAAK,eAIR+B,IAIAA,EAAAE,aAEAJ,EAAAK,SAAA,CAAAtC,EAAAuC,KACEJ,EAAAK,SAAAxC,EAAAiB,MAAAsB,EAAA,IAAkD,GAEtD,CACAE,WAAA,IAKF,CAAO5B,UAEP,6DApHF6B,IAQMC,iBAAA,sBADkB,OAAAD,IAAAE,YAAAF,IAAAG,mBAAA,MAAA,KAAA,EAJnBH,eAAA,GAAAA,IAAAG,mBAAqBzC,IAAAA,cAAsBsC,IAAKI,WAAAC,EAAAlC,SAAA,CAAAmC,EAAAT,KAChDG,IAAAE,YAAAF,IAAAO,YAAAC,EAAA,CAAwDlD,iBAAAA,IAAAA,EAAAA,eAAAA,GAAAA,GAC9C,wBAAA,IAAA+C,EAAAzC,qBAAA,GAAAyC,EAAA/C,OAAAkC,IACEiB,IAAAZ"}