{"version":3,"file":"IteratorContainer-DkWKY737.js","sources":["../../../../../../vue-components/iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <div>\n    <magic-ui-container\n      v-for=\"(item, index) in configs\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"[...(iteratorContainerId || []), config.id]\"\n      :key=\"index\"\n      :config=\"item\"\n    ></magic-ui-container>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, type PropType, watch } from 'vue-demi';\n\nimport type { IteratorContainer as TMagicIteratorContainer } from '@tmagic/core';\nimport type { Id, MIteratorContainer, MNode } from '@tmagic/schema';\nimport { useApp } from '@tmagic/vue-runtime-help';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<IteratorContainerSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { app } = useApp({\n      config: props.config,\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      methods: {},\n    });\n\n    const configs = computed<IteratorItemSchema[]>(() => {\n      let { iteratorData = [] } = props.config;\n      const { itemConfig, dsField, items } = props.config;\n\n      if (!Array.isArray(iteratorData)) {\n        iteratorData = [];\n      }\n\n      if (app?.platform === 'editor' && !iteratorData.length) {\n        iteratorData.push({});\n      }\n\n      return iteratorData.map((itemData: any) => {\n        const condResult =\n          app?.platform !== 'editor'\n            ? app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true\n            : true;\n\n        const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n        return {\n          items: newItems,\n          condResult,\n          style: {\n            position: 'relative',\n            left: 0,\n            top: 0,\n            ...itemConfig.style,\n          },\n        };\n      });\n    });\n\n    watch(\n      configs,\n      (configs) => {\n        if (!props.config.id) {\n          return;\n        }\n\n        const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(\n          props.config.id,\n          props.iteratorContainerId,\n          props.iteratorIndex,\n        );\n\n        if (!iteratorContainerNode) {\n          return;\n        }\n\n        iteratorContainerNode.resetNodes();\n\n        configs.forEach((config, index) => {\n          iteratorContainerNode.setNodes(config.items, index);\n        });\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      configs,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main","props","app","useApp","configs","iteratorData","itemConfig","dsField","items","itemData","condResult","_b","_a","_d","_c","configs2","iteratorContainerNode","config","index","iteratorIndex","_ctx","item","_component_magic_ui_container"],"mappings":"+FAgCA,MAAeA,EAAA,QAAgB,gBAAA,CAAA,MAAA,CACtB,OAAA,CACG,KAAA,OACA,SAAA,EACI,EACZ,cAAA,MACe,oBAAA,MACM,MAAA,CACd,KAAA,OACC,QAAA,KAAA,CAAA,EACW,CACnB,EACF,MAAAC,EAAA,CAGE,KAAA,CAAA,IAAAC,CAAA,EAAAC,EAAA,CAAuB,OAAAF,EAAA,OACP,oBAAAA,EAAA,oBACa,cAAAA,EAAA,cACN,QAAA,CAAA,CACX,CAAA,EAGZG,EAAgB,sBACd,GAAA,CAAA,aAAAC,EAAA,CAAA,GAAAJ,EAAA,OACA,KAAA,CAAA,WAAAK,EAAA,QAAAC,EAAA,MAAAC,CAAA,EAAAP,EAAA,OAEA,OAAA,MAAA,QAAAI,CAAA,IACEA,EAAA,CAAA,IAGFH,GAAA,YAAAA,EAAA,YAAA,UAAA,CAAAG,EAAA,QACEA,EAAA,KAAA,CAAA,CAAA,EAGFA,EAAA,IAAAI,GAAA,aACE,MAAAC,GAAAR,GAAA,YAAAA,EAAA,YAAA,WAAAS,GAAAC,EAAAV,GAAA,YAAAA,EAAA,oBAAA,YAAAU,EAAA,0BAAAH,EAAAH,EAAAC,KAAA,KAAAI,EAAA,GAOA,MAAA,CAAO,OAFPE,GAAAC,EAAAZ,GAAA,YAAAA,EAAA,oBAAA,YAAAY,EAAA,sBAAAL,EAAAD,EAAAD,KAAA,KAAAM,EAAAL,EAGS,WAAAE,EACP,MAAA,CACO,SAAA,WACK,KAAA,EACJ,IAAA,EACD,GAAAJ,EAAA,KACS,CAChB,CACF,CAAA,CACD,CAAA,EAGH,eAAA,MAAAF,EACEW,GAAA,CAEE,GAAA,CAAAd,EAAA,OAAA,GACE,OAGF,MAAAe,EAAAd,GAAA,YAAAA,EAAA,QAAmCD,EAAA,OAAA,GACpBA,EAAA,oBACPA,EAAA,eAIRe,IAIAA,EAAA,WAAA,EAEAD,EAAA,QAAA,CAAAE,EAAAC,IAAA,CACEF,EAAA,SAAAC,EAAA,MAAAC,CAAA,CAAkD,CAAA,EACnD,EACH,CACA,UAAA,EACa,CACb,EAGF,CAAO,QAAAd,CACL,CACF,CAEJ,CAAA,kCAtHE,IAQM,iBAAA,oBAAA,EADkB,OAAA,IAAA,YAAA,IAAA,mBAAA,MAAA,KAAA,EAJnB,cAAA,EAAA,EAAA,IAAA,mBAAqBe,IAAAA,cAAsB,IAAK,WAAAC,EAAA,QAAA,CAAAC,EAAAH,KAChD,IAAA,UAAA,EAAA,IAAA,YAAAI,EAAA,CAAwDL,iBAAAA,CAAAA,GAAAA,EAAAA,eAAAA,CAAAA,EAAAA,CAAAA,EAC9C,wBAAA,CAAA,GAAAG,EAAA,qBAAA,CAAA,EAAAA,EAAA,OAAA,EAAA,EACE,IAAAF"}